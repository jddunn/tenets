<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="MCP server for AI coding assistants. Native integration with Cursor, Claude, Windsurf. Intelligent code context via Model Context Protocol."><meta name=author content="Johnny Dunn"><link href=https://tenets.dev/dev/api/tenets/core/instiller/instiller/ rel=canonical><link href=../injector/ rel=prev><link href=../manager/ rel=next><link rel=icon href=../../../../../favicon/favicon.ico><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.7.0"><title>instiller - Tenets</title><link rel=stylesheet href=../../../../../assets/stylesheets/main.618322db.min.css><link rel=stylesheet href=../../../../../assets/stylesheets/palette.ab4e12ef.min.css><style>:root{--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M1%207.775V2.75C1%201.784%201.784%201%202.75%201h5.025c.464%200%20.91.184%201.238.513l6.25%206.25a1.75%201.75%200%200%201%200%202.474l-5.026%205.026a1.75%201.75%200%200%201-2.474%200l-6.25-6.25A1.75%201.75%200%200%201%201%207.775m1.5%200c0%20.066.026.13.073.177l6.25%206.25a.25.25%200%200%200%20.354%200l5.025-5.025a.25.25%200%200%200%200-.354l-6.25-6.25a.25.25%200%200%200-.177-.073H2.75a.25.25%200%200%200-.25.25ZM6%205a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E');--md-admonition-icon--abstract:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2.5%201.75v11.5c0%20.138.112.25.25.25h3.17a.75.75%200%200%201%200%201.5H2.75A1.75%201.75%200%200%201%201%2013.25V1.75C1%20.784%201.784%200%202.75%200h8.5C12.216%200%2013%20.784%2013%201.75v7.736a.75.75%200%200%201-1.5%200V1.75a.25.25%200%200%200-.25-.25h-8.5a.25.25%200%200%200-.25.25m13.274%209.537zl-4.557%204.45a.75.75%200%200%201-1.055-.008l-1.943-1.95a.75.75%200%200%201%201.062-1.058l1.419%201.425%204.026-3.932a.75.75%200%201%201%201.048%201.074M4.75%204h4.5a.75.75%200%200%201%200%201.5h-4.5a.75.75%200%200%201%200-1.5M4%207.75A.75.75%200%200%201%204.75%207h2a.75.75%200%200%201%200%201.5h-2A.75.75%200%200%201%204%207.75%22/%3E%3C/svg%3E');--md-admonition-icon--info:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M0%208a8%208%200%201%201%2016%200A8%208%200%200%201%200%208m8-6.5a6.5%206.5%200%201%200%200%2013%206.5%206.5%200%200%200%200-13M6.5%207.75A.75.75%200%200%201%207.25%207h1a.75.75%200%200%201%20.75.75v2.75h.25a.75.75%200%200%201%200%201.5h-2a.75.75%200%200%201%200-1.5h.25v-2h-.25a.75.75%200%200%201-.75-.75M8%206a1%201%200%201%201%200-2%201%201%200%200%201%200%202%22/%3E%3C/svg%3E');--md-admonition-icon--tip:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M3.499.75a.75.75%200%200%201%201.5%200v.996C5.9%202.903%206.793%203.65%207.662%204.376l.24.202c-.036-.694.055-1.422.426-2.163C9.1.873%2010.794-.045%2012.622.26%2014.408.558%2016%201.94%2016%204.25c0%201.278-.954%202.575-2.44%202.734l.146.508.065.22c.203.701.412%201.455.476%202.226.142%201.707-.4%203.03-1.487%203.898C11.714%2014.671%2010.27%2015%208.75%2015h-6a.75.75%200%200%201%200-1.5h1.376a4.5%204.5%200%200%201-.563-1.191%203.84%203.84%200%200%201-.05-2.063%204.65%204.65%200%200%201-2.025-.293.75.75%200%200%201%20.525-1.406c1.357.507%202.376-.006%202.698-.318l.009-.01a.747.747%200%200%201%201.06%200%20.75.75%200%200%201-.012%201.074c-.912.92-.992%201.835-.768%202.586.221.74.745%201.337%201.196%201.621H8.75c1.343%200%202.398-.296%203.074-.836.635-.507%201.036-1.31.928-2.602-.05-.603-.216-1.224-.422-1.93l-.064-.221c-.12-.407-.246-.84-.353-1.29a2.4%202.4%200%200%201-.507-.441%203.1%203.1%200%200%201-.633-1.248.75.75%200%200%201%201.455-.364c.046.185.144.436.31.627.146.168.353.305.712.305.738%200%201.25-.615%201.25-1.25%200-1.47-.95-2.315-2.123-2.51-1.172-.196-2.227.387-2.706%201.345-.46.92-.27%201.774.019%203.062l.042.19.01.05c.348.443.666.949.94%201.553a.75.75%200%201%201-1.365.62c-.553-1.217-1.32-1.94-2.3-2.768L6.7%205.527c-.814-.68-1.75-1.462-2.692-2.619a3.7%203.7%200%200%200-1.023.88c-.406.495-.663%201.036-.722%201.508.116.122.306.21.591.239.388.038.797-.06%201.032-.19a.75.75%200%200%201%20.728%201.31c-.515.287-1.23.439-1.906.373-.682-.067-1.473-.38-1.879-1.193L.75%205.677V5.5c0-.984.48-1.94%201.077-2.664.46-.559%201.05-1.055%201.673-1.353z%22/%3E%3C/svg%3E');--md-admonition-icon--success:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M13.78%204.22a.75.75%200%200%201%200%201.06l-7.25%207.25a.75.75%200%200%201-1.06%200L2.22%209.28a.75.75%200%200%201%20.018-1.042.75.75%200%200%201%201.042-.018L6%2010.94l6.72-6.72a.75.75%200%200%201%201.06%200%22/%3E%3C/svg%3E');--md-admonition-icon--question:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M0%208a8%208%200%201%201%2016%200A8%208%200%200%201%200%208m8-6.5a6.5%206.5%200%201%200%200%2013%206.5%206.5%200%200%200%200-13M6.92%206.085h.001a.749.749%200%201%201-1.342-.67c.169-.339.436-.701.849-.977C6.845%204.16%207.369%204%208%204a2.76%202.76%200%200%201%201.637.525c.503.377.863.965.863%201.725%200%20.448-.115.83-.329%201.15-.205.307-.47.513-.692.662-.109.072-.22.138-.313.195l-.006.004a6%206%200%200%200-.26.16%201%201%200%200%200-.276.245.75.75%200%200%201-1.248-.832c.184-.264.42-.489.692-.661q.154-.1.313-.195l.007-.004c.1-.061.182-.11.258-.161a1%201%200%200%200%20.277-.245C8.96%206.514%209%206.427%209%206.25a.61.61%200%200%200-.262-.525A1.27%201.27%200%200%200%208%205.5c-.369%200-.595.09-.74.187a1%201%200%200%200-.34.398M9%2011a1%201%200%201%201-2%200%201%201%200%200%201%202%200%22/%3E%3C/svg%3E');--md-admonition-icon--warning:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M6.457%201.047c.659-1.234%202.427-1.234%203.086%200l6.082%2011.378A1.75%201.75%200%200%201%2014.082%2015H1.918a1.75%201.75%200%200%201-1.543-2.575Zm1.763.707a.25.25%200%200%200-.44%200L1.698%2013.132a.25.25%200%200%200%20.22.368h12.164a.25.25%200%200%200%20.22-.368Zm.53%203.996v2.5a.75.75%200%200%201-1.5%200v-2.5a.75.75%200%200%201%201.5%200M9%2011a1%201%200%201%201-2%200%201%201%200%200%201%202%200%22/%3E%3C/svg%3E');--md-admonition-icon--failure:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2.344%202.343za8%208%200%200%201%2011.314%2011.314A8.002%208.002%200%200%201%20.234%2010.089a8%208%200%200%201%202.11-7.746m1.06%2010.253a6.5%206.5%200%201%200%209.108-9.275%206.5%206.5%200%200%200-9.108%209.275M6.03%204.97%208%206.94l1.97-1.97a.749.749%200%200%201%201.275.326.75.75%200%200%201-.215.734L9.06%208l1.97%201.97a.749.749%200%200%201-.326%201.275.75.75%200%200%201-.734-.215L8%209.06l-1.97%201.97a.749.749%200%200%201-1.275-.326.75.75%200%200%201%20.215-.734L6.94%208%204.97%206.03a.75.75%200%200%201%20.018-1.042.75.75%200%200%201%201.042-.018%22/%3E%3C/svg%3E');--md-admonition-icon--danger:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M9.504.43a1.516%201.516%200%200%201%202.437%201.713L10.415%205.5h2.123c1.57%200%202.346%201.909%201.22%203.004l-7.34%207.142a1.25%201.25%200%200%201-.871.354h-.302a1.25%201.25%200%200%201-1.157-1.723L5.633%2010.5H3.462c-1.57%200-2.346-1.909-1.22-3.004zm1.047%201.074L3.286%208.571A.25.25%200%200%200%203.462%209H6.75a.75.75%200%200%201%20.694%201.034l-1.713%204.188%206.982-6.793A.25.25%200%200%200%2012.538%207H9.25a.75.75%200%200%201-.683-1.06l2.008-4.418.003-.006-.004-.009-.006-.006-.008-.001q-.005%200-.009.004%22/%3E%3C/svg%3E');--md-admonition-icon--bug:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M4.72.22a.75.75%200%200%201%201.06%200l1%20.999a3.5%203.5%200%200%201%202.441%200l.999-1a.748.748%200%200%201%201.265.332.75.75%200%200%201-.205.729l-.775.776c.616.63.995%201.493.995%202.444v.327q0%20.15-.025.292c.408.14.764.392%201.029.722l1.968-.787a.75.75%200%200%201%20.556%201.392L13%207.258V9h2.25a.75.75%200%200%201%200%201.5H13v.5q-.002.615-.141%201.186l2.17.868a.75.75%200%200%201-.557%201.392l-2.184-.873A5%205%200%200%201%208%2016a5%205%200%200%201-4.288-2.427l-2.183.873a.75.75%200%200%201-.558-1.392l2.17-.868A5%205%200%200%201%203%2011v-.5H.75a.75.75%200%200%201%200-1.5H3V7.258L.971%206.446a.75.75%200%200%201%20.558-1.392l1.967.787c.265-.33.62-.583%201.03-.722a1.7%201.7%200%200%201-.026-.292V4.5c0-.951.38-1.814.995-2.444L4.72%201.28a.75.75%200%200%201%200-1.06m.53%206.28a.75.75%200%200%200-.75.75V11a3.5%203.5%200%201%200%207%200V7.25a.75.75%200%200%200-.75-.75ZM6.173%205h3.654A.17.17%200%200%200%2010%204.827V4.5a2%202%200%201%200-4%200v.327c0%20.096.077.173.173.173%22/%3E%3C/svg%3E');--md-admonition-icon--example:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5%205.782V2.5h-.25a.75.75%200%200%201%200-1.5h6.5a.75.75%200%200%201%200%201.5H11v3.282l3.666%205.76C15.619%2013.04%2014.543%2015%2012.767%2015H3.233c-1.776%200-2.852-1.96-1.899-3.458Zm-2.4%206.565a.75.75%200%200%200%20.633%201.153h9.534a.75.75%200%200%200%20.633-1.153L12.225%2010.5h-8.45ZM9.5%202.5h-3V6c0%20.143-.04.283-.117.403L4.73%209h6.54L9.617%206.403A.75.75%200%200%201%209.5%206Z%22/%3E%3C/svg%3E');--md-admonition-icon--quote:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M1.75%202.5h10.5a.75.75%200%200%201%200%201.5H1.75a.75.75%200%200%201%200-1.5m4%205h8.5a.75.75%200%200%201%200%201.5h-8.5a.75.75%200%200%201%200-1.5m0%205h8.5a.75.75%200%200%201%200%201.5h-8.5a.75.75%200%200%201%200-1.5M2.5%207.75v6a.75.75%200%200%201-1.5%200v-6a.75.75%200%200%201%201.5%200%22/%3E%3C/svg%3E');}</style><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Inter";--md-code-font:"JetBrains Mono"}</style><link rel=stylesheet href=../../../../../css/timeago.css><link rel=stylesheet href=../../../../../assets/_mkdocstrings.css><link rel=stylesheet href=../../../../../styles/variables.css><link rel=stylesheet href=../../../../../styles/header.css><link rel=stylesheet href=../../../../../styles/buttons.css><link rel=stylesheet href=../../../../../styles/cards.css><link rel=stylesheet href=../../../../../styles/footer.css><link rel=stylesheet href=../../../../../styles/animations.css><link rel=stylesheet href=../../../../../styles/hero.css><link rel=stylesheet href=../../../../../styles/terminal.css><link rel=stylesheet href=../../../../../styles/back-to-top.css><link rel=stylesheet href=../../../../../styles/image-modal.css><link rel=stylesheet href=../../../../../styles/mobile.css><link rel=stylesheet href=../../../../../styles/victorian.css><link rel=stylesheet href=../../../../../styles/neumorphic.css><link rel=stylesheet href=../../../../../styles/see-it-in-action.css><link rel=stylesheet href=../../../../../styles/toast.css><link rel=stylesheet href=../../../../../styles/overrides.css><script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config",""),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script><meta name=description content="MCP server for AI coding assistants. Native integration with Cursor, Claude, Windsurf. Intelligent code context via Model Context Protocol."><meta name=keywords content="tenets, MCP server, Model Context Protocol, code context, AI programming, LLM tools, developer tools, Cursor integration, Claude Desktop, AI coding assistant, codebase context, Windsurf, AI agent tools, prompt engineering, RAG, code analysis, semantic search, Python CLI"><meta name=author content="Johnny Dunn, manic.agency"><meta name=robots content="index, follow, max-image-preview:large"><link href=https://tenets.dev/dev/api/tenets/core/instiller/instiller/ rel=canonical><meta property=og:title content="instiller - Tenets"><meta property=og:description content="MCP server for AI coding assistants. Native integration with Cursor, Claude, Windsurf. Intelligent code context via Model Context Protocol."><meta property=og:type content=website><meta content=https://tenets.dev/dev/api/tenets/core/instiller/instiller/ property=og:url><meta property=og:image content=https://tenets.dev/dev/logos/tenets_dark_icon_transparent_cropped.png><meta name=twitter:card content=summary_large_image><meta name=twitter:title content="instiller - Tenets"><meta name=twitter:description content="MCP server for AI coding assistants. Native integration with Cursor, Claude, Windsurf. Intelligent code context via Model Context Protocol."><meta name=twitter:image content=https://tenets.dev/dev/logos/tenets_dark_icon_transparent_cropped.png><meta name=twitter:site content=@manicagency><meta name=twitter:creator content=@manicagency><link rel=apple-touch-icon sizes=180x180 href=favicon/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=favicon/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=favicon/favicon-16x16.png><link rel=manifest href=../../../../../favicon/site.webmanifest><script type=application/ld+json>
  {
    "@context": "https://schema.org",
    "@type": "SoftwareApplication",
    "name": "Tenets",
    "alternateName": "Tenets MCP Server",
    "description": "MCP server for AI coding assistants. Native integration with Cursor, Claude, Windsurf. Intelligent code context via Model Context Protocol.",
    "url": "https://tenets.dev",
    "applicationCategory": "DeveloperApplication",
    "operatingSystem": "Windows, macOS, Linux",
    "softwareVersion": "0.5.0",
    "programmingLanguage": "Python",
    "downloadUrl": "https://pypi.org/project/tenets/",
    "installUrl": "https://pypi.org/project/tenets/",
    "screenshot": "https://tenets.dev/logos/tenets_dark_icon_transparent_cropped.png",
    "featureList": [
      "Model Context Protocol (MCP) server",
      "Intelligent code context aggregation",
      "Multi-factor relevance ranking",
      "Token-optimized output",
      "Session management",
      "Integration with Cursor, Claude, Windsurf"
    ],
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "USD"
    },
    "author": {
      "@type": "Organization",
      "name": "manic.agency",
      "url": "https://manic.agency",
      "email": "team@manic.agency"
    },
    "maintainer": {
      "@type": "Person",
      "name": "Johnny Dunn",
      "url": "https://jddunn.github.io"
    },
    "license": "https://opensource.org/licenses/MIT",
    "sameAs": [
      "https://github.com/jddunn/tenets",
      "https://pypi.org/project/tenets/"
    ]
  }
  </script><script type=application/ld+json>
  {
    "@context": "https://schema.org",
    "@type": "Organization",
    "name": "manic.agency",
    "url": "https://manic.agency",
    "logo": "https://manic.agency/logo.png",
    "email": "team@manic.agency",
    "sameAs": [
      "https://twitter.com/manicagency",
      "https://github.com/jddunn"
    ]
  }
  </script></head><body dir=ltr data-md-color-scheme=default data-md-color-primary=custom data-md-color-accent=amber><input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off><input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off><label class=md-overlay for=__drawer></label><div data-md-component=skip><a href=#instiller class=md-skip> Skip to content </a></div><div data-md-component=announce></div><header class="md-header md-header--shadow md-header--lifted" data-md-component=header><nav class="md-header__inner md-grid" aria-label=Header><a href=../../../../.. title=Tenets class="md-header__button md-logo" aria-label=Tenets data-md-component=logo><a href=../../../../.. title=Tenets class="md-header__button md-logo" aria-label=Home><img src=../../../../../logos/tenets_dark_icon_transparent.png alt=Tenets class=dark-logo loading=lazy><img src=../../../../../logos/tenets_light_icon_transparent.png alt=Tenets class=light-logo loading=lazy></a></a><label class="md-header__button md-icon" for=__drawer><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg></label><div class=md-header__title data-md-component=header-title><div class=md-header__ellipsis><div class=md-header__topic><span class=md-ellipsis> Tenets </span></div><div class=md-header__topic data-md-component=header-topic><span class=md-ellipsis> instiller </span></div></div></div><form class=md-header__option data-md-component=palette><input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=custom data-md-color-accent=amber aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0><label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg></label><input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=custom data-md-color-accent=amber aria-label="Switch to light mode" type=radio name=__palette id=__palette_1><label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg></label></form><script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script><label class="md-header__button md-icon" for=__search><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg></label><div class=md-search data-md-component=search role=dialog><label class=md-search__overlay for=__search></label><div class=md-search__inner role=search><form class=md-search__form name=search><input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required><label class="md-search__icon md-icon" for=__search><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg></label><nav class=md-search__options aria-label=Search><a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg></a><button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg></button></nav><div class=md-search__suggest data-md-component=search-suggest></div></form><div class=md-search__output><div class=md-search__scrollwrap tabindex=0 data-md-scrollfix><div class=md-search-result data-md-component=search-result><div class=md-search-result__meta> Initializing search </div><ol class=md-search-result__list role=presentation></ol></div></div></div></div></div><div class=md-header__source><a href=https://github.com/jddunn/tenets title="Go to repository" class=md-source data-md-component=source><div class="md-source__icon md-icon"><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg></div><div class=md-source__repository> jddunn/tenets </div></a></div></nav><nav class=md-tabs aria-label=Tabs data-md-component=tabs><div class=md-grid><ul class=md-tabs__list><li class=md-tabs__item><a href=../../../../../quickstart/ class=md-tabs__link> Getting Started </a></li><li class=md-tabs__item><a href=../../../../../CLI/ class=md-tabs__link> User Guide </a></li><li class=md-tabs__item><a href=../../../../../ARCHITECTURE/ class=md-tabs__link> Architecture </a></li><li class="md-tabs__item md-tabs__item--active"><a href=../../../../ class=md-tabs__link> API Reference </a></li><li class=md-tabs__item><a href=../../../../../blog/ class=md-tabs__link> Blog </a></li><li class=md-tabs__item><a href=../../../../../about/ class=md-tabs__link> About </a></li><li class=md-tabs__item><a href=../../../../../faq/ class=md-tabs__link> FAQ </a></li><li class=md-tabs__item><a href=../../../../../enterprise/ class=md-tabs__link> Enterprise </a></li><li class=md-tabs__item><a href=../../../../../privacy/ class=md-tabs__link> Legal </a></li></ul></div></nav></header><div class=md-container data-md-component=container><main class=md-main data-md-component=main><div class="md-main__inner md-grid"><div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation><div class=md-sidebar__scrollwrap><div class=md-sidebar__inner><nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0><label class=md-nav__title for=__drawer><a href=../../../../.. title=Tenets class="md-nav__button md-logo" aria-label=Tenets data-md-component=logo><a href=../../../../.. title=Tenets class="md-header__button md-logo" aria-label=Home><img src=../../../../../logos/tenets_dark_icon_transparent.png alt=Tenets class=dark-logo loading=lazy><img src=../../../../../logos/tenets_light_icon_transparent.png alt=Tenets class=light-logo loading=lazy></a></a> Tenets </label><div class=md-nav__source><a href=https://github.com/jddunn/tenets title="Go to repository" class=md-source data-md-component=source><div class="md-source__icon md-icon"><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg></div><div class=md-source__repository> jddunn/tenets </div></a></div><ul class=md-nav__list data-md-scrollfix><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a href=../../../../../quickstart/ class=md-nav__link><span class=md-ellipsis> Getting Started </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a href=../../../../../CLI/ class=md-nav__link><span class=md-ellipsis> User Guide </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a href=../../../../../ARCHITECTURE/ class=md-nav__link><span class=md-ellipsis> Architecture </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"><input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4 checked><div class="md-nav__link md-nav__container"><a href=../../../../ class="md-nav__link "><span class=md-ellipsis> API Reference </span></a><label class="md-nav__link " for=__nav_4 id=__nav_4_label tabindex><span class="md-nav__icon md-icon"></span></label></div><nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=true><label class=md-nav__title for=__nav_4><span class="md-nav__icon md-icon"></span> API Reference </label><ul class=md-nav__list data-md-scrollfix><li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"><input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_2 checked><div class="md-nav__link md-nav__container"><a href=../../../ class="md-nav__link "><span class=md-ellipsis> tenets </span></a><label class="md-nav__link " for=__nav_4_2 id=__nav_4_2_label tabindex><span class="md-nav__icon md-icon"></span></label></div><nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_2_label aria-expanded=true><label class=md-nav__title for=__nav_4_2><span class="md-nav__icon md-icon"></span> tenets </label><ul class=md-nav__list data-md-scrollfix><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a href=../../../cli/app/ class=md-nav__link><span class=md-ellipsis> cli </span><span class="md-nav__icon md-icon"></span></a></li><li class=md-nav__item><a href=../../../config/ class=md-nav__link><span class=md-ellipsis> config </span></a></li><li class="md-nav__item md-nav__item--active md-nav__item--nested"><input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_2_3 checked><div class="md-nav__link md-nav__container"><a href=../../ class="md-nav__link "><span class=md-ellipsis> core </span></a><label class="md-nav__link " for=__nav_4_2_3 id=__nav_4_2_3_label tabindex=0><span class="md-nav__icon md-icon"></span></label></div><nav class=md-nav data-md-level=3 aria-labelledby=__nav_4_2_3_label aria-expanded=true><label class=md-nav__title for=__nav_4_2_3><span class="md-nav__icon md-icon"></span> core </label><ul class=md-nav__list data-md-scrollfix><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a href=../../analysis/analyzer/ class=md-nav__link><span class=md-ellipsis> analysis </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a href=../../distiller/aggregator/ class=md-nav__link><span class=md-ellipsis> distiller </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a href=../../examiner/complexity/ class=md-nav__link><span class=md-ellipsis> examiner </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a href=../../git/analyzer/ class=md-nav__link><span class=md-ellipsis> git </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--active md-nav__item--nested"><input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_2_3_5 checked><div class="md-nav__link md-nav__container"><a href=../ class="md-nav__link "><span class=md-ellipsis> instiller </span></a><label class="md-nav__link " for=__nav_4_2_3_5 id=__nav_4_2_3_5_label tabindex=0><span class="md-nav__icon md-icon"></span></label></div><nav class=md-nav data-md-level=4 aria-labelledby=__nav_4_2_3_5_label aria-expanded=true><label class=md-nav__title for=__nav_4_2_3_5><span class="md-nav__icon md-icon"></span> instiller </label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a href=../injector/ class=md-nav__link><span class=md-ellipsis> injector </span></a></li><li class="md-nav__item md-nav__item--active"><input class="md-nav__toggle md-toggle" type=checkbox id=__toc><label class="md-nav__link md-nav__link--active" for=__toc><span class=md-ellipsis> instiller </span><span class="md-nav__icon md-icon"></span></label><a href=./ class="md-nav__link md-nav__link--active"><span class=md-ellipsis> instiller </span></a><nav class="md-nav md-nav--secondary" aria-label="Table of contents"><label class=md-nav__title for=__toc><span class="md-nav__icon md-icon"></span> Table of contents </label><ul class=md-nav__list data-md-component=toc data-md-scrollfix><li class=md-nav__item><a href=#tenets.core.instiller.instiller class=md-nav__link><span class=md-ellipsis><code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;instiller </span></a><nav class=md-nav aria-label= instiller><ul class=md-nav__list><li class=md-nav__item><a href=#tenets.core.instiller.instiller-classes class=md-nav__link><span class=md-ellipsis> Classes </span></a></li><li class=md-nav__item><a href=#tenets.core.instiller.instiller-functions class=md-nav__link><span class=md-ellipsis> Functions </span></a></li></ul></nav></li></ul></nav></li><li class=md-nav__item><a href=../manager/ class=md-nav__link><span class=md-ellipsis> manager </span></a></li></ul></nav></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a href=../../momentum/metrics/ class=md-nav__link><span class=md-ellipsis> momentum </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a href=../../nlp/bm25/ class=md-nav__link><span class=md-ellipsis> nlp </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a href=../../prompt/cache/ class=md-nav__link><span class=md-ellipsis> prompt </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a href=../../ranking/factors/ class=md-nav__link><span class=md-ellipsis> ranking </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a href=../../reporting/generator/ class=md-nav__link><span class=md-ellipsis> reporting </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a href=../../session/session/ class=md-nav__link><span class=md-ellipsis> session </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a href=../../summarizer/llm/ class=md-nav__link><span class=md-ellipsis> summarizer </span><span class="md-nav__icon md-icon"></span></a></li></ul></nav></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a href=../../../mcp/server/ class=md-nav__link><span class=md-ellipsis> mcp </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a href=../../../models/analysis/ class=md-nav__link><span class=md-ellipsis> models </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a href=../../../storage/cache/ class=md-nav__link><span class=md-ellipsis> storage </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a href=../../../utils/external_sources/ class=md-nav__link><span class=md-ellipsis> utils </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a href=../../../viz/base/ class=md-nav__link><span class=md-ellipsis> viz </span><span class="md-nav__icon md-icon"></span></a></li></ul></nav></li></ul></nav></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a href=../../../../../blog/ class=md-nav__link><span class=md-ellipsis> Blog </span><span class="md-nav__icon md-icon"></span></a></li><li class=md-nav__item><a href=../../../../../about/ class=md-nav__link><span class=md-ellipsis> About </span></a></li><li class=md-nav__item><a href=../../../../../faq/ class=md-nav__link><span class=md-ellipsis> FAQ </span></a></li><li class=md-nav__item><a href=../../../../../enterprise/ class=md-nav__link><span class=md-ellipsis> Enterprise </span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a href=../../../../../privacy/ class=md-nav__link><span class=md-ellipsis> Legal </span><span class="md-nav__icon md-icon"></span></a></li></ul></nav></div></div></div><div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc><div class=md-sidebar__scrollwrap><div class=md-sidebar__inner><nav class="md-nav md-nav--secondary" aria-label="Table of contents"><label class=md-nav__title for=__toc><span class="md-nav__icon md-icon"></span> Table of contents </label><ul class=md-nav__list data-md-component=toc data-md-scrollfix><li class=md-nav__item><a href=#tenets.core.instiller.instiller class=md-nav__link><span class=md-ellipsis><code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;instiller </span></a><nav class=md-nav aria-label= instiller><ul class=md-nav__list><li class=md-nav__item><a href=#tenets.core.instiller.instiller-classes class=md-nav__link><span class=md-ellipsis> Classes </span></a></li><li class=md-nav__item><a href=#tenets.core.instiller.instiller-functions class=md-nav__link><span class=md-ellipsis> Functions </span></a></li></ul></nav></li></ul></nav></div></div></div><div class=md-content data-md-component=content><nav class=md-path aria-label=Navigation><ol class=md-path__list><li class=md-path__item><a href=../../../../ class=md-path__link><span class=md-ellipsis> API Reference </span></a></li><li class=md-path__item><a href=../../../cli/app/ class=md-path__link><span class=md-ellipsis> tenets </span></a></li><li class=md-path__item><a href=../../analysis/analyzer/ class=md-path__link><span class=md-ellipsis> core </span></a></li><li class=md-path__item><a href=../injector/ class=md-path__link><span class=md-ellipsis> instiller </span></a></li></ol></nav><article class="md-content__inner md-typeset"><h1 id=instiller><code>instiller</code><a class=headerlink href=#instiller title="Link to this section">&para;</a></h1><p><strong>Full name:</strong> <code>tenets.core.instiller.instiller</code></p><div class="doc doc-object doc-module"><h2 id=tenets.core.instiller.instiller class="doc doc-heading"><code class="doc-symbol doc-symbol-heading doc-symbol-module"></code> <span class="doc doc-object-name doc-module-name">instiller</span><a href=#tenets.core.instiller.instiller class=headerlink title="Link to this section">&para;</a></h2><div class="doc doc-contents first"><p>Instiller module - Orchestrates intelligent tenet injection into context.</p><p>This module provides the main Instiller class that manages the injection of guiding principles (tenets) into generated context. It supports various injection strategies including: - Always inject - Periodic injection (every Nth time) - Adaptive injection based on context complexity - Session-aware smart injection</p><p>The instiller tracks injection history, analyzes context complexity using NLP components, and adapts injection frequency based on session patterns.</p><div class="doc doc-children"><h3 id=tenets.core.instiller.instiller-classes>Classes<a href=#tenets.core.instiller.instiller-classes class=headerlink title="Link to this section">&para;</a></h3><div class="doc doc-object doc-class"><h4 id=tenets.core.instiller.instiller.InjectionHistory class="doc doc-heading"><code class="doc-symbol doc-symbol-heading doc-symbol-class"></code> <span class="doc doc-object-name doc-class-name">InjectionHistory</span><span class="doc doc-labels"><small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small></span><a href=#tenets.core.instiller.instiller.InjectionHistory class=headerlink title="Link to this section">&para;</a></h4><div class="language-python doc-signature highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>InjectionHistory</span><span class=p>(</span><span class=n>session_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>total_distills</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span> <span class=n>total_injections</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span> <span class=n>last_injection</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>datetime</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>last_injection_index</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span> <span class=n>complexity_scores</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>float</span><span class=p>]</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(),</span> <span class=n>injected_tenets</span><span class=p>:</span> <span class=n>Set</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=nb>set</span><span class=p>(),</span> <span class=n>reinforcement_count</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span> <span class=n>system_instruction_injected</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span> <span class=n>created_at</span><span class=p>:</span> <span class=n>datetime</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>(),</span> <span class=n>updated_at</span><span class=p>:</span> <span class=n>datetime</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>())</span>
</span></code></pre></div><div class="doc doc-contents "><p>Track injection history for a session.</p><table><thead><tr><th><span class=doc-section-title>ATTRIBUTE</span></th><th><span>DESCRIPTION</span></th></tr></thead><tbody><tr class=doc-section-item><td><code><span title=tenets.core.instiller.instiller.InjectionHistory.session_id>session_id</span></code></td><td class=doc-attribute-details><div class=doc-md-description><p>Session identifier</p></div><p><span class=doc-attribute-annotation><b>TYPE:</b><code><a class="autorefs autorefs-external" href=https://docs.python.org/3/library/stdtypes.html#str>str</a></code></span></p></td></tr><tr class=doc-section-item><td><code><span title=tenets.core.instiller.instiller.InjectionHistory.total_distills>total_distills</span></code></td><td class=doc-attribute-details><div class=doc-md-description><p>Total number of distill operations</p></div><p><span class=doc-attribute-annotation><b>TYPE:</b><code><a class="autorefs autorefs-external" href=https://docs.python.org/3/library/functions.html#int>int</a></code></span></p></td></tr><tr class=doc-section-item><td><code><span title=tenets.core.instiller.instiller.InjectionHistory.total_injections>total_injections</span></code></td><td class=doc-attribute-details><div class=doc-md-description><p>Total number of tenet injections</p></div><p><span class=doc-attribute-annotation><b>TYPE:</b><code><a class="autorefs autorefs-external" href=https://docs.python.org/3/library/functions.html#int>int</a></code></span></p></td></tr><tr class=doc-section-item><td><code><span title=tenets.core.instiller.instiller.InjectionHistory.last_injection>last_injection</span></code></td><td class=doc-attribute-details><div class=doc-md-description><p>Timestamp of last injection</p></div><p><span class=doc-attribute-annotation><b>TYPE:</b><code><a class="autorefs autorefs-external" title="<code>typing.Optional</code>" href=https://docs.python.org/3/library/typing.html#typing.Optional>Optional</a>[<a class="autorefs autorefs-external" title="<code>datetime.datetime</code>" href=https://docs.python.org/3/library/datetime.html#datetime.datetime>datetime</a>]</code></span></p></td></tr><tr class=doc-section-item><td><code><span title=tenets.core.instiller.instiller.InjectionHistory.last_injection_index>last_injection_index</span></code></td><td class=doc-attribute-details><div class=doc-md-description><p>Index of last injection (for periodic)</p></div><p><span class=doc-attribute-annotation><b>TYPE:</b><code><a class="autorefs autorefs-external" href=https://docs.python.org/3/library/functions.html#int>int</a></code></span></p></td></tr><tr class=doc-section-item><td><code><span title=tenets.core.instiller.instiller.InjectionHistory.complexity_scores>complexity_scores</span></code></td><td class=doc-attribute-details><div class=doc-md-description><p>List of context complexity scores</p></div><p><span class=doc-attribute-annotation><b>TYPE:</b><code><a class="autorefs autorefs-external" title="<code>typing.List</code>" href=https://docs.python.org/3/library/typing.html#typing.List>List</a>[<a class="autorefs autorefs-external" href=https://docs.python.org/3/library/functions.html#float>float</a>]</code></span></p></td></tr><tr class=doc-section-item><td><code><span title=tenets.core.instiller.instiller.InjectionHistory.injected_tenets>injected_tenets</span></code></td><td class=doc-attribute-details><div class=doc-md-description><p>Set of tenet IDs that have been injected</p></div><p><span class=doc-attribute-annotation><b>TYPE:</b><code><a class="autorefs autorefs-external" title="<code>typing.Set</code>" href=https://docs.python.org/3/library/typing.html#typing.Set>Set</a>[<a class="autorefs autorefs-external" href=https://docs.python.org/3/library/stdtypes.html#str>str</a>]</code></span></p></td></tr><tr class=doc-section-item><td><code><span title=tenets.core.instiller.instiller.InjectionHistory.reinforcement_count>reinforcement_count</span></code></td><td class=doc-attribute-details><div class=doc-md-description><p>Count of reinforcement injections</p></div><p><span class=doc-attribute-annotation><b>TYPE:</b><code><a class="autorefs autorefs-external" href=https://docs.python.org/3/library/functions.html#int>int</a></code></span></p></td></tr><tr class=doc-section-item><td><code><span title=tenets.core.instiller.instiller.InjectionHistory.created_at>created_at</span></code></td><td class=doc-attribute-details><div class=doc-md-description><p>When this history was created</p></div><p><span class=doc-attribute-annotation><b>TYPE:</b><code><a class="autorefs autorefs-external" title="<code>datetime.datetime</code>" href=https://docs.python.org/3/library/datetime.html#datetime.datetime>datetime</a></code></span></p></td></tr><tr class=doc-section-item><td><code><span title=tenets.core.instiller.instiller.InjectionHistory.updated_at>updated_at</span></code></td><td class=doc-attribute-details><div class=doc-md-description><p>Last update timestamp</p></div><p><span class=doc-attribute-annotation><b>TYPE:</b><code><a class="autorefs autorefs-external" title="<code>datetime.datetime</code>" href=https://docs.python.org/3/library/datetime.html#datetime.datetime>datetime</a></code></span></p></td></tr></tbody></table><div class="doc doc-children"><h5 id=tenets.core.instiller.instiller.InjectionHistory-functions>Functions<a href=#tenets.core.instiller.instiller.InjectionHistory-functions class=headerlink title="Link to this section">&para;</a></h5><div class="doc doc-object doc-function"><h6 id=tenets.core.instiller.instiller.InjectionHistory.should_inject class="doc doc-heading"><code class="doc-symbol doc-symbol-heading doc-symbol-method"></code> <span class="doc doc-object-name doc-function-name">should_inject</span><a href=#tenets.core.instiller.instiller.InjectionHistory.should_inject class=headerlink title="Link to this section">&para;</a></h6><div class="language-python doc-signature highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>should_inject</span><span class=p>(</span><span class=n>frequency</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>interval</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>complexity</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span> <span class=n>complexity_threshold</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span> <span class=n>min_session_length</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=nb>bool</span><span class=p>,</span> <span class=nb>str</span><span class=p>]</span>
</span></code></pre></div><div class="doc doc-contents "><p>Determine if tenets should be injected.</p><table><thead><tr><th><span class=doc-section-title>PARAMETER</span></th><th><span>DESCRIPTION</span></th></tr></thead><tbody><tr class=doc-section-item><td><code>frequency</code></td><td class=doc-param-details><div class=doc-md-description><p>Injection frequency mode</p></div><p><span class=doc-param-annotation><b>TYPE:</b><code><a class="autorefs autorefs-external" href=https://docs.python.org/3/library/stdtypes.html#str>str</a></code></span></p></td></tr><tr class=doc-section-item><td><code>interval</code></td><td class=doc-param-details><div class=doc-md-description><p>Injection interval for periodic mode</p></div><p><span class=doc-param-annotation><b>TYPE:</b><code><a class="autorefs autorefs-external" href=https://docs.python.org/3/library/functions.html#int>int</a></code></span></p></td></tr><tr class=doc-section-item><td><code>complexity</code></td><td class=doc-param-details><div class=doc-md-description><p>Current context complexity score</p></div><p><span class=doc-param-annotation><b>TYPE:</b><code><a class="autorefs autorefs-external" href=https://docs.python.org/3/library/functions.html#float>float</a></code></span></p></td></tr><tr class=doc-section-item><td><code>complexity_threshold</code></td><td class=doc-param-details><div class=doc-md-description><p>Threshold for complexity-based injection</p></div><p><span class=doc-param-annotation><b>TYPE:</b><code><a class="autorefs autorefs-external" href=https://docs.python.org/3/library/functions.html#float>float</a></code></span></p></td></tr><tr class=doc-section-item><td><code>min_session_length</code></td><td class=doc-param-details><div class=doc-md-description><p>Minimum session length before injection</p></div><p><span class=doc-param-annotation><b>TYPE:</b><code><a class="autorefs autorefs-external" href=https://docs.python.org/3/library/functions.html#int>int</a></code></span></p></td></tr></tbody></table><table><thead><tr><th><span class=doc-section-title>RETURNS</span></th><th><span>DESCRIPTION</span></th></tr></thead><tbody><tr class=doc-section-item><td><span class=doc-returns-annotation><code><a class="autorefs autorefs-external" title="<code>typing.Tuple</code>" href=https://docs.python.org/3/library/typing.html#typing.Tuple>Tuple</a>[<a class="autorefs autorefs-external" href=https://docs.python.org/3/library/functions.html#bool>bool</a>, <a class="autorefs autorefs-external" href=https://docs.python.org/3/library/stdtypes.html#str>str</a>]</code></span></td><td class=doc-returns-details><div class=doc-md-description><p>Tuple of (should_inject, reason)</p></div></td></tr></tbody></table><details class=mkdocstrings-source><summary>Source code in <code>tenets/core/instiller/instiller.py</code></summary><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-0-78><a id=__codelineno-0-78 name=__codelineno-0-78></a><a href=#__codelineno-0-78><span class=linenos data-linenos=" 78 "></span></a><span class=k>def</span><span class=w> </span><span class=nf>should_inject</span><span class=p>(</span>
</span><span id=__span-0-79><a id=__codelineno-0-79 name=__codelineno-0-79></a><a href=#__codelineno-0-79><span class=linenos data-linenos=" 79 "></span></a>    <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-80><a id=__codelineno-0-80 name=__codelineno-0-80></a><a href=#__codelineno-0-80><span class=linenos data-linenos=" 80 "></span></a>    <span class=n>frequency</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-81><a id=__codelineno-0-81 name=__codelineno-0-81></a><a href=#__codelineno-0-81><span class=linenos data-linenos=" 81 "></span></a>    <span class=n>interval</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span>
</span><span id=__span-0-82><a id=__codelineno-0-82 name=__codelineno-0-82></a><a href=#__codelineno-0-82><span class=linenos data-linenos=" 82 "></span></a>    <span class=n>complexity</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span>
</span><span id=__span-0-83><a id=__codelineno-0-83 name=__codelineno-0-83></a><a href=#__codelineno-0-83><span class=linenos data-linenos=" 83 "></span></a>    <span class=n>complexity_threshold</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span>
</span><span id=__span-0-84><a id=__codelineno-0-84 name=__codelineno-0-84></a><a href=#__codelineno-0-84><span class=linenos data-linenos=" 84 "></span></a>    <span class=n>min_session_length</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span>
</span><span id=__span-0-85><a id=__codelineno-0-85 name=__codelineno-0-85></a><a href=#__codelineno-0-85><span class=linenos data-linenos=" 85 "></span></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=nb>bool</span><span class=p>,</span> <span class=nb>str</span><span class=p>]:</span>
</span><span id=__span-0-86><a id=__codelineno-0-86 name=__codelineno-0-86></a><a href=#__codelineno-0-86><span class=linenos data-linenos=" 86 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Determine if tenets should be injected.</span>
</span><span id=__span-0-87><a id=__codelineno-0-87 name=__codelineno-0-87></a><a href=#__codelineno-0-87><span class=linenos data-linenos=" 87 "></span></a>
</span><span id=__span-0-88><a id=__codelineno-0-88 name=__codelineno-0-88></a><a href=#__codelineno-0-88><span class=linenos data-linenos=" 88 "></span></a><span class=sd>    Args:</span>
</span><span id=__span-0-89><a id=__codelineno-0-89 name=__codelineno-0-89></a><a href=#__codelineno-0-89><span class=linenos data-linenos=" 89 "></span></a><span class=sd>        frequency: Injection frequency mode</span>
</span><span id=__span-0-90><a id=__codelineno-0-90 name=__codelineno-0-90></a><a href=#__codelineno-0-90><span class=linenos data-linenos=" 90 "></span></a><span class=sd>        interval: Injection interval for periodic mode</span>
</span><span id=__span-0-91><a id=__codelineno-0-91 name=__codelineno-0-91></a><a href=#__codelineno-0-91><span class=linenos data-linenos=" 91 "></span></a><span class=sd>        complexity: Current context complexity score</span>
</span><span id=__span-0-92><a id=__codelineno-0-92 name=__codelineno-0-92></a><a href=#__codelineno-0-92><span class=linenos data-linenos=" 92 "></span></a><span class=sd>        complexity_threshold: Threshold for complexity-based injection</span>
</span><span id=__span-0-93><a id=__codelineno-0-93 name=__codelineno-0-93></a><a href=#__codelineno-0-93><span class=linenos data-linenos=" 93 "></span></a><span class=sd>        min_session_length: Minimum session length before injection</span>
</span><span id=__span-0-94><a id=__codelineno-0-94 name=__codelineno-0-94></a><a href=#__codelineno-0-94><span class=linenos data-linenos=" 94 "></span></a>
</span><span id=__span-0-95><a id=__codelineno-0-95 name=__codelineno-0-95></a><a href=#__codelineno-0-95><span class=linenos data-linenos=" 95 "></span></a><span class=sd>    Returns:</span>
</span><span id=__span-0-96><a id=__codelineno-0-96 name=__codelineno-0-96></a><a href=#__codelineno-0-96><span class=linenos data-linenos=" 96 "></span></a><span class=sd>        Tuple of (should_inject, reason)</span>
</span><span id=__span-0-97><a id=__codelineno-0-97 name=__codelineno-0-97></a><a href=#__codelineno-0-97><span class=linenos data-linenos=" 97 "></span></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-0-98><a id=__codelineno-0-98 name=__codelineno-0-98></a><a href=#__codelineno-0-98><span class=linenos data-linenos=" 98 "></span></a>    <span class=c1># Always inject mode</span>
</span><span id=__span-0-99><a id=__codelineno-0-99 name=__codelineno-0-99></a><a href=#__codelineno-0-99><span class=linenos data-linenos=" 99 "></span></a>    <span class=k>if</span> <span class=n>frequency</span> <span class=o>==</span> <span class=s2>&quot;always&quot;</span><span class=p>:</span>
</span><span id=__span-0-100><a id=__codelineno-0-100 name=__codelineno-0-100></a><a href=#__codelineno-0-100><span class=linenos data-linenos="100 "></span></a>        <span class=k>return</span> <span class=kc>True</span><span class=p>,</span> <span class=s2>&quot;always_mode&quot;</span>
</span><span id=__span-0-101><a id=__codelineno-0-101 name=__codelineno-0-101></a><a href=#__codelineno-0-101><span class=linenos data-linenos="101 "></span></a>
</span><span id=__span-0-102><a id=__codelineno-0-102 name=__codelineno-0-102></a><a href=#__codelineno-0-102><span class=linenos data-linenos="102 "></span></a>    <span class=c1># Manual mode - never auto-inject</span>
</span><span id=__span-0-103><a id=__codelineno-0-103 name=__codelineno-0-103></a><a href=#__codelineno-0-103><span class=linenos data-linenos="103 "></span></a>    <span class=k>if</span> <span class=n>frequency</span> <span class=o>==</span> <span class=s2>&quot;manual&quot;</span><span class=p>:</span>
</span><span id=__span-0-104><a id=__codelineno-0-104 name=__codelineno-0-104></a><a href=#__codelineno-0-104><span class=linenos data-linenos="104 "></span></a>        <span class=k>return</span> <span class=kc>False</span><span class=p>,</span> <span class=s2>&quot;manual_mode&quot;</span>
</span><span id=__span-0-105><a id=__codelineno-0-105 name=__codelineno-0-105></a><a href=#__codelineno-0-105><span class=linenos data-linenos="105 "></span></a>
</span><span id=__span-0-106><a id=__codelineno-0-106 name=__codelineno-0-106></a><a href=#__codelineno-0-106><span class=linenos data-linenos="106 "></span></a>    <span class=c1># Periodic injection</span>
</span><span id=__span-0-107><a id=__codelineno-0-107 name=__codelineno-0-107></a><a href=#__codelineno-0-107><span class=linenos data-linenos="107 "></span></a>    <span class=k>if</span> <span class=n>frequency</span> <span class=o>==</span> <span class=s2>&quot;periodic&quot;</span><span class=p>:</span>
</span><span id=__span-0-108><a id=__codelineno-0-108 name=__codelineno-0-108></a><a href=#__codelineno-0-108><span class=linenos data-linenos="108 "></span></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>total_distills</span> <span class=o>%</span> <span class=n>interval</span> <span class=o>==</span> <span class=mi>0</span> <span class=ow>and</span> <span class=bp>self</span><span class=o>.</span><span class=n>total_distills</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span><span id=__span-0-109><a id=__codelineno-0-109 name=__codelineno-0-109></a><a href=#__codelineno-0-109><span class=linenos data-linenos="109 "></span></a>            <span class=k>return</span> <span class=kc>True</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&quot;periodic_interval_</span><span class=si>{</span><span class=n>interval</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-110><a id=__codelineno-0-110 name=__codelineno-0-110></a><a href=#__codelineno-0-110><span class=linenos data-linenos="110 "></span></a>        <span class=k>return</span> <span class=kc>False</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&quot;not_at_interval_</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>total_distills</span><span class=w> </span><span class=o>%</span><span class=w> </span><span class=n>interval</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=n>interval</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-111><a id=__codelineno-0-111 name=__codelineno-0-111></a><a href=#__codelineno-0-111><span class=linenos data-linenos="111 "></span></a>
</span><span id=__span-0-112><a id=__codelineno-0-112 name=__codelineno-0-112></a><a href=#__codelineno-0-112><span class=linenos data-linenos="112 "></span></a>    <span class=c1># Adaptive injection</span>
</span><span id=__span-0-113><a id=__codelineno-0-113 name=__codelineno-0-113></a><a href=#__codelineno-0-113><span class=linenos data-linenos="113 "></span></a>    <span class=k>if</span> <span class=n>frequency</span> <span class=o>==</span> <span class=s2>&quot;adaptive&quot;</span><span class=p>:</span>
</span><span id=__span-0-114><a id=__codelineno-0-114 name=__codelineno-0-114></a><a href=#__codelineno-0-114><span class=linenos data-linenos="114 "></span></a>        <span class=c1># Special case: first distill with high complexity gets injection</span>
</span><span id=__span-0-115><a id=__codelineno-0-115 name=__codelineno-0-115></a><a href=#__codelineno-0-115><span class=linenos data-linenos="115 "></span></a>        <span class=c1># This ensures important context is established early</span>
</span><span id=__span-0-116><a id=__codelineno-0-116 name=__codelineno-0-116></a><a href=#__codelineno-0-116><span class=linenos data-linenos="116 "></span></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>total_distills</span> <span class=o>==</span> <span class=mi>1</span> <span class=ow>and</span> <span class=bp>self</span><span class=o>.</span><span class=n>total_injections</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span><span id=__span-0-117><a id=__codelineno-0-117 name=__codelineno-0-117></a><a href=#__codelineno-0-117><span class=linenos data-linenos="117 "></span></a>            <span class=k>if</span> <span class=n>complexity</span> <span class=o>&gt;=</span> <span class=n>complexity_threshold</span><span class=p>:</span>
</span><span id=__span-0-118><a id=__codelineno-0-118 name=__codelineno-0-118></a><a href=#__codelineno-0-118><span class=linenos data-linenos="118 "></span></a>                <span class=k>return</span> <span class=kc>True</span><span class=p>,</span> <span class=s2>&quot;first_distill_in_session&quot;</span>
</span><span id=__span-0-119><a id=__codelineno-0-119 name=__codelineno-0-119></a><a href=#__codelineno-0-119><span class=linenos data-linenos="119 "></span></a>
</span><span id=__span-0-120><a id=__codelineno-0-120 name=__codelineno-0-120></a><a href=#__codelineno-0-120><span class=linenos data-linenos="120 "></span></a>        <span class=c1># After first distill, respect minimum session length</span>
</span><span id=__span-0-121><a id=__codelineno-0-121 name=__codelineno-0-121></a><a href=#__codelineno-0-121><span class=linenos data-linenos="121 "></span></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>total_distills</span> <span class=o>&lt;</span> <span class=n>min_session_length</span><span class=p>:</span>
</span><span id=__span-0-122><a id=__codelineno-0-122 name=__codelineno-0-122></a><a href=#__codelineno-0-122><span class=linenos data-linenos="122 "></span></a>            <span class=k>return</span> <span class=kc>False</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&quot;session_too_short_</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>total_distills</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=n>min_session_length</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-123><a id=__codelineno-0-123 name=__codelineno-0-123></a><a href=#__codelineno-0-123><span class=linenos data-linenos="123 "></span></a>
</span><span id=__span-0-124><a id=__codelineno-0-124 name=__codelineno-0-124></a><a href=#__codelineno-0-124><span class=linenos data-linenos="124 "></span></a>        <span class=c1># Complexity-based injection</span>
</span><span id=__span-0-125><a id=__codelineno-0-125 name=__codelineno-0-125></a><a href=#__codelineno-0-125><span class=linenos data-linenos="125 "></span></a>        <span class=k>if</span> <span class=n>complexity</span> <span class=o>&gt;=</span> <span class=n>complexity_threshold</span><span class=p>:</span>
</span><span id=__span-0-126><a id=__codelineno-0-126 name=__codelineno-0-126></a><a href=#__codelineno-0-126><span class=linenos data-linenos="126 "></span></a>            <span class=c1># Check if we&#39;ve injected recently</span>
</span><span id=__span-0-127><a id=__codelineno-0-127 name=__codelineno-0-127></a><a href=#__codelineno-0-127><span class=linenos data-linenos="127 "></span></a>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>last_injection</span><span class=p>:</span>
</span><span id=__span-0-128><a id=__codelineno-0-128 name=__codelineno-0-128></a><a href=#__codelineno-0-128><span class=linenos data-linenos="128 "></span></a>                <span class=n>time_since_last</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span> <span class=o>-</span> <span class=bp>self</span><span class=o>.</span><span class=n>last_injection</span>
</span><span id=__span-0-129><a id=__codelineno-0-129 name=__codelineno-0-129></a><a href=#__codelineno-0-129><span class=linenos data-linenos="129 "></span></a>                <span class=k>if</span> <span class=n>time_since_last</span> <span class=o>&lt;</span> <span class=n>timedelta</span><span class=p>(</span><span class=n>minutes</span><span class=o>=</span><span class=mi>5</span><span class=p>):</span>
</span><span id=__span-0-130><a id=__codelineno-0-130 name=__codelineno-0-130></a><a href=#__codelineno-0-130><span class=linenos data-linenos="130 "></span></a>                    <span class=k>return</span> <span class=kc>False</span><span class=p>,</span> <span class=s2>&quot;injected_recently&quot;</span>
</span><span id=__span-0-131><a id=__codelineno-0-131 name=__codelineno-0-131></a><a href=#__codelineno-0-131><span class=linenos data-linenos="131 "></span></a>            <span class=k>return</span> <span class=kc>True</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&quot;high_complexity_</span><span class=si>{</span><span class=n>complexity</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-132><a id=__codelineno-0-132 name=__codelineno-0-132></a><a href=#__codelineno-0-132><span class=linenos data-linenos="132 "></span></a>
</span><span id=__span-0-133><a id=__codelineno-0-133 name=__codelineno-0-133></a><a href=#__codelineno-0-133><span class=linenos data-linenos="133 "></span></a>        <span class=c1># Check for reinforcement interval</span>
</span><span id=__span-0-134><a id=__codelineno-0-134 name=__codelineno-0-134></a><a href=#__codelineno-0-134><span class=linenos data-linenos="134 "></span></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>total_injections</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span><span id=__span-0-135><a id=__codelineno-0-135 name=__codelineno-0-135></a><a href=#__codelineno-0-135><span class=linenos data-linenos="135 "></span></a>            <span class=n>injections_since_last</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>total_distills</span> <span class=o>-</span> <span class=bp>self</span><span class=o>.</span><span class=n>last_injection_index</span>
</span><span id=__span-0-136><a id=__codelineno-0-136 name=__codelineno-0-136></a><a href=#__codelineno-0-136><span class=linenos data-linenos="136 "></span></a>            <span class=k>if</span> <span class=n>injections_since_last</span> <span class=o>&gt;=</span> <span class=n>interval</span> <span class=o>*</span> <span class=mi>2</span><span class=p>:</span>  <span class=c1># Double interval for adaptive</span>
</span><span id=__span-0-137><a id=__codelineno-0-137 name=__codelineno-0-137></a><a href=#__codelineno-0-137><span class=linenos data-linenos="137 "></span></a>                <span class=k>return</span> <span class=kc>True</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&quot;reinforcement_needed_</span><span class=si>{</span><span class=n>injections_since_last</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-138><a id=__codelineno-0-138 name=__codelineno-0-138></a><a href=#__codelineno-0-138><span class=linenos data-linenos="138 "></span></a>
</span><span id=__span-0-139><a id=__codelineno-0-139 name=__codelineno-0-139></a><a href=#__codelineno-0-139><span class=linenos data-linenos="139 "></span></a>    <span class=k>return</span> <span class=kc>False</span><span class=p>,</span> <span class=s2>&quot;no_injection_criteria_met&quot;</span>
</span></code></pre></div></details></div></div><div class="doc doc-object doc-function"><h6 id=tenets.core.instiller.instiller.InjectionHistory.record_injection class="doc doc-heading"><code class="doc-symbol doc-symbol-heading doc-symbol-method"></code> <span class="doc doc-object-name doc-function-name">record_injection</span><a href=#tenets.core.instiller.instiller.InjectionHistory.record_injection class=headerlink title="Link to this section">&para;</a></h6><div class="language-python doc-signature highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>record_injection</span><span class=p>(</span><span class=n>tenets</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Tenet</span><span class=p>],</span> <span class=n>complexity</span><span class=p>:</span> <span class=nb>float</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span>
</span></code></pre></div><div class="doc doc-contents "><p>Record that an injection occurred.</p><table><thead><tr><th><span class=doc-section-title>PARAMETER</span></th><th><span>DESCRIPTION</span></th></tr></thead><tbody><tr class=doc-section-item><td><code>tenets</code></td><td class=doc-param-details><div class=doc-md-description><p>List of tenets that were injected</p></div><p><span class=doc-param-annotation><b>TYPE:</b><code><a class="autorefs autorefs-external" title="<code>typing.List</code>" href=https://docs.python.org/3/library/typing.html#typing.List>List</a>[<a class="autorefs autorefs-internal" title='<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">Tenet</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span> (<code>tenets.models.tenet.Tenet</code>)' href=../../../models/tenet/#tenets.models.tenet.Tenet>Tenet</a>]</code></span></p></td></tr><tr class=doc-section-item><td><code>complexity</code></td><td class=doc-param-details><div class=doc-md-description><p>Complexity score of the context</p></div><p><span class=doc-param-annotation><b>TYPE:</b><code><a class="autorefs autorefs-external" href=https://docs.python.org/3/library/functions.html#float>float</a></code></span></p></td></tr></tbody></table><details class=mkdocstrings-source><summary>Source code in <code>tenets/core/instiller/instiller.py</code></summary><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-0-141><a id=__codelineno-0-141 name=__codelineno-0-141></a><a href=#__codelineno-0-141><span class=linenos data-linenos="141 "></span></a><span class=k>def</span><span class=w> </span><span class=nf>record_injection</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>tenets</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Tenet</span><span class=p>],</span> <span class=n>complexity</span><span class=p>:</span> <span class=nb>float</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-142><a id=__codelineno-0-142 name=__codelineno-0-142></a><a href=#__codelineno-0-142><span class=linenos data-linenos="142 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Record that an injection occurred.</span>
</span><span id=__span-0-143><a id=__codelineno-0-143 name=__codelineno-0-143></a><a href=#__codelineno-0-143><span class=linenos data-linenos="143 "></span></a>
</span><span id=__span-0-144><a id=__codelineno-0-144 name=__codelineno-0-144></a><a href=#__codelineno-0-144><span class=linenos data-linenos="144 "></span></a><span class=sd>    Args:</span>
</span><span id=__span-0-145><a id=__codelineno-0-145 name=__codelineno-0-145></a><a href=#__codelineno-0-145><span class=linenos data-linenos="145 "></span></a><span class=sd>        tenets: List of tenets that were injected</span>
</span><span id=__span-0-146><a id=__codelineno-0-146 name=__codelineno-0-146></a><a href=#__codelineno-0-146><span class=linenos data-linenos="146 "></span></a><span class=sd>        complexity: Complexity score of the context</span>
</span><span id=__span-0-147><a id=__codelineno-0-147 name=__codelineno-0-147></a><a href=#__codelineno-0-147><span class=linenos data-linenos="147 "></span></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-0-148><a id=__codelineno-0-148 name=__codelineno-0-148></a><a href=#__codelineno-0-148><span class=linenos data-linenos="148 "></span></a>    <span class=bp>self</span><span class=o>.</span><span class=n>total_injections</span> <span class=o>+=</span> <span class=mi>1</span>
</span><span id=__span-0-149><a id=__codelineno-0-149 name=__codelineno-0-149></a><a href=#__codelineno-0-149><span class=linenos data-linenos="149 "></span></a>    <span class=bp>self</span><span class=o>.</span><span class=n>last_injection</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span>
</span><span id=__span-0-150><a id=__codelineno-0-150 name=__codelineno-0-150></a><a href=#__codelineno-0-150><span class=linenos data-linenos="150 "></span></a>    <span class=bp>self</span><span class=o>.</span><span class=n>last_injection_index</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>total_distills</span>
</span><span id=__span-0-151><a id=__codelineno-0-151 name=__codelineno-0-151></a><a href=#__codelineno-0-151><span class=linenos data-linenos="151 "></span></a>    <span class=bp>self</span><span class=o>.</span><span class=n>complexity_scores</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>complexity</span><span class=p>)</span>
</span><span id=__span-0-152><a id=__codelineno-0-152 name=__codelineno-0-152></a><a href=#__codelineno-0-152><span class=linenos data-linenos="152 "></span></a>
</span><span id=__span-0-153><a id=__codelineno-0-153 name=__codelineno-0-153></a><a href=#__codelineno-0-153><span class=linenos data-linenos="153 "></span></a>    <span class=k>for</span> <span class=n>tenet</span> <span class=ow>in</span> <span class=n>tenets</span><span class=p>:</span>
</span><span id=__span-0-154><a id=__codelineno-0-154 name=__codelineno-0-154></a><a href=#__codelineno-0-154><span class=linenos data-linenos="154 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>injected_tenets</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>tenet</span><span class=o>.</span><span class=n>id</span><span class=p>)</span>
</span><span id=__span-0-155><a id=__codelineno-0-155 name=__codelineno-0-155></a><a href=#__codelineno-0-155><span class=linenos data-linenos="155 "></span></a>
</span><span id=__span-0-156><a id=__codelineno-0-156 name=__codelineno-0-156></a><a href=#__codelineno-0-156><span class=linenos data-linenos="156 "></span></a>    <span class=bp>self</span><span class=o>.</span><span class=n>updated_at</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span>
</span></code></pre></div></details></div></div><div class="doc doc-object doc-function"><h6 id=tenets.core.instiller.instiller.InjectionHistory.get_stats class="doc doc-heading"><code class="doc-symbol doc-symbol-heading doc-symbol-method"></code> <span class="doc doc-object-name doc-function-name">get_stats</span><a href=#tenets.core.instiller.instiller.InjectionHistory.get_stats class=headerlink title="Link to this section">&para;</a></h6><div class="language-python doc-signature highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>get_stats</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span>
</span></code></pre></div><div class="doc doc-contents "><p>Get injection statistics for this session.</p><table><thead><tr><th><span class=doc-section-title>RETURNS</span></th><th><span>DESCRIPTION</span></th></tr></thead><tbody><tr class=doc-section-item><td><span class=doc-returns-annotation><code><a class="autorefs autorefs-external" title="<code>typing.Dict</code>" href=https://docs.python.org/3/library/typing.html#typing.Dict>Dict</a>[<a class="autorefs autorefs-external" href=https://docs.python.org/3/library/stdtypes.html#str>str</a>, <a class="autorefs autorefs-external" title="<code>typing.Any</code>" href=https://docs.python.org/3/library/typing.html#typing.Any>Any</a>]</code></span></td><td class=doc-returns-details><div class=doc-md-description><p>Dictionary of statistics</p></div></td></tr></tbody></table><details class=mkdocstrings-source><summary>Source code in <code>tenets/core/instiller/instiller.py</code></summary><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-0-158><a id=__codelineno-0-158 name=__codelineno-0-158></a><a href=#__codelineno-0-158><span class=linenos data-linenos="158 "></span></a><span class=k>def</span><span class=w> </span><span class=nf>get_stats</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span><span id=__span-0-159><a id=__codelineno-0-159 name=__codelineno-0-159></a><a href=#__codelineno-0-159><span class=linenos data-linenos="159 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Get injection statistics for this session.</span>
</span><span id=__span-0-160><a id=__codelineno-0-160 name=__codelineno-0-160></a><a href=#__codelineno-0-160><span class=linenos data-linenos="160 "></span></a>
</span><span id=__span-0-161><a id=__codelineno-0-161 name=__codelineno-0-161></a><a href=#__codelineno-0-161><span class=linenos data-linenos="161 "></span></a><span class=sd>    Returns:</span>
</span><span id=__span-0-162><a id=__codelineno-0-162 name=__codelineno-0-162></a><a href=#__codelineno-0-162><span class=linenos data-linenos="162 "></span></a><span class=sd>        Dictionary of statistics</span>
</span><span id=__span-0-163><a id=__codelineno-0-163 name=__codelineno-0-163></a><a href=#__codelineno-0-163><span class=linenos data-linenos="163 "></span></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-0-164><a id=__codelineno-0-164 name=__codelineno-0-164></a><a href=#__codelineno-0-164><span class=linenos data-linenos="164 "></span></a>    <span class=n>avg_complexity</span> <span class=o>=</span> <span class=p>(</span>
</span><span id=__span-0-165><a id=__codelineno-0-165 name=__codelineno-0-165></a><a href=#__codelineno-0-165><span class=linenos data-linenos="165 "></span></a>        <span class=nb>sum</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>complexity_scores</span><span class=p>)</span> <span class=o>/</span> <span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>complexity_scores</span><span class=p>)</span>
</span><span id=__span-0-166><a id=__codelineno-0-166 name=__codelineno-0-166></a><a href=#__codelineno-0-166><span class=linenos data-linenos="166 "></span></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>complexity_scores</span>
</span><span id=__span-0-167><a id=__codelineno-0-167 name=__codelineno-0-167></a><a href=#__codelineno-0-167><span class=linenos data-linenos="167 "></span></a>        <span class=k>else</span> <span class=mf>0.0</span>
</span><span id=__span-0-168><a id=__codelineno-0-168 name=__codelineno-0-168></a><a href=#__codelineno-0-168><span class=linenos data-linenos="168 "></span></a>    <span class=p>)</span>
</span><span id=__span-0-169><a id=__codelineno-0-169 name=__codelineno-0-169></a><a href=#__codelineno-0-169><span class=linenos data-linenos="169 "></span></a>
</span><span id=__span-0-170><a id=__codelineno-0-170 name=__codelineno-0-170></a><a href=#__codelineno-0-170><span class=linenos data-linenos="170 "></span></a>    <span class=n>injection_rate</span> <span class=o>=</span> <span class=p>(</span>
</span><span id=__span-0-171><a id=__codelineno-0-171 name=__codelineno-0-171></a><a href=#__codelineno-0-171><span class=linenos data-linenos="171 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>total_injections</span> <span class=o>/</span> <span class=bp>self</span><span class=o>.</span><span class=n>total_distills</span> <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>total_distills</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=k>else</span> <span class=mf>0.0</span>
</span><span id=__span-0-172><a id=__codelineno-0-172 name=__codelineno-0-172></a><a href=#__codelineno-0-172><span class=linenos data-linenos="172 "></span></a>    <span class=p>)</span>
</span><span id=__span-0-173><a id=__codelineno-0-173 name=__codelineno-0-173></a><a href=#__codelineno-0-173><span class=linenos data-linenos="173 "></span></a>
</span><span id=__span-0-174><a id=__codelineno-0-174 name=__codelineno-0-174></a><a href=#__codelineno-0-174><span class=linenos data-linenos="174 "></span></a>    <span class=k>return</span> <span class=p>{</span>
</span><span id=__span-0-175><a id=__codelineno-0-175 name=__codelineno-0-175></a><a href=#__codelineno-0-175><span class=linenos data-linenos="175 "></span></a>        <span class=s2>&quot;session_id&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>session_id</span><span class=p>,</span>
</span><span id=__span-0-176><a id=__codelineno-0-176 name=__codelineno-0-176></a><a href=#__codelineno-0-176><span class=linenos data-linenos="176 "></span></a>        <span class=s2>&quot;total_distills&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>total_distills</span><span class=p>,</span>
</span><span id=__span-0-177><a id=__codelineno-0-177 name=__codelineno-0-177></a><a href=#__codelineno-0-177><span class=linenos data-linenos="177 "></span></a>        <span class=s2>&quot;total_injections&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>total_injections</span><span class=p>,</span>
</span><span id=__span-0-178><a id=__codelineno-0-178 name=__codelineno-0-178></a><a href=#__codelineno-0-178><span class=linenos data-linenos="178 "></span></a>        <span class=s2>&quot;injection_rate&quot;</span><span class=p>:</span> <span class=n>injection_rate</span><span class=p>,</span>
</span><span id=__span-0-179><a id=__codelineno-0-179 name=__codelineno-0-179></a><a href=#__codelineno-0-179><span class=linenos data-linenos="179 "></span></a>        <span class=s2>&quot;average_complexity&quot;</span><span class=p>:</span> <span class=n>avg_complexity</span><span class=p>,</span>
</span><span id=__span-0-180><a id=__codelineno-0-180 name=__codelineno-0-180></a><a href=#__codelineno-0-180><span class=linenos data-linenos="180 "></span></a>        <span class=s2>&quot;unique_tenets_injected&quot;</span><span class=p>:</span> <span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>injected_tenets</span><span class=p>),</span>
</span><span id=__span-0-181><a id=__codelineno-0-181 name=__codelineno-0-181></a><a href=#__codelineno-0-181><span class=linenos data-linenos="181 "></span></a>        <span class=s2>&quot;reinforcement_count&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>reinforcement_count</span><span class=p>,</span>
</span><span id=__span-0-182><a id=__codelineno-0-182 name=__codelineno-0-182></a><a href=#__codelineno-0-182><span class=linenos data-linenos="182 "></span></a>        <span class=s2>&quot;session_duration&quot;</span><span class=p>:</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>updated_at</span> <span class=o>-</span> <span class=bp>self</span><span class=o>.</span><span class=n>created_at</span><span class=p>)</span><span class=o>.</span><span class=n>total_seconds</span><span class=p>(),</span>
</span><span id=__span-0-183><a id=__codelineno-0-183 name=__codelineno-0-183></a><a href=#__codelineno-0-183><span class=linenos data-linenos="183 "></span></a>        <span class=s2>&quot;last_injection&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>last_injection</span><span class=o>.</span><span class=n>isoformat</span><span class=p>()</span> <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>last_injection</span> <span class=k>else</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-184><a id=__codelineno-0-184 name=__codelineno-0-184></a><a href=#__codelineno-0-184><span class=linenos data-linenos="184 "></span></a>    <span class=p>}</span>
</span></code></pre></div></details></div></div></div></div></div><div class="doc doc-object doc-class"><h4 id=tenets.core.instiller.instiller.InstillationResult class="doc doc-heading"><code class="doc-symbol doc-symbol-heading doc-symbol-class"></code> <span class="doc doc-object-name doc-class-name">InstillationResult</span><span class="doc doc-labels"><small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small></span><a href=#tenets.core.instiller.instiller.InstillationResult class=headerlink title="Link to this section">&para;</a></h4><div class="language-python doc-signature highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>InstillationResult</span><span class=p>(</span><span class=n>tenets_instilled</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Tenet</span><span class=p>],</span> <span class=n>injection_positions</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]],</span> <span class=n>token_increase</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>strategy_used</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>session</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>timestamp</span><span class=p>:</span> <span class=n>datetime</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>(),</span> <span class=n>success</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>,</span> <span class=n>error_message</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>metrics</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>complexity_score</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>0.0</span><span class=p>,</span> <span class=n>skip_reason</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span>
</span></code></pre></div><div class="doc doc-contents "><p>Result of a tenet instillation operation.</p><table><thead><tr><th><span class=doc-section-title>ATTRIBUTE</span></th><th><span>DESCRIPTION</span></th></tr></thead><tbody><tr class=doc-section-item><td><code><a class="autorefs autorefs-internal" title='<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">tenets_instilled</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span> (<code>tenets.core.instiller.instiller.InstillationResult.tenets_instilled</code>)' href=../#tenets.core.instiller.InstillationResult.tenets_instilled>tenets_instilled</a></code></td><td class=doc-attribute-details><div class=doc-md-description><p>List of tenets that were instilled</p></div><p><span class=doc-attribute-annotation><b>TYPE:</b><code><a class="autorefs autorefs-external" title="<code>typing.List</code>" href=https://docs.python.org/3/library/typing.html#typing.List>List</a>[<a class="autorefs autorefs-internal" title='<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">Tenet</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span> (<code>tenets.models.tenet.Tenet</code>)' href=../../../models/tenet/#tenets.models.tenet.Tenet>Tenet</a>]</code></span></p></td></tr><tr class=doc-section-item><td><code><a class="autorefs autorefs-internal" title='<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">injection_positions</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span> (<code>tenets.core.instiller.instiller.InstillationResult.injection_positions</code>)' href=../#tenets.core.instiller.InstillationResult.injection_positions>injection_positions</a></code></td><td class=doc-attribute-details><div class=doc-md-description><p>Where tenets were injected</p></div><p><span class=doc-attribute-annotation><b>TYPE:</b><code><a class="autorefs autorefs-external" title="<code>typing.List</code>" href=https://docs.python.org/3/library/typing.html#typing.List>List</a>[<a class="autorefs autorefs-external" title="<code>typing.Dict</code>" href=https://docs.python.org/3/library/typing.html#typing.Dict>Dict</a>[<a class="autorefs autorefs-external" href=https://docs.python.org/3/library/stdtypes.html#str>str</a>, <a class="autorefs autorefs-external" title="<code>typing.Any</code>" href=https://docs.python.org/3/library/typing.html#typing.Any>Any</a>]]</code></span></p></td></tr><tr class=doc-section-item><td><code><a class="autorefs autorefs-internal" title='<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">token_increase</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span> (<code>tenets.core.instiller.instiller.InstillationResult.token_increase</code>)' href=../#tenets.core.instiller.InstillationResult.token_increase>token_increase</a></code></td><td class=doc-attribute-details><div class=doc-md-description><p>Number of tokens added</p></div><p><span class=doc-attribute-annotation><b>TYPE:</b><code><a class="autorefs autorefs-external" href=https://docs.python.org/3/library/functions.html#int>int</a></code></span></p></td></tr><tr class=doc-section-item><td><code><a class="autorefs autorefs-internal" title='<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">strategy_used</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span> (<code>tenets.core.instiller.instiller.InstillationResult.strategy_used</code>)' href=../#tenets.core.instiller.InstillationResult.strategy_used>strategy_used</a></code></td><td class=doc-attribute-details><div class=doc-md-description><p>Injection strategy that was used</p></div><p><span class=doc-attribute-annotation><b>TYPE:</b><code><a class="autorefs autorefs-external" href=https://docs.python.org/3/library/stdtypes.html#str>str</a></code></span></p></td></tr><tr class=doc-section-item><td><code><a class="autorefs autorefs-internal" title='<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">session</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span> (<code>tenets.core.instiller.instiller.InstillationResult.session</code>)' href=../#tenets.core.instiller.InstillationResult.session>session</a></code></td><td class=doc-attribute-details><div class=doc-md-description><p>Session identifier if any</p></div><p><span class=doc-attribute-annotation><b>TYPE:</b><code><a class="autorefs autorefs-external" title="<code>typing.Optional</code>" href=https://docs.python.org/3/library/typing.html#typing.Optional>Optional</a>[<a class="autorefs autorefs-external" href=https://docs.python.org/3/library/stdtypes.html#str>str</a>]</code></span></p></td></tr><tr class=doc-section-item><td><code><a class="autorefs autorefs-internal" title='<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">timestamp</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span> (<code>tenets.core.instiller.instiller.InstillationResult.timestamp</code>)' href=../#tenets.core.instiller.InstillationResult.timestamp>timestamp</a></code></td><td class=doc-attribute-details><div class=doc-md-description><p>When instillation occurred</p></div><p><span class=doc-attribute-annotation><b>TYPE:</b><code><a class="autorefs autorefs-external" title="<code>datetime.datetime</code>" href=https://docs.python.org/3/library/datetime.html#datetime.datetime>datetime</a></code></span></p></td></tr><tr class=doc-section-item><td><code><a class="autorefs autorefs-internal" title='<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">success</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span> (<code>tenets.core.instiller.instiller.InstillationResult.success</code>)' href=../#tenets.core.instiller.InstillationResult.success>success</a></code></td><td class=doc-attribute-details><div class=doc-md-description><p>Whether instillation succeeded</p></div><p><span class=doc-attribute-annotation><b>TYPE:</b><code><a class="autorefs autorefs-external" href=https://docs.python.org/3/library/functions.html#bool>bool</a></code></span></p></td></tr><tr class=doc-section-item><td><code><a class="autorefs autorefs-internal" title='<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">error_message</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span> (<code>tenets.core.instiller.instiller.InstillationResult.error_message</code>)' href=../#tenets.core.instiller.InstillationResult.error_message>error_message</a></code></td><td class=doc-attribute-details><div class=doc-md-description><p>Error message if failed</p></div><p><span class=doc-attribute-annotation><b>TYPE:</b><code><a class="autorefs autorefs-external" title="<code>typing.Optional</code>" href=https://docs.python.org/3/library/typing.html#typing.Optional>Optional</a>[<a class="autorefs autorefs-external" href=https://docs.python.org/3/library/stdtypes.html#str>str</a>]</code></span></p></td></tr><tr class=doc-section-item><td><code><a class="autorefs autorefs-internal" title='<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">metrics</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span> (<code>tenets.core.instiller.instiller.InstillationResult.metrics</code>)' href=../#tenets.core.instiller.InstillationResult.metrics>metrics</a></code></td><td class=doc-attribute-details><div class=doc-md-description><p>Additional metrics from the operation</p></div><p><span class=doc-attribute-annotation><b>TYPE:</b><code><a class="autorefs autorefs-external" title="<code>typing.Optional</code>" href=https://docs.python.org/3/library/typing.html#typing.Optional>Optional</a>[<a class="autorefs autorefs-external" title="<code>typing.Dict</code>" href=https://docs.python.org/3/library/typing.html#typing.Dict>Dict</a>[<a class="autorefs autorefs-external" href=https://docs.python.org/3/library/stdtypes.html#str>str</a>, <a class="autorefs autorefs-external" title="<code>typing.Any</code>" href=https://docs.python.org/3/library/typing.html#typing.Any>Any</a>]]</code></span></p></td></tr><tr class=doc-section-item><td><code><a class="autorefs autorefs-internal" title='<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">complexity_score</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span> (<code>tenets.core.instiller.instiller.InstillationResult.complexity_score</code>)' href=../#tenets.core.instiller.InstillationResult.complexity_score>complexity_score</a></code></td><td class=doc-attribute-details><div class=doc-md-description><p>Complexity score of the context</p></div><p><span class=doc-attribute-annotation><b>TYPE:</b><code><a class="autorefs autorefs-external" href=https://docs.python.org/3/library/functions.html#float>float</a></code></span></p></td></tr><tr class=doc-section-item><td><code><a class="autorefs autorefs-internal" title='<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">skip_reason</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span> (<code>tenets.core.instiller.instiller.InstillationResult.skip_reason</code>)' href=../#tenets.core.instiller.InstillationResult.skip_reason>skip_reason</a></code></td><td class=doc-attribute-details><div class=doc-md-description><p>Reason if injection was skipped</p></div><p><span class=doc-attribute-annotation><b>TYPE:</b><code><a class="autorefs autorefs-external" title="<code>typing.Optional</code>" href=https://docs.python.org/3/library/typing.html#typing.Optional>Optional</a>[<a class="autorefs autorefs-external" href=https://docs.python.org/3/library/stdtypes.html#str>str</a>]</code></span></p></td></tr></tbody></table><div class="doc doc-children"><h5 id=tenets.core.instiller.instiller.InstillationResult-functions>Functions<a href=#tenets.core.instiller.instiller.InstillationResult-functions class=headerlink title="Link to this section">&para;</a></h5><div class="doc doc-object doc-function"><h6 id=tenets.core.instiller.instiller.InstillationResult.to_dict class="doc doc-heading"><code class="doc-symbol doc-symbol-heading doc-symbol-method"></code> <span class="doc doc-object-name doc-function-name">to_dict</span><a href=#tenets.core.instiller.instiller.InstillationResult.to_dict class=headerlink title="Link to this section">&para;</a></h6><div class="language-python doc-signature highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>to_dict</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span>
</span></code></pre></div><div class="doc doc-contents "><p>Convert to dictionary for serialization.</p><details class=mkdocstrings-source><summary>Source code in <code>tenets/core/instiller/instiller.py</code></summary><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-0-217><a id=__codelineno-0-217 name=__codelineno-0-217></a><a href=#__codelineno-0-217><span class=linenos data-linenos="217 "></span></a><span class=k>def</span><span class=w> </span><span class=nf>to_dict</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span><span id=__span-0-218><a id=__codelineno-0-218 name=__codelineno-0-218></a><a href=#__codelineno-0-218><span class=linenos data-linenos="218 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Convert to dictionary for serialization.&quot;&quot;&quot;</span>
</span><span id=__span-0-219><a id=__codelineno-0-219 name=__codelineno-0-219></a><a href=#__codelineno-0-219><span class=linenos data-linenos="219 "></span></a>    <span class=k>return</span> <span class=p>{</span>
</span><span id=__span-0-220><a id=__codelineno-0-220 name=__codelineno-0-220></a><a href=#__codelineno-0-220><span class=linenos data-linenos="220 "></span></a>        <span class=s2>&quot;tenets_instilled&quot;</span><span class=p>:</span> <span class=p>[</span><span class=n>t</span><span class=o>.</span><span class=n>to_dict</span><span class=p>()</span> <span class=k>for</span> <span class=n>t</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>tenets_instilled</span><span class=p>],</span>
</span><span id=__span-0-221><a id=__codelineno-0-221 name=__codelineno-0-221></a><a href=#__codelineno-0-221><span class=linenos data-linenos="221 "></span></a>        <span class=s2>&quot;injection_positions&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>injection_positions</span><span class=p>,</span>
</span><span id=__span-0-222><a id=__codelineno-0-222 name=__codelineno-0-222></a><a href=#__codelineno-0-222><span class=linenos data-linenos="222 "></span></a>        <span class=s2>&quot;token_increase&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>token_increase</span><span class=p>,</span>
</span><span id=__span-0-223><a id=__codelineno-0-223 name=__codelineno-0-223></a><a href=#__codelineno-0-223><span class=linenos data-linenos="223 "></span></a>        <span class=s2>&quot;strategy_used&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>strategy_used</span><span class=p>,</span>
</span><span id=__span-0-224><a id=__codelineno-0-224 name=__codelineno-0-224></a><a href=#__codelineno-0-224><span class=linenos data-linenos="224 "></span></a>        <span class=s2>&quot;session&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>session</span><span class=p>,</span>
</span><span id=__span-0-225><a id=__codelineno-0-225 name=__codelineno-0-225></a><a href=#__codelineno-0-225><span class=linenos data-linenos="225 "></span></a>        <span class=s2>&quot;timestamp&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>timestamp</span><span class=o>.</span><span class=n>isoformat</span><span class=p>(),</span>
</span><span id=__span-0-226><a id=__codelineno-0-226 name=__codelineno-0-226></a><a href=#__codelineno-0-226><span class=linenos data-linenos="226 "></span></a>        <span class=s2>&quot;success&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>success</span><span class=p>,</span>
</span><span id=__span-0-227><a id=__codelineno-0-227 name=__codelineno-0-227></a><a href=#__codelineno-0-227><span class=linenos data-linenos="227 "></span></a>        <span class=s2>&quot;error_message&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>error_message</span><span class=p>,</span>
</span><span id=__span-0-228><a id=__codelineno-0-228 name=__codelineno-0-228></a><a href=#__codelineno-0-228><span class=linenos data-linenos="228 "></span></a>        <span class=s2>&quot;metrics&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=p>,</span>
</span><span id=__span-0-229><a id=__codelineno-0-229 name=__codelineno-0-229></a><a href=#__codelineno-0-229><span class=linenos data-linenos="229 "></span></a>        <span class=s2>&quot;complexity_score&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>complexity_score</span><span class=p>,</span>
</span><span id=__span-0-230><a id=__codelineno-0-230 name=__codelineno-0-230></a><a href=#__codelineno-0-230><span class=linenos data-linenos="230 "></span></a>        <span class=s2>&quot;skip_reason&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>skip_reason</span><span class=p>,</span>
</span><span id=__span-0-231><a id=__codelineno-0-231 name=__codelineno-0-231></a><a href=#__codelineno-0-231><span class=linenos data-linenos="231 "></span></a>    <span class=p>}</span>
</span></code></pre></div></details></div></div></div></div></div><div class="doc doc-object doc-class"><h4 id=tenets.core.instiller.instiller.ComplexityAnalyzer class="doc doc-heading"><code class="doc-symbol doc-symbol-heading doc-symbol-class"></code> <span class="doc doc-object-name doc-class-name">ComplexityAnalyzer</span><a href=#tenets.core.instiller.instiller.ComplexityAnalyzer class=headerlink title="Link to this section">&para;</a></h4><div class="language-python doc-signature highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>ComplexityAnalyzer</span><span class=p>(</span><span class=n>config</span><span class=p>:</span> <span class=n>TenetsConfig</span><span class=p>)</span>
</span></code></pre></div><div class="doc doc-contents "><p>Analyze context complexity to guide injection decisions.</p><p>Uses NLP components to analyze: - Token count and density - Code vs documentation ratio - Keyword diversity - Structural complexity - Topic coherence</p><p>Initialize complexity analyzer.</p><table><thead><tr><th><span class=doc-section-title>PARAMETER</span></th><th><span>DESCRIPTION</span></th></tr></thead><tbody><tr class=doc-section-item><td><code>config</code></td><td class=doc-param-details><div class=doc-md-description><p>Configuration object</p></div><p><span class=doc-param-annotation><b>TYPE:</b><code><a class="autorefs autorefs-internal" title='<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">TenetsConfig</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span> (<code>tenets.config.TenetsConfig</code>)' href=../../../config/#tenets.config.TenetsConfig>TenetsConfig</a></code></span></p></td></tr></tbody></table><details class=mkdocstrings-source><summary>Source code in <code>tenets/core/instiller/instiller.py</code></summary><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-0-245><a id=__codelineno-0-245 name=__codelineno-0-245></a><a href=#__codelineno-0-245><span class=linenos data-linenos="245 "></span></a><span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>config</span><span class=p>:</span> <span class=n>TenetsConfig</span><span class=p>):</span>
</span><span id=__span-0-246><a id=__codelineno-0-246 name=__codelineno-0-246></a><a href=#__codelineno-0-246><span class=linenos data-linenos="246 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Initialize complexity analyzer.</span>
</span><span id=__span-0-247><a id=__codelineno-0-247 name=__codelineno-0-247></a><a href=#__codelineno-0-247><span class=linenos data-linenos="247 "></span></a>
</span><span id=__span-0-248><a id=__codelineno-0-248 name=__codelineno-0-248></a><a href=#__codelineno-0-248><span class=linenos data-linenos="248 "></span></a><span class=sd>    Args:</span>
</span><span id=__span-0-249><a id=__codelineno-0-249 name=__codelineno-0-249></a><a href=#__codelineno-0-249><span class=linenos data-linenos="249 "></span></a><span class=sd>        config: Configuration object</span>
</span><span id=__span-0-250><a id=__codelineno-0-250 name=__codelineno-0-250></a><a href=#__codelineno-0-250><span class=linenos data-linenos="250 "></span></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-0-251><a id=__codelineno-0-251 name=__codelineno-0-251></a><a href=#__codelineno-0-251><span class=linenos data-linenos="251 "></span></a>    <span class=bp>self</span><span class=o>.</span><span class=n>config</span> <span class=o>=</span> <span class=n>config</span>
</span><span id=__span-0-252><a id=__codelineno-0-252 name=__codelineno-0-252></a><a href=#__codelineno-0-252><span class=linenos data-linenos="252 "></span></a>    <span class=bp>self</span><span class=o>.</span><span class=n>logger</span> <span class=o>=</span> <span class=n>get_logger</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span><span id=__span-0-253><a id=__codelineno-0-253 name=__codelineno-0-253></a><a href=#__codelineno-0-253><span class=linenos data-linenos="253 "></span></a>
</span><span id=__span-0-254><a id=__codelineno-0-254 name=__codelineno-0-254></a><a href=#__codelineno-0-254><span class=linenos data-linenos="254 "></span></a>    <span class=c1># Lazy initialization flags</span>
</span><span id=__span-0-255><a id=__codelineno-0-255 name=__codelineno-0-255></a><a href=#__codelineno-0-255><span class=linenos data-linenos="255 "></span></a>    <span class=bp>self</span><span class=o>.</span><span class=n>_nlp_initialized</span> <span class=o>=</span> <span class=kc>False</span>
</span><span id=__span-0-256><a id=__codelineno-0-256 name=__codelineno-0-256></a><a href=#__codelineno-0-256><span class=linenos data-linenos="256 "></span></a>    <span class=bp>self</span><span class=o>.</span><span class=n>tokenizer</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-0-257><a id=__codelineno-0-257 name=__codelineno-0-257></a><a href=#__codelineno-0-257><span class=linenos data-linenos="257 "></span></a>    <span class=bp>self</span><span class=o>.</span><span class=n>keyword_extractor</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-0-258><a id=__codelineno-0-258 name=__codelineno-0-258></a><a href=#__codelineno-0-258><span class=linenos data-linenos="258 "></span></a>    <span class=bp>self</span><span class=o>.</span><span class=n>semantic_analyzer</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-0-259><a id=__codelineno-0-259 name=__codelineno-0-259></a><a href=#__codelineno-0-259><span class=linenos data-linenos="259 "></span></a>    <span class=bp>self</span><span class=o>.</span><span class=n>ml_available</span> <span class=o>=</span> <span class=kc>False</span>
</span></code></pre></div></details><div class="doc doc-children"><h5 id=tenets.core.instiller.instiller.ComplexityAnalyzer-functions>Functions<a href=#tenets.core.instiller.instiller.ComplexityAnalyzer-functions class=headerlink title="Link to this section">&para;</a></h5><div class="doc doc-object doc-function"><h6 id=tenets.core.instiller.instiller.ComplexityAnalyzer.analyze class="doc doc-heading"><code class="doc-symbol doc-symbol-heading doc-symbol-method"></code> <span class="doc doc-object-name doc-function-name">analyze</span><a href=#tenets.core.instiller.instiller.ComplexityAnalyzer.analyze class=headerlink title="Link to this section">&para;</a></h6><div class="language-python doc-signature highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>analyze</span><span class=p>(</span><span class=n>context</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>ContextResult</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=nb>float</span>
</span></code></pre></div><div class="doc doc-contents "><p>Analyze context complexity.</p><table><thead><tr><th><span class=doc-section-title>PARAMETER</span></th><th><span>DESCRIPTION</span></th></tr></thead><tbody><tr class=doc-section-item><td><code>context</code></td><td class=doc-param-details><div class=doc-md-description><p>Context to analyze (string or ContextResult)</p></div><p><span class=doc-param-annotation><b>TYPE:</b><code><a class="autorefs autorefs-external" title="<code>typing.Union</code>" href=https://docs.python.org/3/library/typing.html#typing.Union>Union</a>[<a class="autorefs autorefs-external" href=https://docs.python.org/3/library/stdtypes.html#str>str</a>, <a class="autorefs autorefs-internal" title='<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">ContextResult</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span> (<code>tenets.models.context.ContextResult</code>)' href=../../../models/context/#tenets.models.context.ContextResult>ContextResult</a>]</code></span></p></td></tr></tbody></table><table><thead><tr><th><span class=doc-section-title>RETURNS</span></th><th><span>DESCRIPTION</span></th></tr></thead><tbody><tr class=doc-section-item><td><span class=doc-returns-annotation><code><a class="autorefs autorefs-external" href=https://docs.python.org/3/library/functions.html#float>float</a></code></span></td><td class=doc-returns-details><div class=doc-md-description><p>Complexity score between 0 and 1</p></div></td></tr></tbody></table><details class=mkdocstrings-source><summary>Source code in <code>tenets/core/instiller/instiller.py</code></summary><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-0-289><a id=__codelineno-0-289 name=__codelineno-0-289></a><a href=#__codelineno-0-289><span class=linenos data-linenos="289 "></span></a><span class=k>def</span><span class=w> </span><span class=nf>analyze</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>context</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>ContextResult</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=nb>float</span><span class=p>:</span>
</span><span id=__span-0-290><a id=__codelineno-0-290 name=__codelineno-0-290></a><a href=#__codelineno-0-290><span class=linenos data-linenos="290 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Analyze context complexity.</span>
</span><span id=__span-0-291><a id=__codelineno-0-291 name=__codelineno-0-291></a><a href=#__codelineno-0-291><span class=linenos data-linenos="291 "></span></a>
</span><span id=__span-0-292><a id=__codelineno-0-292 name=__codelineno-0-292></a><a href=#__codelineno-0-292><span class=linenos data-linenos="292 "></span></a><span class=sd>    Args:</span>
</span><span id=__span-0-293><a id=__codelineno-0-293 name=__codelineno-0-293></a><a href=#__codelineno-0-293><span class=linenos data-linenos="293 "></span></a><span class=sd>        context: Context to analyze (string or ContextResult)</span>
</span><span id=__span-0-294><a id=__codelineno-0-294 name=__codelineno-0-294></a><a href=#__codelineno-0-294><span class=linenos data-linenos="294 "></span></a>
</span><span id=__span-0-295><a id=__codelineno-0-295 name=__codelineno-0-295></a><a href=#__codelineno-0-295><span class=linenos data-linenos="295 "></span></a><span class=sd>    Returns:</span>
</span><span id=__span-0-296><a id=__codelineno-0-296 name=__codelineno-0-296></a><a href=#__codelineno-0-296><span class=linenos data-linenos="296 "></span></a><span class=sd>        Complexity score between 0 and 1</span>
</span><span id=__span-0-297><a id=__codelineno-0-297 name=__codelineno-0-297></a><a href=#__codelineno-0-297><span class=linenos data-linenos="297 "></span></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-0-298><a id=__codelineno-0-298 name=__codelineno-0-298></a><a href=#__codelineno-0-298><span class=linenos data-linenos="298 "></span></a>    <span class=c1># Initialize NLP components lazily on first use</span>
</span><span id=__span-0-299><a id=__codelineno-0-299 name=__codelineno-0-299></a><a href=#__codelineno-0-299><span class=linenos data-linenos="299 "></span></a>    <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_nlp_initialized</span><span class=p>:</span>
</span><span id=__span-0-300><a id=__codelineno-0-300 name=__codelineno-0-300></a><a href=#__codelineno-0-300><span class=linenos data-linenos="300 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_init_nlp_components</span><span class=p>()</span>
</span><span id=__span-0-301><a id=__codelineno-0-301 name=__codelineno-0-301></a><a href=#__codelineno-0-301><span class=linenos data-linenos="301 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_nlp_initialized</span> <span class=o>=</span> <span class=kc>True</span>
</span><span id=__span-0-302><a id=__codelineno-0-302 name=__codelineno-0-302></a><a href=#__codelineno-0-302><span class=linenos data-linenos="302 "></span></a>
</span><span id=__span-0-303><a id=__codelineno-0-303 name=__codelineno-0-303></a><a href=#__codelineno-0-303><span class=linenos data-linenos="303 "></span></a>    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>context</span><span class=p>,</span> <span class=n>ContextResult</span><span class=p>):</span>
</span><span id=__span-0-304><a id=__codelineno-0-304 name=__codelineno-0-304></a><a href=#__codelineno-0-304><span class=linenos data-linenos="304 "></span></a>        <span class=n>text</span> <span class=o>=</span> <span class=n>context</span><span class=o>.</span><span class=n>context</span>
</span><span id=__span-0-305><a id=__codelineno-0-305 name=__codelineno-0-305></a><a href=#__codelineno-0-305><span class=linenos data-linenos="305 "></span></a>        <span class=n>metadata</span> <span class=o>=</span> <span class=n>context</span><span class=o>.</span><span class=n>metadata</span>
</span><span id=__span-0-306><a id=__codelineno-0-306 name=__codelineno-0-306></a><a href=#__codelineno-0-306><span class=linenos data-linenos="306 "></span></a>    <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-307><a id=__codelineno-0-307 name=__codelineno-0-307></a><a href=#__codelineno-0-307><span class=linenos data-linenos="307 "></span></a>        <span class=n>text</span> <span class=o>=</span> <span class=n>context</span>
</span><span id=__span-0-308><a id=__codelineno-0-308 name=__codelineno-0-308></a><a href=#__codelineno-0-308><span class=linenos data-linenos="308 "></span></a>        <span class=n>metadata</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-0-309><a id=__codelineno-0-309 name=__codelineno-0-309></a><a href=#__codelineno-0-309><span class=linenos data-linenos="309 "></span></a>
</span><span id=__span-0-310><a id=__codelineno-0-310 name=__codelineno-0-310></a><a href=#__codelineno-0-310><span class=linenos data-linenos="310 "></span></a>    <span class=k>if</span> <span class=ow>not</span> <span class=n>text</span><span class=p>:</span>
</span><span id=__span-0-311><a id=__codelineno-0-311 name=__codelineno-0-311></a><a href=#__codelineno-0-311><span class=linenos data-linenos="311 "></span></a>        <span class=k>return</span> <span class=mf>0.0</span>
</span><span id=__span-0-312><a id=__codelineno-0-312 name=__codelineno-0-312></a><a href=#__codelineno-0-312><span class=linenos data-linenos="312 "></span></a>
</span><span id=__span-0-313><a id=__codelineno-0-313 name=__codelineno-0-313></a><a href=#__codelineno-0-313><span class=linenos data-linenos="313 "></span></a>    <span class=n>scores</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-0-314><a id=__codelineno-0-314 name=__codelineno-0-314></a><a href=#__codelineno-0-314><span class=linenos data-linenos="314 "></span></a>
</span><span id=__span-0-315><a id=__codelineno-0-315 name=__codelineno-0-315></a><a href=#__codelineno-0-315><span class=linenos data-linenos="315 "></span></a>    <span class=c1># Length-based complexity</span>
</span><span id=__span-0-316><a id=__codelineno-0-316 name=__codelineno-0-316></a><a href=#__codelineno-0-316><span class=linenos data-linenos="316 "></span></a>    <span class=n>length_score</span> <span class=o>=</span> <span class=nb>min</span><span class=p>(</span><span class=mf>1.0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>text</span><span class=p>)</span> <span class=o>/</span> <span class=mi>50000</span><span class=p>)</span>  <span class=c1># Normalize to 50k chars</span>
</span><span id=__span-0-317><a id=__codelineno-0-317 name=__codelineno-0-317></a><a href=#__codelineno-0-317><span class=linenos data-linenos="317 "></span></a>    <span class=n>scores</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>length_score</span> <span class=o>*</span> <span class=mf>0.2</span><span class=p>)</span>  <span class=c1># 20% weight</span>
</span><span id=__span-0-318><a id=__codelineno-0-318 name=__codelineno-0-318></a><a href=#__codelineno-0-318><span class=linenos data-linenos="318 "></span></a>
</span><span id=__span-0-319><a id=__codelineno-0-319 name=__codelineno-0-319></a><a href=#__codelineno-0-319><span class=linenos data-linenos="319 "></span></a>    <span class=c1># Token diversity</span>
</span><span id=__span-0-320><a id=__codelineno-0-320 name=__codelineno-0-320></a><a href=#__codelineno-0-320><span class=linenos data-linenos="320 "></span></a>    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>tokenizer</span><span class=p>:</span>
</span><span id=__span-0-321><a id=__codelineno-0-321 name=__codelineno-0-321></a><a href=#__codelineno-0-321><span class=linenos data-linenos="321 "></span></a>        <span class=n>tokens</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>tokenizer</span><span class=o>.</span><span class=n>tokenize</span><span class=p>(</span><span class=n>text</span><span class=p>)</span>
</span><span id=__span-0-322><a id=__codelineno-0-322 name=__codelineno-0-322></a><a href=#__codelineno-0-322><span class=linenos data-linenos="322 "></span></a>        <span class=n>unique_ratio</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=nb>set</span><span class=p>(</span><span class=n>tokens</span><span class=p>))</span> <span class=o>/</span> <span class=nb>max</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>tokens</span><span class=p>),</span> <span class=mi>1</span><span class=p>)</span>
</span><span id=__span-0-323><a id=__codelineno-0-323 name=__codelineno-0-323></a><a href=#__codelineno-0-323><span class=linenos data-linenos="323 "></span></a>        <span class=n>diversity_score</span> <span class=o>=</span> <span class=mf>1.0</span> <span class=o>-</span> <span class=n>unique_ratio</span>  <span class=c1># Higher repetition = higher complexity</span>
</span><span id=__span-0-324><a id=__codelineno-0-324 name=__codelineno-0-324></a><a href=#__codelineno-0-324><span class=linenos data-linenos="324 "></span></a>        <span class=n>scores</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>diversity_score</span> <span class=o>*</span> <span class=mf>0.2</span><span class=p>)</span>  <span class=c1># 20% weight</span>
</span><span id=__span-0-325><a id=__codelineno-0-325 name=__codelineno-0-325></a><a href=#__codelineno-0-325><span class=linenos data-linenos="325 "></span></a>
</span><span id=__span-0-326><a id=__codelineno-0-326 name=__codelineno-0-326></a><a href=#__codelineno-0-326><span class=linenos data-linenos="326 "></span></a>    <span class=c1># Keyword density</span>
</span><span id=__span-0-327><a id=__codelineno-0-327 name=__codelineno-0-327></a><a href=#__codelineno-0-327><span class=linenos data-linenos="327 "></span></a>    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>keyword_extractor</span><span class=p>:</span>
</span><span id=__span-0-328><a id=__codelineno-0-328 name=__codelineno-0-328></a><a href=#__codelineno-0-328><span class=linenos data-linenos="328 "></span></a>        <span class=n>keywords</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>keyword_extractor</span><span class=o>.</span><span class=n>extract</span><span class=p>(</span><span class=n>text</span><span class=p>,</span> <span class=n>max_keywords</span><span class=o>=</span><span class=mi>30</span><span class=p>)</span>
</span><span id=__span-0-329><a id=__codelineno-0-329 name=__codelineno-0-329></a><a href=#__codelineno-0-329><span class=linenos data-linenos="329 "></span></a>        <span class=n>keyword_density</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>keywords</span><span class=p>)</span> <span class=o>/</span> <span class=nb>max</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>text</span><span class=o>.</span><span class=n>split</span><span class=p>()),</span> <span class=mi>1</span><span class=p>)</span>
</span><span id=__span-0-330><a id=__codelineno-0-330 name=__codelineno-0-330></a><a href=#__codelineno-0-330><span class=linenos data-linenos="330 "></span></a>        <span class=n>scores</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=nb>min</span><span class=p>(</span><span class=mf>1.0</span><span class=p>,</span> <span class=n>keyword_density</span> <span class=o>*</span> <span class=mi>100</span><span class=p>)</span> <span class=o>*</span> <span class=mf>0.2</span><span class=p>)</span>  <span class=c1># 20% weight</span>
</span><span id=__span-0-331><a id=__codelineno-0-331 name=__codelineno-0-331></a><a href=#__codelineno-0-331><span class=linenos data-linenos="331 "></span></a>
</span><span id=__span-0-332><a id=__codelineno-0-332 name=__codelineno-0-332></a><a href=#__codelineno-0-332><span class=linenos data-linenos="332 "></span></a>    <span class=c1># Code vs documentation ratio</span>
</span><span id=__span-0-333><a id=__codelineno-0-333 name=__codelineno-0-333></a><a href=#__codelineno-0-333><span class=linenos data-linenos="333 "></span></a>    <span class=n>code_blocks</span> <span class=o>=</span> <span class=n>text</span><span class=o>.</span><span class=n>count</span><span class=p>(</span><span class=s2>&quot;```&quot;</span><span class=p>)</span>
</span><span id=__span-0-334><a id=__codelineno-0-334 name=__codelineno-0-334></a><a href=#__codelineno-0-334><span class=linenos data-linenos="334 "></span></a>    <span class=n>doc_sections</span> <span class=o>=</span> <span class=n>text</span><span class=o>.</span><span class=n>count</span><span class=p>(</span><span class=s2>&quot;#&quot;</span><span class=p>)</span> <span class=o>+</span> <span class=n>text</span><span class=o>.</span><span class=n>count</span><span class=p>(</span><span class=s2>&quot;##&quot;</span><span class=p>)</span>
</span><span id=__span-0-335><a id=__codelineno-0-335 name=__codelineno-0-335></a><a href=#__codelineno-0-335><span class=linenos data-linenos="335 "></span></a>    <span class=k>if</span> <span class=n>code_blocks</span> <span class=o>+</span> <span class=n>doc_sections</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span><span id=__span-0-336><a id=__codelineno-0-336 name=__codelineno-0-336></a><a href=#__codelineno-0-336><span class=linenos data-linenos="336 "></span></a>        <span class=n>code_ratio</span> <span class=o>=</span> <span class=n>code_blocks</span> <span class=o>/</span> <span class=p>(</span><span class=n>code_blocks</span> <span class=o>+</span> <span class=n>doc_sections</span><span class=p>)</span>
</span><span id=__span-0-337><a id=__codelineno-0-337 name=__codelineno-0-337></a><a href=#__codelineno-0-337><span class=linenos data-linenos="337 "></span></a>        <span class=n>scores</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>code_ratio</span> <span class=o>*</span> <span class=mf>0.2</span><span class=p>)</span>  <span class=c1># 20% weight</span>
</span><span id=__span-0-338><a id=__codelineno-0-338 name=__codelineno-0-338></a><a href=#__codelineno-0-338><span class=linenos data-linenos="338 "></span></a>    <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-339><a id=__codelineno-0-339 name=__codelineno-0-339></a><a href=#__codelineno-0-339><span class=linenos data-linenos="339 "></span></a>        <span class=n>scores</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=mf>0.1</span><span class=p>)</span>  <span class=c1># Default low complexity</span>
</span><span id=__span-0-340><a id=__codelineno-0-340 name=__codelineno-0-340></a><a href=#__codelineno-0-340><span class=linenos data-linenos="340 "></span></a>
</span><span id=__span-0-341><a id=__codelineno-0-341 name=__codelineno-0-341></a><a href=#__codelineno-0-341><span class=linenos data-linenos="341 "></span></a>    <span class=c1># File count from metadata</span>
</span><span id=__span-0-342><a id=__codelineno-0-342 name=__codelineno-0-342></a><a href=#__codelineno-0-342><span class=linenos data-linenos="342 "></span></a>    <span class=k>if</span> <span class=n>metadata</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;file_count&quot;</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>10</span><span class=p>:</span>
</span><span id=__span-0-343><a id=__codelineno-0-343 name=__codelineno-0-343></a><a href=#__codelineno-0-343><span class=linenos data-linenos="343 "></span></a>        <span class=n>file_complexity</span> <span class=o>=</span> <span class=nb>min</span><span class=p>(</span><span class=mf>1.0</span><span class=p>,</span> <span class=n>metadata</span><span class=p>[</span><span class=s2>&quot;file_count&quot;</span><span class=p>]</span> <span class=o>/</span> <span class=mi>50</span><span class=p>)</span>
</span><span id=__span-0-344><a id=__codelineno-0-344 name=__codelineno-0-344></a><a href=#__codelineno-0-344><span class=linenos data-linenos="344 "></span></a>        <span class=n>scores</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>file_complexity</span> <span class=o>*</span> <span class=mf>0.2</span><span class=p>)</span>  <span class=c1># 20% weight</span>
</span><span id=__span-0-345><a id=__codelineno-0-345 name=__codelineno-0-345></a><a href=#__codelineno-0-345><span class=linenos data-linenos="345 "></span></a>    <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-346><a id=__codelineno-0-346 name=__codelineno-0-346></a><a href=#__codelineno-0-346><span class=linenos data-linenos="346 "></span></a>        <span class=n>scores</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=mf>0.1</span><span class=p>)</span>
</span><span id=__span-0-347><a id=__codelineno-0-347 name=__codelineno-0-347></a><a href=#__codelineno-0-347><span class=linenos data-linenos="347 "></span></a>
</span><span id=__span-0-348><a id=__codelineno-0-348 name=__codelineno-0-348></a><a href=#__codelineno-0-348><span class=linenos data-linenos="348 "></span></a>    <span class=c1># Calculate weighted average</span>
</span><span id=__span-0-349><a id=__codelineno-0-349 name=__codelineno-0-349></a><a href=#__codelineno-0-349><span class=linenos data-linenos="349 "></span></a>    <span class=k>if</span> <span class=n>scores</span><span class=p>:</span>
</span><span id=__span-0-350><a id=__codelineno-0-350 name=__codelineno-0-350></a><a href=#__codelineno-0-350><span class=linenos data-linenos="350 "></span></a>        <span class=n>complexity</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>(</span><span class=n>scores</span><span class=p>)</span>
</span><span id=__span-0-351><a id=__codelineno-0-351 name=__codelineno-0-351></a><a href=#__codelineno-0-351><span class=linenos data-linenos="351 "></span></a>    <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-352><a id=__codelineno-0-352 name=__codelineno-0-352></a><a href=#__codelineno-0-352><span class=linenos data-linenos="352 "></span></a>        <span class=n>complexity</span> <span class=o>=</span> <span class=mf>0.5</span>  <span class=c1># Default medium complexity</span>
</span><span id=__span-0-353><a id=__codelineno-0-353 name=__codelineno-0-353></a><a href=#__codelineno-0-353><span class=linenos data-linenos="353 "></span></a>
</span><span id=__span-0-354><a id=__codelineno-0-354 name=__codelineno-0-354></a><a href=#__codelineno-0-354><span class=linenos data-linenos="354 "></span></a>    <span class=k>return</span> <span class=nb>min</span><span class=p>(</span><span class=mf>1.0</span><span class=p>,</span> <span class=nb>max</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=n>complexity</span><span class=p>))</span>
</span></code></pre></div></details></div></div></div></div></div><div class="doc doc-object doc-class"><h4 id=tenets.core.instiller.instiller.MetricsTracker class="doc doc-heading"><code class="doc-symbol doc-symbol-heading doc-symbol-class"></code> <span class="doc doc-object-name doc-class-name">MetricsTracker</span><a href=#tenets.core.instiller.instiller.MetricsTracker class=headerlink title="Link to this section">&para;</a></h4><div class="language-python doc-signature highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>MetricsTracker</span><span class=p>()</span>
</span></code></pre></div><div class="doc doc-contents "><p>Track metrics for tenet instillation.</p><p>Tracks: - Instillation counts and frequencies - Token usage and increases - Strategy effectiveness - Session-specific metrics - Tenet performance</p><p>Initialize metrics tracker.</p><details class=mkdocstrings-source><summary>Source code in <code>tenets/core/instiller/instiller.py</code></summary><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-0-368><a id=__codelineno-0-368 name=__codelineno-0-368></a><a href=#__codelineno-0-368><span class=linenos data-linenos="368 "></span></a><span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-0-369><a id=__codelineno-0-369 name=__codelineno-0-369></a><a href=#__codelineno-0-369><span class=linenos data-linenos="369 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Initialize metrics tracker.&quot;&quot;&quot;</span>
</span><span id=__span-0-370><a id=__codelineno-0-370 name=__codelineno-0-370></a><a href=#__codelineno-0-370><span class=linenos data-linenos="370 "></span></a>    <span class=bp>self</span><span class=o>.</span><span class=n>instillations</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-0-371><a id=__codelineno-0-371 name=__codelineno-0-371></a><a href=#__codelineno-0-371><span class=linenos data-linenos="371 "></span></a>    <span class=bp>self</span><span class=o>.</span><span class=n>session_metrics</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=n>defaultdict</span><span class=p>(</span>
</span><span id=__span-0-372><a id=__codelineno-0-372 name=__codelineno-0-372></a><a href=#__codelineno-0-372><span class=linenos data-linenos="372 "></span></a>        <span class=k>lambda</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-0-373><a id=__codelineno-0-373 name=__codelineno-0-373></a><a href=#__codelineno-0-373><span class=linenos data-linenos="373 "></span></a>            <span class=s2>&quot;total_instillations&quot;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span><span id=__span-0-374><a id=__codelineno-0-374 name=__codelineno-0-374></a><a href=#__codelineno-0-374><span class=linenos data-linenos="374 "></span></a>            <span class=s2>&quot;total_tenets&quot;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span><span id=__span-0-375><a id=__codelineno-0-375 name=__codelineno-0-375></a><a href=#__codelineno-0-375><span class=linenos data-linenos="375 "></span></a>            <span class=s2>&quot;total_tokens&quot;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span><span id=__span-0-376><a id=__codelineno-0-376 name=__codelineno-0-376></a><a href=#__codelineno-0-376><span class=linenos data-linenos="376 "></span></a>            <span class=s2>&quot;strategies_used&quot;</span><span class=p>:</span> <span class=n>defaultdict</span><span class=p>(</span><span class=nb>int</span><span class=p>),</span>
</span><span id=__span-0-377><a id=__codelineno-0-377 name=__codelineno-0-377></a><a href=#__codelineno-0-377><span class=linenos data-linenos="377 "></span></a>            <span class=s2>&quot;complexity_scores&quot;</span><span class=p>:</span> <span class=p>[],</span>
</span><span id=__span-0-378><a id=__codelineno-0-378 name=__codelineno-0-378></a><a href=#__codelineno-0-378><span class=linenos data-linenos="378 "></span></a>        <span class=p>}</span>
</span><span id=__span-0-379><a id=__codelineno-0-379 name=__codelineno-0-379></a><a href=#__codelineno-0-379><span class=linenos data-linenos="379 "></span></a>    <span class=p>)</span>
</span><span id=__span-0-380><a id=__codelineno-0-380 name=__codelineno-0-380></a><a href=#__codelineno-0-380><span class=linenos data-linenos="380 "></span></a>    <span class=bp>self</span><span class=o>.</span><span class=n>strategy_usage</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=n>defaultdict</span><span class=p>(</span><span class=nb>int</span><span class=p>)</span>
</span><span id=__span-0-381><a id=__codelineno-0-381 name=__codelineno-0-381></a><a href=#__codelineno-0-381><span class=linenos data-linenos="381 "></span></a>    <span class=bp>self</span><span class=o>.</span><span class=n>tenet_usage</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=n>defaultdict</span><span class=p>(</span><span class=nb>int</span><span class=p>)</span>
</span><span id=__span-0-382><a id=__codelineno-0-382 name=__codelineno-0-382></a><a href=#__codelineno-0-382><span class=linenos data-linenos="382 "></span></a>    <span class=bp>self</span><span class=o>.</span><span class=n>skip_reasons</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=n>defaultdict</span><span class=p>(</span><span class=nb>int</span><span class=p>)</span>
</span></code></pre></div></details><div class="doc doc-children"><h5 id=tenets.core.instiller.instiller.MetricsTracker-functions>Functions<a href=#tenets.core.instiller.instiller.MetricsTracker-functions class=headerlink title="Link to this section">&para;</a></h5><div class="doc doc-object doc-function"><h6 id=tenets.core.instiller.instiller.MetricsTracker.record_instillation class="doc doc-heading"><code class="doc-symbol doc-symbol-heading doc-symbol-method"></code> <span class="doc doc-object-name doc-function-name">record_instillation</span><a href=#tenets.core.instiller.instiller.MetricsTracker.record_instillation class=headerlink title="Link to this section">&para;</a></h6><div class="language-python doc-signature highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>record_instillation</span><span class=p>(</span><span class=n>tenet_count</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>token_increase</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>strategy</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>session</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>complexity</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>0.0</span><span class=p>,</span> <span class=n>skip_reason</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span>
</span></code></pre></div><div class="doc doc-contents "><p>Record an instillation event.</p><table><thead><tr><th><span class=doc-section-title>PARAMETER</span></th><th><span>DESCRIPTION</span></th></tr></thead><tbody><tr class=doc-section-item><td><code>tenet_count</code></td><td class=doc-param-details><div class=doc-md-description><p>Number of tenets instilled</p></div><p><span class=doc-param-annotation><b>TYPE:</b><code><a class="autorefs autorefs-external" href=https://docs.python.org/3/library/functions.html#int>int</a></code></span></p></td></tr><tr class=doc-section-item><td><code>token_increase</code></td><td class=doc-param-details><div class=doc-md-description><p>Tokens added</p></div><p><span class=doc-param-annotation><b>TYPE:</b><code><a class="autorefs autorefs-external" href=https://docs.python.org/3/library/functions.html#int>int</a></code></span></p></td></tr><tr class=doc-section-item><td><code>strategy</code></td><td class=doc-param-details><div class=doc-md-description><p>Strategy used</p></div><p><span class=doc-param-annotation><b>TYPE:</b><code><a class="autorefs autorefs-external" href=https://docs.python.org/3/library/stdtypes.html#str>str</a></code></span></p></td></tr><tr class=doc-section-item><td><code>session</code></td><td class=doc-param-details><div class=doc-md-description><p>Session identifier</p></div><p><span class=doc-param-annotation><b>TYPE:</b><code><a class="autorefs autorefs-external" title="<code>typing.Optional</code>" href=https://docs.python.org/3/library/typing.html#typing.Optional>Optional</a>[<a class="autorefs autorefs-external" href=https://docs.python.org/3/library/stdtypes.html#str>str</a>]</code></span><span class=doc-param-default><b>DEFAULT:</b><code>None</code></span></p></td></tr><tr class=doc-section-item><td><code>complexity</code></td><td class=doc-param-details><div class=doc-md-description><p>Context complexity score</p></div><p><span class=doc-param-annotation><b>TYPE:</b><code><a class="autorefs autorefs-external" href=https://docs.python.org/3/library/functions.html#float>float</a></code></span><span class=doc-param-default><b>DEFAULT:</b><code>0.0</code></span></p></td></tr><tr class=doc-section-item><td><code>skip_reason</code></td><td class=doc-param-details><div class=doc-md-description><p>Reason if skipped</p></div><p><span class=doc-param-annotation><b>TYPE:</b><code><a class="autorefs autorefs-external" title="<code>typing.Optional</code>" href=https://docs.python.org/3/library/typing.html#typing.Optional>Optional</a>[<a class="autorefs autorefs-external" href=https://docs.python.org/3/library/stdtypes.html#str>str</a>]</code></span><span class=doc-param-default><b>DEFAULT:</b><code>None</code></span></p></td></tr></tbody></table><details class=mkdocstrings-source><summary>Source code in <code>tenets/core/instiller/instiller.py</code></summary><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-0-384><a id=__codelineno-0-384 name=__codelineno-0-384></a><a href=#__codelineno-0-384><span class=linenos data-linenos="384 "></span></a><span class=k>def</span><span class=w> </span><span class=nf>record_instillation</span><span class=p>(</span>
</span><span id=__span-0-385><a id=__codelineno-0-385 name=__codelineno-0-385></a><a href=#__codelineno-0-385><span class=linenos data-linenos="385 "></span></a>    <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-386><a id=__codelineno-0-386 name=__codelineno-0-386></a><a href=#__codelineno-0-386><span class=linenos data-linenos="386 "></span></a>    <span class=n>tenet_count</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span>
</span><span id=__span-0-387><a id=__codelineno-0-387 name=__codelineno-0-387></a><a href=#__codelineno-0-387><span class=linenos data-linenos="387 "></span></a>    <span class=n>token_increase</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span>
</span><span id=__span-0-388><a id=__codelineno-0-388 name=__codelineno-0-388></a><a href=#__codelineno-0-388><span class=linenos data-linenos="388 "></span></a>    <span class=n>strategy</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-389><a id=__codelineno-0-389 name=__codelineno-0-389></a><a href=#__codelineno-0-389><span class=linenos data-linenos="389 "></span></a>    <span class=n>session</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-390><a id=__codelineno-0-390 name=__codelineno-0-390></a><a href=#__codelineno-0-390><span class=linenos data-linenos="390 "></span></a>    <span class=n>complexity</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>0.0</span><span class=p>,</span>
</span><span id=__span-0-391><a id=__codelineno-0-391 name=__codelineno-0-391></a><a href=#__codelineno-0-391><span class=linenos data-linenos="391 "></span></a>    <span class=n>skip_reason</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-392><a id=__codelineno-0-392 name=__codelineno-0-392></a><a href=#__codelineno-0-392><span class=linenos data-linenos="392 "></span></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-393><a id=__codelineno-0-393 name=__codelineno-0-393></a><a href=#__codelineno-0-393><span class=linenos data-linenos="393 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Record an instillation event.</span>
</span><span id=__span-0-394><a id=__codelineno-0-394 name=__codelineno-0-394></a><a href=#__codelineno-0-394><span class=linenos data-linenos="394 "></span></a>
</span><span id=__span-0-395><a id=__codelineno-0-395 name=__codelineno-0-395></a><a href=#__codelineno-0-395><span class=linenos data-linenos="395 "></span></a><span class=sd>    Args:</span>
</span><span id=__span-0-396><a id=__codelineno-0-396 name=__codelineno-0-396></a><a href=#__codelineno-0-396><span class=linenos data-linenos="396 "></span></a><span class=sd>        tenet_count: Number of tenets instilled</span>
</span><span id=__span-0-397><a id=__codelineno-0-397 name=__codelineno-0-397></a><a href=#__codelineno-0-397><span class=linenos data-linenos="397 "></span></a><span class=sd>        token_increase: Tokens added</span>
</span><span id=__span-0-398><a id=__codelineno-0-398 name=__codelineno-0-398></a><a href=#__codelineno-0-398><span class=linenos data-linenos="398 "></span></a><span class=sd>        strategy: Strategy used</span>
</span><span id=__span-0-399><a id=__codelineno-0-399 name=__codelineno-0-399></a><a href=#__codelineno-0-399><span class=linenos data-linenos="399 "></span></a><span class=sd>        session: Session identifier</span>
</span><span id=__span-0-400><a id=__codelineno-0-400 name=__codelineno-0-400></a><a href=#__codelineno-0-400><span class=linenos data-linenos="400 "></span></a><span class=sd>        complexity: Context complexity score</span>
</span><span id=__span-0-401><a id=__codelineno-0-401 name=__codelineno-0-401></a><a href=#__codelineno-0-401><span class=linenos data-linenos="401 "></span></a><span class=sd>        skip_reason: Reason if skipped</span>
</span><span id=__span-0-402><a id=__codelineno-0-402 name=__codelineno-0-402></a><a href=#__codelineno-0-402><span class=linenos data-linenos="402 "></span></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-0-403><a id=__codelineno-0-403 name=__codelineno-0-403></a><a href=#__codelineno-0-403><span class=linenos data-linenos="403 "></span></a>    <span class=n>record</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-0-404><a id=__codelineno-0-404 name=__codelineno-0-404></a><a href=#__codelineno-0-404><span class=linenos data-linenos="404 "></span></a>        <span class=s2>&quot;timestamp&quot;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>(),</span>
</span><span id=__span-0-405><a id=__codelineno-0-405 name=__codelineno-0-405></a><a href=#__codelineno-0-405><span class=linenos data-linenos="405 "></span></a>        <span class=s2>&quot;tenet_count&quot;</span><span class=p>:</span> <span class=n>tenet_count</span><span class=p>,</span>
</span><span id=__span-0-406><a id=__codelineno-0-406 name=__codelineno-0-406></a><a href=#__codelineno-0-406><span class=linenos data-linenos="406 "></span></a>        <span class=s2>&quot;token_increase&quot;</span><span class=p>:</span> <span class=n>token_increase</span><span class=p>,</span>
</span><span id=__span-0-407><a id=__codelineno-0-407 name=__codelineno-0-407></a><a href=#__codelineno-0-407><span class=linenos data-linenos="407 "></span></a>        <span class=s2>&quot;strategy&quot;</span><span class=p>:</span> <span class=n>strategy</span><span class=p>,</span>
</span><span id=__span-0-408><a id=__codelineno-0-408 name=__codelineno-0-408></a><a href=#__codelineno-0-408><span class=linenos data-linenos="408 "></span></a>        <span class=s2>&quot;session&quot;</span><span class=p>:</span> <span class=n>session</span><span class=p>,</span>
</span><span id=__span-0-409><a id=__codelineno-0-409 name=__codelineno-0-409></a><a href=#__codelineno-0-409><span class=linenos data-linenos="409 "></span></a>        <span class=s2>&quot;complexity&quot;</span><span class=p>:</span> <span class=n>complexity</span><span class=p>,</span>
</span><span id=__span-0-410><a id=__codelineno-0-410 name=__codelineno-0-410></a><a href=#__codelineno-0-410><span class=linenos data-linenos="410 "></span></a>        <span class=s2>&quot;skip_reason&quot;</span><span class=p>:</span> <span class=n>skip_reason</span><span class=p>,</span>
</span><span id=__span-0-411><a id=__codelineno-0-411 name=__codelineno-0-411></a><a href=#__codelineno-0-411><span class=linenos data-linenos="411 "></span></a>    <span class=p>}</span>
</span><span id=__span-0-412><a id=__codelineno-0-412 name=__codelineno-0-412></a><a href=#__codelineno-0-412><span class=linenos data-linenos="412 "></span></a>
</span><span id=__span-0-413><a id=__codelineno-0-413 name=__codelineno-0-413></a><a href=#__codelineno-0-413><span class=linenos data-linenos="413 "></span></a>    <span class=bp>self</span><span class=o>.</span><span class=n>instillations</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>record</span><span class=p>)</span>
</span><span id=__span-0-414><a id=__codelineno-0-414 name=__codelineno-0-414></a><a href=#__codelineno-0-414><span class=linenos data-linenos="414 "></span></a>
</span><span id=__span-0-415><a id=__codelineno-0-415 name=__codelineno-0-415></a><a href=#__codelineno-0-415><span class=linenos data-linenos="415 "></span></a>    <span class=k>if</span> <span class=n>skip_reason</span><span class=p>:</span>
</span><span id=__span-0-416><a id=__codelineno-0-416 name=__codelineno-0-416></a><a href=#__codelineno-0-416><span class=linenos data-linenos="416 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>skip_reasons</span><span class=p>[</span><span class=n>skip_reason</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
</span><span id=__span-0-417><a id=__codelineno-0-417 name=__codelineno-0-417></a><a href=#__codelineno-0-417><span class=linenos data-linenos="417 "></span></a>        <span class=k>return</span>
</span><span id=__span-0-418><a id=__codelineno-0-418 name=__codelineno-0-418></a><a href=#__codelineno-0-418><span class=linenos data-linenos="418 "></span></a>
</span><span id=__span-0-419><a id=__codelineno-0-419 name=__codelineno-0-419></a><a href=#__codelineno-0-419><span class=linenos data-linenos="419 "></span></a>    <span class=bp>self</span><span class=o>.</span><span class=n>strategy_usage</span><span class=p>[</span><span class=n>strategy</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
</span><span id=__span-0-420><a id=__codelineno-0-420 name=__codelineno-0-420></a><a href=#__codelineno-0-420><span class=linenos data-linenos="420 "></span></a>
</span><span id=__span-0-421><a id=__codelineno-0-421 name=__codelineno-0-421></a><a href=#__codelineno-0-421><span class=linenos data-linenos="421 "></span></a>    <span class=k>if</span> <span class=n>session</span><span class=p>:</span>
</span><span id=__span-0-422><a id=__codelineno-0-422 name=__codelineno-0-422></a><a href=#__codelineno-0-422><span class=linenos data-linenos="422 "></span></a>        <span class=n>metrics</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>session_metrics</span><span class=p>[</span><span class=n>session</span><span class=p>]</span>
</span><span id=__span-0-423><a id=__codelineno-0-423 name=__codelineno-0-423></a><a href=#__codelineno-0-423><span class=linenos data-linenos="423 "></span></a>        <span class=n>metrics</span><span class=p>[</span><span class=s2>&quot;total_instillations&quot;</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
</span><span id=__span-0-424><a id=__codelineno-0-424 name=__codelineno-0-424></a><a href=#__codelineno-0-424><span class=linenos data-linenos="424 "></span></a>        <span class=n>metrics</span><span class=p>[</span><span class=s2>&quot;total_tenets&quot;</span><span class=p>]</span> <span class=o>+=</span> <span class=n>tenet_count</span>
</span><span id=__span-0-425><a id=__codelineno-0-425 name=__codelineno-0-425></a><a href=#__codelineno-0-425><span class=linenos data-linenos="425 "></span></a>        <span class=n>metrics</span><span class=p>[</span><span class=s2>&quot;total_tokens&quot;</span><span class=p>]</span> <span class=o>+=</span> <span class=n>token_increase</span>
</span><span id=__span-0-426><a id=__codelineno-0-426 name=__codelineno-0-426></a><a href=#__codelineno-0-426><span class=linenos data-linenos="426 "></span></a>        <span class=n>metrics</span><span class=p>[</span><span class=s2>&quot;strategies_used&quot;</span><span class=p>][</span><span class=n>strategy</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
</span><span id=__span-0-427><a id=__codelineno-0-427 name=__codelineno-0-427></a><a href=#__codelineno-0-427><span class=linenos data-linenos="427 "></span></a>        <span class=n>metrics</span><span class=p>[</span><span class=s2>&quot;complexity_scores&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>complexity</span><span class=p>)</span>
</span></code></pre></div></details></div></div><div class="doc doc-object doc-function"><h6 id=tenets.core.instiller.instiller.MetricsTracker.record_tenet_usage class="doc doc-heading"><code class="doc-symbol doc-symbol-heading doc-symbol-method"></code> <span class="doc doc-object-name doc-function-name">record_tenet_usage</span><a href=#tenets.core.instiller.instiller.MetricsTracker.record_tenet_usage class=headerlink title="Link to this section">&para;</a></h6><div class="language-python doc-signature highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>record_tenet_usage</span><span class=p>(</span><span class=n>tenet_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span>
</span></code></pre></div><div class="doc doc-contents "><p>Record that a tenet was used.</p><table><thead><tr><th><span class=doc-section-title>PARAMETER</span></th><th><span>DESCRIPTION</span></th></tr></thead><tbody><tr class=doc-section-item><td><code>tenet_id</code></td><td class=doc-param-details><div class=doc-md-description><p>Tenet identifier</p></div><p><span class=doc-param-annotation><b>TYPE:</b><code><a class="autorefs autorefs-external" href=https://docs.python.org/3/library/stdtypes.html#str>str</a></code></span></p></td></tr></tbody></table><details class=mkdocstrings-source><summary>Source code in <code>tenets/core/instiller/instiller.py</code></summary><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-0-429><a id=__codelineno-0-429 name=__codelineno-0-429></a><a href=#__codelineno-0-429><span class=linenos data-linenos="429 "></span></a><span class=k>def</span><span class=w> </span><span class=nf>record_tenet_usage</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>tenet_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-430><a id=__codelineno-0-430 name=__codelineno-0-430></a><a href=#__codelineno-0-430><span class=linenos data-linenos="430 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Record that a tenet was used.</span>
</span><span id=__span-0-431><a id=__codelineno-0-431 name=__codelineno-0-431></a><a href=#__codelineno-0-431><span class=linenos data-linenos="431 "></span></a>
</span><span id=__span-0-432><a id=__codelineno-0-432 name=__codelineno-0-432></a><a href=#__codelineno-0-432><span class=linenos data-linenos="432 "></span></a><span class=sd>    Args:</span>
</span><span id=__span-0-433><a id=__codelineno-0-433 name=__codelineno-0-433></a><a href=#__codelineno-0-433><span class=linenos data-linenos="433 "></span></a><span class=sd>        tenet_id: Tenet identifier</span>
</span><span id=__span-0-434><a id=__codelineno-0-434 name=__codelineno-0-434></a><a href=#__codelineno-0-434><span class=linenos data-linenos="434 "></span></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-0-435><a id=__codelineno-0-435 name=__codelineno-0-435></a><a href=#__codelineno-0-435><span class=linenos data-linenos="435 "></span></a>    <span class=bp>self</span><span class=o>.</span><span class=n>tenet_usage</span><span class=p>[</span><span class=n>tenet_id</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
</span></code></pre></div></details></div></div><div class="doc doc-object doc-function"><h6 id=tenets.core.instiller.instiller.MetricsTracker.get_metrics class="doc doc-heading"><code class="doc-symbol doc-symbol-heading doc-symbol-method"></code> <span class="doc doc-object-name doc-function-name">get_metrics</span><a href=#tenets.core.instiller.instiller.MetricsTracker.get_metrics class=headerlink title="Link to this section">&para;</a></h6><div class="language-python doc-signature highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>get_metrics</span><span class=p>(</span><span class=n>session</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span>
</span></code></pre></div><div class="doc doc-contents "><p>Get aggregated metrics.</p><table><thead><tr><th><span class=doc-section-title>PARAMETER</span></th><th><span>DESCRIPTION</span></th></tr></thead><tbody><tr class=doc-section-item><td><code>session</code></td><td class=doc-param-details><div class=doc-md-description><p>Optional session filter</p></div><p><span class=doc-param-annotation><b>TYPE:</b><code><a class="autorefs autorefs-external" title="<code>typing.Optional</code>" href=https://docs.python.org/3/library/typing.html#typing.Optional>Optional</a>[<a class="autorefs autorefs-external" href=https://docs.python.org/3/library/stdtypes.html#str>str</a>]</code></span><span class=doc-param-default><b>DEFAULT:</b><code>None</code></span></p></td></tr></tbody></table><table><thead><tr><th><span class=doc-section-title>RETURNS</span></th><th><span>DESCRIPTION</span></th></tr></thead><tbody><tr class=doc-section-item><td><span class=doc-returns-annotation><code><a class="autorefs autorefs-external" title="<code>typing.Dict</code>" href=https://docs.python.org/3/library/typing.html#typing.Dict>Dict</a>[<a class="autorefs autorefs-external" href=https://docs.python.org/3/library/stdtypes.html#str>str</a>, <a class="autorefs autorefs-external" title="<code>typing.Any</code>" href=https://docs.python.org/3/library/typing.html#typing.Any>Any</a>]</code></span></td><td class=doc-returns-details><div class=doc-md-description><p>Dictionary of metrics</p></div></td></tr></tbody></table><details class=mkdocstrings-source><summary>Source code in <code>tenets/core/instiller/instiller.py</code></summary><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-0-437><a id=__codelineno-0-437 name=__codelineno-0-437></a><a href=#__codelineno-0-437><span class=linenos data-linenos="437 "></span></a><span class=k>def</span><span class=w> </span><span class=nf>get_metrics</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>session</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span><span id=__span-0-438><a id=__codelineno-0-438 name=__codelineno-0-438></a><a href=#__codelineno-0-438><span class=linenos data-linenos="438 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Get aggregated metrics.</span>
</span><span id=__span-0-439><a id=__codelineno-0-439 name=__codelineno-0-439></a><a href=#__codelineno-0-439><span class=linenos data-linenos="439 "></span></a>
</span><span id=__span-0-440><a id=__codelineno-0-440 name=__codelineno-0-440></a><a href=#__codelineno-0-440><span class=linenos data-linenos="440 "></span></a><span class=sd>    Args:</span>
</span><span id=__span-0-441><a id=__codelineno-0-441 name=__codelineno-0-441></a><a href=#__codelineno-0-441><span class=linenos data-linenos="441 "></span></a><span class=sd>        session: Optional session filter</span>
</span><span id=__span-0-442><a id=__codelineno-0-442 name=__codelineno-0-442></a><a href=#__codelineno-0-442><span class=linenos data-linenos="442 "></span></a>
</span><span id=__span-0-443><a id=__codelineno-0-443 name=__codelineno-0-443></a><a href=#__codelineno-0-443><span class=linenos data-linenos="443 "></span></a><span class=sd>    Returns:</span>
</span><span id=__span-0-444><a id=__codelineno-0-444 name=__codelineno-0-444></a><a href=#__codelineno-0-444><span class=linenos data-linenos="444 "></span></a><span class=sd>        Dictionary of metrics</span>
</span><span id=__span-0-445><a id=__codelineno-0-445 name=__codelineno-0-445></a><a href=#__codelineno-0-445><span class=linenos data-linenos="445 "></span></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-0-446><a id=__codelineno-0-446 name=__codelineno-0-446></a><a href=#__codelineno-0-446><span class=linenos data-linenos="446 "></span></a>    <span class=k>if</span> <span class=n>session</span><span class=p>:</span>
</span><span id=__span-0-447><a id=__codelineno-0-447 name=__codelineno-0-447></a><a href=#__codelineno-0-447><span class=linenos data-linenos="447 "></span></a>        <span class=n>records</span> <span class=o>=</span> <span class=p>[</span><span class=n>r</span> <span class=k>for</span> <span class=n>r</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>instillations</span> <span class=k>if</span> <span class=n>r</span><span class=p>[</span><span class=s2>&quot;session&quot;</span><span class=p>]</span> <span class=o>==</span> <span class=n>session</span><span class=p>]</span>
</span><span id=__span-0-448><a id=__codelineno-0-448 name=__codelineno-0-448></a><a href=#__codelineno-0-448><span class=linenos data-linenos="448 "></span></a>    <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-449><a id=__codelineno-0-449 name=__codelineno-0-449></a><a href=#__codelineno-0-449><span class=linenos data-linenos="449 "></span></a>        <span class=n>records</span> <span class=o>=</span> <span class=p>[</span><span class=n>r</span> <span class=k>for</span> <span class=n>r</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>instillations</span> <span class=k>if</span> <span class=ow>not</span> <span class=n>r</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;skip_reason&quot;</span><span class=p>)]</span>
</span><span id=__span-0-450><a id=__codelineno-0-450 name=__codelineno-0-450></a><a href=#__codelineno-0-450><span class=linenos data-linenos="450 "></span></a>
</span><span id=__span-0-451><a id=__codelineno-0-451 name=__codelineno-0-451></a><a href=#__codelineno-0-451><span class=linenos data-linenos="451 "></span></a>    <span class=k>if</span> <span class=ow>not</span> <span class=n>records</span><span class=p>:</span>
</span><span id=__span-0-452><a id=__codelineno-0-452 name=__codelineno-0-452></a><a href=#__codelineno-0-452><span class=linenos data-linenos="452 "></span></a>        <span class=k>return</span> <span class=p>{</span><span class=s2>&quot;message&quot;</span><span class=p>:</span> <span class=s2>&quot;No instillation records found&quot;</span><span class=p>}</span>
</span><span id=__span-0-453><a id=__codelineno-0-453 name=__codelineno-0-453></a><a href=#__codelineno-0-453><span class=linenos data-linenos="453 "></span></a>
</span><span id=__span-0-454><a id=__codelineno-0-454 name=__codelineno-0-454></a><a href=#__codelineno-0-454><span class=linenos data-linenos="454 "></span></a>    <span class=n>total_tenets</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>(</span><span class=n>r</span><span class=p>[</span><span class=s2>&quot;tenet_count&quot;</span><span class=p>]</span> <span class=k>for</span> <span class=n>r</span> <span class=ow>in</span> <span class=n>records</span><span class=p>)</span>
</span><span id=__span-0-455><a id=__codelineno-0-455 name=__codelineno-0-455></a><a href=#__codelineno-0-455><span class=linenos data-linenos="455 "></span></a>    <span class=n>total_tokens</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>(</span><span class=n>r</span><span class=p>[</span><span class=s2>&quot;token_increase&quot;</span><span class=p>]</span> <span class=k>for</span> <span class=n>r</span> <span class=ow>in</span> <span class=n>records</span><span class=p>)</span>
</span><span id=__span-0-456><a id=__codelineno-0-456 name=__codelineno-0-456></a><a href=#__codelineno-0-456><span class=linenos data-linenos="456 "></span></a>    <span class=n>complexities</span> <span class=o>=</span> <span class=p>[</span><span class=n>r</span><span class=p>[</span><span class=s2>&quot;complexity&quot;</span><span class=p>]</span> <span class=k>for</span> <span class=n>r</span> <span class=ow>in</span> <span class=n>records</span> <span class=k>if</span> <span class=n>r</span><span class=p>[</span><span class=s2>&quot;complexity&quot;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>]</span>
</span><span id=__span-0-457><a id=__codelineno-0-457 name=__codelineno-0-457></a><a href=#__codelineno-0-457><span class=linenos data-linenos="457 "></span></a>
</span><span id=__span-0-458><a id=__codelineno-0-458 name=__codelineno-0-458></a><a href=#__codelineno-0-458><span class=linenos data-linenos="458 "></span></a>    <span class=n>metrics</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-0-459><a id=__codelineno-0-459 name=__codelineno-0-459></a><a href=#__codelineno-0-459><span class=linenos data-linenos="459 "></span></a>        <span class=s2>&quot;total_instillations&quot;</span><span class=p>:</span> <span class=nb>len</span><span class=p>(</span><span class=n>records</span><span class=p>),</span>
</span><span id=__span-0-460><a id=__codelineno-0-460 name=__codelineno-0-460></a><a href=#__codelineno-0-460><span class=linenos data-linenos="460 "></span></a>        <span class=s2>&quot;total_tenets_instilled&quot;</span><span class=p>:</span> <span class=n>total_tenets</span><span class=p>,</span>
</span><span id=__span-0-461><a id=__codelineno-0-461 name=__codelineno-0-461></a><a href=#__codelineno-0-461><span class=linenos data-linenos="461 "></span></a>        <span class=s2>&quot;total_token_increase&quot;</span><span class=p>:</span> <span class=n>total_tokens</span><span class=p>,</span>
</span><span id=__span-0-462><a id=__codelineno-0-462 name=__codelineno-0-462></a><a href=#__codelineno-0-462><span class=linenos data-linenos="462 "></span></a>        <span class=s2>&quot;avg_tenets_per_context&quot;</span><span class=p>:</span> <span class=n>total_tenets</span> <span class=o>/</span> <span class=nb>len</span><span class=p>(</span><span class=n>records</span><span class=p>)</span> <span class=k>if</span> <span class=n>records</span> <span class=k>else</span> <span class=mi>0</span><span class=p>,</span>
</span><span id=__span-0-463><a id=__codelineno-0-463 name=__codelineno-0-463></a><a href=#__codelineno-0-463><span class=linenos data-linenos="463 "></span></a>        <span class=s2>&quot;avg_token_increase&quot;</span><span class=p>:</span> <span class=n>total_tokens</span> <span class=o>/</span> <span class=nb>len</span><span class=p>(</span><span class=n>records</span><span class=p>)</span> <span class=k>if</span> <span class=n>records</span> <span class=k>else</span> <span class=mi>0</span><span class=p>,</span>
</span><span id=__span-0-464><a id=__codelineno-0-464 name=__codelineno-0-464></a><a href=#__codelineno-0-464><span class=linenos data-linenos="464 "></span></a>        <span class=c1># Round to avoid floating comparison noise in tests</span>
</span><span id=__span-0-465><a id=__codelineno-0-465 name=__codelineno-0-465></a><a href=#__codelineno-0-465><span class=linenos data-linenos="465 "></span></a>        <span class=s2>&quot;avg_complexity&quot;</span><span class=p>:</span> <span class=nb>round</span><span class=p>(</span>
</span><span id=__span-0-466><a id=__codelineno-0-466 name=__codelineno-0-466></a><a href=#__codelineno-0-466><span class=linenos data-linenos="466 "></span></a>            <span class=p>(</span><span class=nb>sum</span><span class=p>(</span><span class=n>complexities</span><span class=p>)</span> <span class=o>/</span> <span class=nb>len</span><span class=p>(</span><span class=n>complexities</span><span class=p>))</span> <span class=k>if</span> <span class=n>complexities</span> <span class=k>else</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>1</span>
</span><span id=__span-0-467><a id=__codelineno-0-467 name=__codelineno-0-467></a><a href=#__codelineno-0-467><span class=linenos data-linenos="467 "></span></a>        <span class=p>),</span>
</span><span id=__span-0-468><a id=__codelineno-0-468 name=__codelineno-0-468></a><a href=#__codelineno-0-468><span class=linenos data-linenos="468 "></span></a>        <span class=s2>&quot;strategy_distribution&quot;</span><span class=p>:</span> <span class=nb>dict</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>strategy_usage</span><span class=p>),</span>
</span><span id=__span-0-469><a id=__codelineno-0-469 name=__codelineno-0-469></a><a href=#__codelineno-0-469><span class=linenos data-linenos="469 "></span></a>        <span class=s2>&quot;skip_distribution&quot;</span><span class=p>:</span> <span class=nb>dict</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>skip_reasons</span><span class=p>),</span>
</span><span id=__span-0-470><a id=__codelineno-0-470 name=__codelineno-0-470></a><a href=#__codelineno-0-470><span class=linenos data-linenos="470 "></span></a>        <span class=s2>&quot;top_tenets&quot;</span><span class=p>:</span> <span class=nb>sorted</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>tenet_usage</span><span class=o>.</span><span class=n>items</span><span class=p>(),</span> <span class=n>key</span><span class=o>=</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>reverse</span><span class=o>=</span><span class=kc>True</span><span class=p>)[:</span><span class=mi>10</span><span class=p>],</span>
</span><span id=__span-0-471><a id=__codelineno-0-471 name=__codelineno-0-471></a><a href=#__codelineno-0-471><span class=linenos data-linenos="471 "></span></a>    <span class=p>}</span>
</span><span id=__span-0-472><a id=__codelineno-0-472 name=__codelineno-0-472></a><a href=#__codelineno-0-472><span class=linenos data-linenos="472 "></span></a>
</span><span id=__span-0-473><a id=__codelineno-0-473 name=__codelineno-0-473></a><a href=#__codelineno-0-473><span class=linenos data-linenos="473 "></span></a>    <span class=k>if</span> <span class=n>session</span><span class=p>:</span>
</span><span id=__span-0-474><a id=__codelineno-0-474 name=__codelineno-0-474></a><a href=#__codelineno-0-474><span class=linenos data-linenos="474 "></span></a>        <span class=n>metrics</span><span class=p>[</span><span class=s2>&quot;session_specific&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>session_metrics</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>session</span><span class=p>,</span> <span class=p>{})</span>
</span><span id=__span-0-475><a id=__codelineno-0-475 name=__codelineno-0-475></a><a href=#__codelineno-0-475><span class=linenos data-linenos="475 "></span></a>
</span><span id=__span-0-476><a id=__codelineno-0-476 name=__codelineno-0-476></a><a href=#__codelineno-0-476><span class=linenos data-linenos="476 "></span></a>    <span class=k>return</span> <span class=n>metrics</span>
</span></code></pre></div></details></div></div><div class="doc doc-object doc-function"><h6 id=tenets.core.instiller.instiller.MetricsTracker.get_all_metrics class="doc doc-heading"><code class="doc-symbol doc-symbol-heading doc-symbol-method"></code> <span class="doc doc-object-name doc-function-name">get_all_metrics</span><a href=#tenets.core.instiller.instiller.MetricsTracker.get_all_metrics class=headerlink title="Link to this section">&para;</a></h6><div class="language-python doc-signature highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>get_all_metrics</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span>
</span></code></pre></div><div class="doc doc-contents "><p>Get all tracked metrics for export.</p><details class=mkdocstrings-source><summary>Source code in <code>tenets/core/instiller/instiller.py</code></summary><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-0-478><a id=__codelineno-0-478 name=__codelineno-0-478></a><a href=#__codelineno-0-478><span class=linenos data-linenos="478 "></span></a><span class=k>def</span><span class=w> </span><span class=nf>get_all_metrics</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span><span id=__span-0-479><a id=__codelineno-0-479 name=__codelineno-0-479></a><a href=#__codelineno-0-479><span class=linenos data-linenos="479 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Get all tracked metrics for export.&quot;&quot;&quot;</span>
</span><span id=__span-0-480><a id=__codelineno-0-480 name=__codelineno-0-480></a><a href=#__codelineno-0-480><span class=linenos data-linenos="480 "></span></a>    <span class=k>return</span> <span class=p>{</span>
</span><span id=__span-0-481><a id=__codelineno-0-481 name=__codelineno-0-481></a><a href=#__codelineno-0-481><span class=linenos data-linenos="481 "></span></a>        <span class=s2>&quot;instillations&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>instillations</span><span class=p>,</span>
</span><span id=__span-0-482><a id=__codelineno-0-482 name=__codelineno-0-482></a><a href=#__codelineno-0-482><span class=linenos data-linenos="482 "></span></a>        <span class=s2>&quot;session_metrics&quot;</span><span class=p>:</span> <span class=nb>dict</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>session_metrics</span><span class=p>),</span>
</span><span id=__span-0-483><a id=__codelineno-0-483 name=__codelineno-0-483></a><a href=#__codelineno-0-483><span class=linenos data-linenos="483 "></span></a>        <span class=s2>&quot;strategy_usage&quot;</span><span class=p>:</span> <span class=nb>dict</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>strategy_usage</span><span class=p>),</span>
</span><span id=__span-0-484><a id=__codelineno-0-484 name=__codelineno-0-484></a><a href=#__codelineno-0-484><span class=linenos data-linenos="484 "></span></a>        <span class=s2>&quot;tenet_usage&quot;</span><span class=p>:</span> <span class=nb>dict</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>tenet_usage</span><span class=p>),</span>
</span><span id=__span-0-485><a id=__codelineno-0-485 name=__codelineno-0-485></a><a href=#__codelineno-0-485><span class=linenos data-linenos="485 "></span></a>        <span class=s2>&quot;skip_reasons&quot;</span><span class=p>:</span> <span class=nb>dict</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>skip_reasons</span><span class=p>),</span>
</span><span id=__span-0-486><a id=__codelineno-0-486 name=__codelineno-0-486></a><a href=#__codelineno-0-486><span class=linenos data-linenos="486 "></span></a>        <span class=s2>&quot;summary&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_metrics</span><span class=p>(),</span>
</span><span id=__span-0-487><a id=__codelineno-0-487 name=__codelineno-0-487></a><a href=#__codelineno-0-487><span class=linenos data-linenos="487 "></span></a>    <span class=p>}</span>
</span></code></pre></div></details></div></div></div></div></div><div class="doc doc-object doc-class"><h4 id=tenets.core.instiller.instiller.Instiller class="doc doc-heading"><code class="doc-symbol doc-symbol-heading doc-symbol-class"></code> <span class="doc doc-object-name doc-class-name">Instiller</span><a href=#tenets.core.instiller.instiller.Instiller class=headerlink title="Link to this section">&para;</a></h4><div class="language-python doc-signature highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>Instiller</span><span class=p>(</span><span class=n>config</span><span class=p>:</span> <span class=n>TenetsConfig</span><span class=p>)</span>
</span></code></pre></div><div class="doc doc-contents "><p>Main orchestrator for tenet instillation with smart injection.</p><p>The Instiller manages the entire process of injecting tenets into context, including: - Tracking injection history per session - Analyzing context complexity - Determining optimal injection frequency - Selecting appropriate tenets - Applying injection strategies - Recording metrics and effectiveness</p><p>It supports multiple injection modes: - Always: Inject into every context - Periodic: Inject every Nth distillation - Adaptive: Smart injection based on complexity and session - Manual: Only inject when explicitly requested</p><p>Initialize the Instiller.</p><table><thead><tr><th><span class=doc-section-title>PARAMETER</span></th><th><span>DESCRIPTION</span></th></tr></thead><tbody><tr class=doc-section-item><td><code>config</code></td><td class=doc-param-details><div class=doc-md-description><p>Configuration object</p></div><p><span class=doc-param-annotation><b>TYPE:</b><code><a class="autorefs autorefs-internal" title='<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">TenetsConfig</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span> (<code>tenets.config.TenetsConfig</code>)' href=../../../config/#tenets.config.TenetsConfig>TenetsConfig</a></code></span></p></td></tr></tbody></table><details class=mkdocstrings-source><summary>Source code in <code>tenets/core/instiller/instiller.py</code></summary><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-0-509><a id=__codelineno-0-509 name=__codelineno-0-509></a><a href=#__codelineno-0-509><span class=linenos data-linenos="509 "></span></a><span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>config</span><span class=p>:</span> <span class=n>TenetsConfig</span><span class=p>):</span>
</span><span id=__span-0-510><a id=__codelineno-0-510 name=__codelineno-0-510></a><a href=#__codelineno-0-510><span class=linenos data-linenos="510 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Initialize the Instiller.</span>
</span><span id=__span-0-511><a id=__codelineno-0-511 name=__codelineno-0-511></a><a href=#__codelineno-0-511><span class=linenos data-linenos="511 "></span></a>
</span><span id=__span-0-512><a id=__codelineno-0-512 name=__codelineno-0-512></a><a href=#__codelineno-0-512><span class=linenos data-linenos="512 "></span></a><span class=sd>    Args:</span>
</span><span id=__span-0-513><a id=__codelineno-0-513 name=__codelineno-0-513></a><a href=#__codelineno-0-513><span class=linenos data-linenos="513 "></span></a><span class=sd>        config: Configuration object</span>
</span><span id=__span-0-514><a id=__codelineno-0-514 name=__codelineno-0-514></a><a href=#__codelineno-0-514><span class=linenos data-linenos="514 "></span></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-0-515><a id=__codelineno-0-515 name=__codelineno-0-515></a><a href=#__codelineno-0-515><span class=linenos data-linenos="515 "></span></a>    <span class=bp>self</span><span class=o>.</span><span class=n>config</span> <span class=o>=</span> <span class=n>config</span>
</span><span id=__span-0-516><a id=__codelineno-0-516 name=__codelineno-0-516></a><a href=#__codelineno-0-516><span class=linenos data-linenos="516 "></span></a>    <span class=bp>self</span><span class=o>.</span><span class=n>logger</span> <span class=o>=</span> <span class=n>get_logger</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span><span id=__span-0-517><a id=__codelineno-0-517 name=__codelineno-0-517></a><a href=#__codelineno-0-517><span class=linenos data-linenos="517 "></span></a>
</span><span id=__span-0-518><a id=__codelineno-0-518 name=__codelineno-0-518></a><a href=#__codelineno-0-518><span class=linenos data-linenos="518 "></span></a>    <span class=c1># Core components</span>
</span><span id=__span-0-519><a id=__codelineno-0-519 name=__codelineno-0-519></a><a href=#__codelineno-0-519><span class=linenos data-linenos="519 "></span></a>    <span class=bp>self</span><span class=o>.</span><span class=n>manager</span> <span class=o>=</span> <span class=n>TenetManager</span><span class=p>(</span><span class=n>config</span><span class=p>)</span>
</span><span id=__span-0-520><a id=__codelineno-0-520 name=__codelineno-0-520></a><a href=#__codelineno-0-520><span class=linenos data-linenos="520 "></span></a>    <span class=bp>self</span><span class=o>.</span><span class=n>injector</span> <span class=o>=</span> <span class=n>TenetInjector</span><span class=p>(</span><span class=n>config</span><span class=o>.</span><span class=n>tenet</span><span class=o>.</span><span class=n>injection_config</span><span class=p>)</span>
</span><span id=__span-0-521><a id=__codelineno-0-521 name=__codelineno-0-521></a><a href=#__codelineno-0-521><span class=linenos data-linenos="521 "></span></a>    <span class=bp>self</span><span class=o>.</span><span class=n>complexity_analyzer</span> <span class=o>=</span> <span class=n>ComplexityAnalyzer</span><span class=p>(</span><span class=n>config</span><span class=p>)</span>
</span><span id=__span-0-522><a id=__codelineno-0-522 name=__codelineno-0-522></a><a href=#__codelineno-0-522><span class=linenos data-linenos="522 "></span></a>    <span class=bp>self</span><span class=o>.</span><span class=n>metrics_tracker</span> <span class=o>=</span> <span class=n>MetricsTracker</span><span class=p>()</span>
</span><span id=__span-0-523><a id=__codelineno-0-523 name=__codelineno-0-523></a><a href=#__codelineno-0-523><span class=linenos data-linenos="523 "></span></a>
</span><span id=__span-0-524><a id=__codelineno-0-524 name=__codelineno-0-524></a><a href=#__codelineno-0-524><span class=linenos data-linenos="524 "></span></a>    <span class=c1># Session tracking</span>
</span><span id=__span-0-525><a id=__codelineno-0-525 name=__codelineno-0-525></a><a href=#__codelineno-0-525><span class=linenos data-linenos="525 "></span></a>    <span class=bp>self</span><span class=o>.</span><span class=n>session_histories</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>InjectionHistory</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-0-526><a id=__codelineno-0-526 name=__codelineno-0-526></a><a href=#__codelineno-0-526><span class=linenos data-linenos="526 "></span></a>
</span><span id=__span-0-527><a id=__codelineno-0-527 name=__codelineno-0-527></a><a href=#__codelineno-0-527><span class=linenos data-linenos="527 "></span></a>    <span class=c1># Load histories only when cache is enabled to avoid test cross-contamination</span>
</span><span id=__span-0-528><a id=__codelineno-0-528 name=__codelineno-0-528></a><a href=#__codelineno-0-528><span class=linenos data-linenos="528 "></span></a>    <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-529><a id=__codelineno-0-529 name=__codelineno-0-529></a><a href=#__codelineno-0-529><span class=linenos data-linenos="529 "></span></a>        <span class=k>if</span> <span class=nb>getattr</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>cache</span><span class=p>,</span> <span class=s2>&quot;enabled&quot;</span><span class=p>,</span> <span class=kc>False</span><span class=p>):</span>
</span><span id=__span-0-530><a id=__codelineno-0-530 name=__codelineno-0-530></a><a href=#__codelineno-0-530><span class=linenos data-linenos="530 "></span></a>            <span class=bp>self</span><span class=o>.</span><span class=n>_load_session_histories</span><span class=p>()</span>
</span><span id=__span-0-531><a id=__codelineno-0-531 name=__codelineno-0-531></a><a href=#__codelineno-0-531><span class=linenos data-linenos="531 "></span></a>    <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
</span><span id=__span-0-532><a id=__codelineno-0-532 name=__codelineno-0-532></a><a href=#__codelineno-0-532><span class=linenos data-linenos="532 "></span></a>        <span class=k>pass</span>
</span><span id=__span-0-533><a id=__codelineno-0-533 name=__codelineno-0-533></a><a href=#__codelineno-0-533><span class=linenos data-linenos="533 "></span></a>    <span class=c1># Track which sessions had system instruction injected (tests expect this map)</span>
</span><span id=__span-0-534><a id=__codelineno-0-534 name=__codelineno-0-534></a><a href=#__codelineno-0-534><span class=linenos data-linenos="534 "></span></a>    <span class=bp>self</span><span class=o>.</span><span class=n>system_instruction_injected</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>bool</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-0-535><a id=__codelineno-0-535 name=__codelineno-0-535></a><a href=#__codelineno-0-535><span class=linenos data-linenos="535 "></span></a>    <span class=c1># Do NOT seed from persisted histories: once-per-session should apply</span>
</span><span id=__span-0-536><a id=__codelineno-0-536 name=__codelineno-0-536></a><a href=#__codelineno-0-536><span class=linenos data-linenos="536 "></span></a>    <span class=c1># only within the lifetime of this Instiller instance. Persisted</span>
</span><span id=__span-0-537><a id=__codelineno-0-537 name=__codelineno-0-537></a><a href=#__codelineno-0-537><span class=linenos data-linenos="537 "></span></a>    <span class=c1># histories are still maintained for analytics but must not block</span>
</span><span id=__span-0-538><a id=__codelineno-0-538 name=__codelineno-0-538></a><a href=#__codelineno-0-538><span class=linenos data-linenos="538 "></span></a>    <span class=c1># first injection in fresh instances (tests rely on this behavior).</span>
</span><span id=__span-0-539><a id=__codelineno-0-539 name=__codelineno-0-539></a><a href=#__codelineno-0-539><span class=linenos data-linenos="539 "></span></a>
</span><span id=__span-0-540><a id=__codelineno-0-540 name=__codelineno-0-540></a><a href=#__codelineno-0-540><span class=linenos data-linenos="540 "></span></a>    <span class=bp>self</span><span class=o>.</span><span class=n>_load_session_histories</span><span class=p>()</span>
</span><span id=__span-0-541><a id=__codelineno-0-541 name=__codelineno-0-541></a><a href=#__codelineno-0-541><span class=linenos data-linenos="541 "></span></a>
</span><span id=__span-0-542><a id=__codelineno-0-542 name=__codelineno-0-542></a><a href=#__codelineno-0-542><span class=linenos data-linenos="542 "></span></a>    <span class=c1># Cache for results</span>
</span><span id=__span-0-543><a id=__codelineno-0-543 name=__codelineno-0-543></a><a href=#__codelineno-0-543><span class=linenos data-linenos="543 "></span></a>    <span class=bp>self</span><span class=o>.</span><span class=n>_cache</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>InstillationResult</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-0-544><a id=__codelineno-0-544 name=__codelineno-0-544></a><a href=#__codelineno-0-544><span class=linenos data-linenos="544 "></span></a>
</span><span id=__span-0-545><a id=__codelineno-0-545 name=__codelineno-0-545></a><a href=#__codelineno-0-545><span class=linenos data-linenos="545 "></span></a>    <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;Instiller initialized with smart injection capabilities&quot;</span><span class=p>)</span>
</span></code></pre></div></details><div class="doc doc-children"><h5 id=tenets.core.instiller.instiller.Instiller-functions>Functions<a href=#tenets.core.instiller.instiller.Instiller-functions class=headerlink title="Link to this section">&para;</a></h5><div class="doc doc-object doc-function"><h6 id=tenets.core.instiller.instiller.Instiller.inject_system_instruction class="doc doc-heading"><code class="doc-symbol doc-symbol-heading doc-symbol-method"></code> <span class="doc doc-object-name doc-function-name">inject_system_instruction</span><a href=#tenets.core.instiller.instiller.Instiller.inject_system_instruction class=headerlink title="Link to this section">&para;</a></h6><div class="language-python doc-signature highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>inject_system_instruction</span><span class=p>(</span><span class=n>content</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=nb>format</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s1>&#39;markdown&#39;</span><span class=p>,</span> <span class=n>session</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span>
</span></code></pre></div><div class="doc doc-contents "><p>Inject system instruction (system prompt) according to config.</p><p>Behavior: - If system instruction is disabled or empty, return unchanged. - If session provided and once-per-session is enabled, inject only on first distill. - If no session, inject on every distill. - Placement controlled by system_instruction_position. - Formatting controlled by system_instruction_format.</p><p>Returns modified content and metadata about injection.</p><details class=mkdocstrings-source><summary>Source code in <code>tenets/core/instiller/instiller.py</code></summary><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-0-547><a id=__codelineno-0-547 name=__codelineno-0-547></a><a href=#__codelineno-0-547><span class=linenos data-linenos="547 "></span></a><span class=k>def</span><span class=w> </span><span class=nf>inject_system_instruction</span><span class=p>(</span>
</span><span id=__span-0-548><a id=__codelineno-0-548 name=__codelineno-0-548></a><a href=#__codelineno-0-548><span class=linenos data-linenos="548 "></span></a>    <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-549><a id=__codelineno-0-549 name=__codelineno-0-549></a><a href=#__codelineno-0-549><span class=linenos data-linenos="549 "></span></a>    <span class=n>content</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-550><a id=__codelineno-0-550 name=__codelineno-0-550></a><a href=#__codelineno-0-550><span class=linenos data-linenos="550 "></span></a>    <span class=nb>format</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;markdown&quot;</span><span class=p>,</span>
</span><span id=__span-0-551><a id=__codelineno-0-551 name=__codelineno-0-551></a><a href=#__codelineno-0-551><span class=linenos data-linenos="551 "></span></a>    <span class=n>session</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-552><a id=__codelineno-0-552 name=__codelineno-0-552></a><a href=#__codelineno-0-552><span class=linenos data-linenos="552 "></span></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]:</span>
</span><span id=__span-0-553><a id=__codelineno-0-553 name=__codelineno-0-553></a><a href=#__codelineno-0-553><span class=linenos data-linenos="553 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Inject system instruction (system prompt) according to config.</span>
</span><span id=__span-0-554><a id=__codelineno-0-554 name=__codelineno-0-554></a><a href=#__codelineno-0-554><span class=linenos data-linenos="554 "></span></a>
</span><span id=__span-0-555><a id=__codelineno-0-555 name=__codelineno-0-555></a><a href=#__codelineno-0-555><span class=linenos data-linenos="555 "></span></a><span class=sd>    Behavior:</span>
</span><span id=__span-0-556><a id=__codelineno-0-556 name=__codelineno-0-556></a><a href=#__codelineno-0-556><span class=linenos data-linenos="556 "></span></a><span class=sd>    - If system instruction is disabled or empty, return unchanged.</span>
</span><span id=__span-0-557><a id=__codelineno-0-557 name=__codelineno-0-557></a><a href=#__codelineno-0-557><span class=linenos data-linenos="557 "></span></a><span class=sd>    - If session provided and once-per-session is enabled, inject only on first distill.</span>
</span><span id=__span-0-558><a id=__codelineno-0-558 name=__codelineno-0-558></a><a href=#__codelineno-0-558><span class=linenos data-linenos="558 "></span></a><span class=sd>    - If no session, inject on every distill.</span>
</span><span id=__span-0-559><a id=__codelineno-0-559 name=__codelineno-0-559></a><a href=#__codelineno-0-559><span class=linenos data-linenos="559 "></span></a><span class=sd>    - Placement controlled by system_instruction_position.</span>
</span><span id=__span-0-560><a id=__codelineno-0-560 name=__codelineno-0-560></a><a href=#__codelineno-0-560><span class=linenos data-linenos="560 "></span></a><span class=sd>    - Formatting controlled by system_instruction_format.</span>
</span><span id=__span-0-561><a id=__codelineno-0-561 name=__codelineno-0-561></a><a href=#__codelineno-0-561><span class=linenos data-linenos="561 "></span></a>
</span><span id=__span-0-562><a id=__codelineno-0-562 name=__codelineno-0-562></a><a href=#__codelineno-0-562><span class=linenos data-linenos="562 "></span></a><span class=sd>    Returns modified content and metadata about injection.</span>
</span><span id=__span-0-563><a id=__codelineno-0-563 name=__codelineno-0-563></a><a href=#__codelineno-0-563><span class=linenos data-linenos="563 "></span></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-0-564><a id=__codelineno-0-564 name=__codelineno-0-564></a><a href=#__codelineno-0-564><span class=linenos data-linenos="564 "></span></a>    <span class=n>cfg</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>tenet</span>
</span><span id=__span-0-565><a id=__codelineno-0-565 name=__codelineno-0-565></a><a href=#__codelineno-0-565><span class=linenos data-linenos="565 "></span></a>    <span class=n>meta</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-0-566><a id=__codelineno-0-566 name=__codelineno-0-566></a><a href=#__codelineno-0-566><span class=linenos data-linenos="566 "></span></a>        <span class=s2>&quot;system_instruction_enabled&quot;</span><span class=p>:</span> <span class=n>cfg</span><span class=o>.</span><span class=n>system_instruction_enabled</span><span class=p>,</span>
</span><span id=__span-0-567><a id=__codelineno-0-567 name=__codelineno-0-567></a><a href=#__codelineno-0-567><span class=linenos data-linenos="567 "></span></a>        <span class=s2>&quot;system_instruction_injected&quot;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span>
</span><span id=__span-0-568><a id=__codelineno-0-568 name=__codelineno-0-568></a><a href=#__codelineno-0-568><span class=linenos data-linenos="568 "></span></a>    <span class=p>}</span>
</span><span id=__span-0-569><a id=__codelineno-0-569 name=__codelineno-0-569></a><a href=#__codelineno-0-569><span class=linenos data-linenos="569 "></span></a>
</span><span id=__span-0-570><a id=__codelineno-0-570 name=__codelineno-0-570></a><a href=#__codelineno-0-570><span class=linenos data-linenos="570 "></span></a>    <span class=k>if</span> <span class=ow>not</span> <span class=n>cfg</span><span class=o>.</span><span class=n>system_instruction_enabled</span> <span class=ow>or</span> <span class=ow>not</span> <span class=n>cfg</span><span class=o>.</span><span class=n>system_instruction</span><span class=p>:</span>
</span><span id=__span-0-571><a id=__codelineno-0-571 name=__codelineno-0-571></a><a href=#__codelineno-0-571><span class=linenos data-linenos="571 "></span></a>        <span class=n>meta</span><span class=p>[</span><span class=s2>&quot;reason&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;disabled_or_empty&quot;</span>
</span><span id=__span-0-572><a id=__codelineno-0-572 name=__codelineno-0-572></a><a href=#__codelineno-0-572><span class=linenos data-linenos="572 "></span></a>        <span class=k>return</span> <span class=n>content</span><span class=p>,</span> <span class=n>meta</span>
</span><span id=__span-0-573><a id=__codelineno-0-573 name=__codelineno-0-573></a><a href=#__codelineno-0-573><span class=linenos data-linenos="573 "></span></a>
</span><span id=__span-0-574><a id=__codelineno-0-574 name=__codelineno-0-574></a><a href=#__codelineno-0-574><span class=linenos data-linenos="574 "></span></a>    <span class=c1># Session-aware check: only once per session</span>
</span><span id=__span-0-575><a id=__codelineno-0-575 name=__codelineno-0-575></a><a href=#__codelineno-0-575><span class=linenos data-linenos="575 "></span></a>    <span class=k>if</span> <span class=n>session</span> <span class=ow>and</span> <span class=nb>getattr</span><span class=p>(</span><span class=n>cfg</span><span class=p>,</span> <span class=s2>&quot;system_instruction_once_per_session&quot;</span><span class=p>,</span> <span class=kc>False</span><span class=p>):</span>
</span><span id=__span-0-576><a id=__codelineno-0-576 name=__codelineno-0-576></a><a href=#__codelineno-0-576><span class=linenos data-linenos="576 "></span></a>        <span class=c1># Respect once-per-session within this instance and, when allowed,</span>
</span><span id=__span-0-577><a id=__codelineno-0-577 name=__codelineno-0-577></a><a href=#__codelineno-0-577><span class=linenos data-linenos="577 "></span></a>        <span class=c1># across instances via persisted history.</span>
</span><span id=__span-0-578><a id=__codelineno-0-578 name=__codelineno-0-578></a><a href=#__codelineno-0-578><span class=linenos data-linenos="578 "></span></a>        <span class=n>already</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>system_instruction_injected</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>session</span><span class=p>,</span> <span class=kc>False</span><span class=p>)</span>
</span><span id=__span-0-579><a id=__codelineno-0-579 name=__codelineno-0-579></a><a href=#__codelineno-0-579><span class=linenos data-linenos="579 "></span></a>        <span class=c1># Only consult persisted histories when policy allows it</span>
</span><span id=__span-0-580><a id=__codelineno-0-580 name=__codelineno-0-580></a><a href=#__codelineno-0-580><span class=linenos data-linenos="580 "></span></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>already</span> <span class=ow>and</span> <span class=bp>self</span><span class=o>.</span><span class=n>_should_respect_persisted_once_per_session</span><span class=p>():</span>
</span><span id=__span-0-581><a id=__codelineno-0-581 name=__codelineno-0-581></a><a href=#__codelineno-0-581><span class=linenos data-linenos="581 "></span></a>            <span class=n>hist</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>session_histories</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>session</span><span class=p>)</span>
</span><span id=__span-0-582><a id=__codelineno-0-582 name=__codelineno-0-582></a><a href=#__codelineno-0-582><span class=linenos data-linenos="582 "></span></a>            <span class=n>already</span> <span class=o>=</span> <span class=nb>bool</span><span class=p>(</span><span class=n>hist</span> <span class=ow>and</span> <span class=nb>getattr</span><span class=p>(</span><span class=n>hist</span><span class=p>,</span> <span class=s2>&quot;system_instruction_injected&quot;</span><span class=p>,</span> <span class=kc>False</span><span class=p>))</span>
</span><span id=__span-0-583><a id=__codelineno-0-583 name=__codelineno-0-583></a><a href=#__codelineno-0-583><span class=linenos data-linenos="583 "></span></a>        <span class=k>if</span> <span class=n>already</span><span class=p>:</span>
</span><span id=__span-0-584><a id=__codelineno-0-584 name=__codelineno-0-584></a><a href=#__codelineno-0-584><span class=linenos data-linenos="584 "></span></a>            <span class=n>meta</span><span class=p>[</span><span class=s2>&quot;reason&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;already_injected_in_session&quot;</span>
</span><span id=__span-0-585><a id=__codelineno-0-585 name=__codelineno-0-585></a><a href=#__codelineno-0-585><span class=linenos data-linenos="585 "></span></a>            <span class=k>return</span> <span class=n>content</span><span class=p>,</span> <span class=n>meta</span>
</span><span id=__span-0-586><a id=__codelineno-0-586 name=__codelineno-0-586></a><a href=#__codelineno-0-586><span class=linenos data-linenos="586 "></span></a>
</span><span id=__span-0-587><a id=__codelineno-0-587 name=__codelineno-0-587></a><a href=#__codelineno-0-587><span class=linenos data-linenos="587 "></span></a>    <span class=c1># Mark as injecting now that we&#39;ve passed guards</span>
</span><span id=__span-0-588><a id=__codelineno-0-588 name=__codelineno-0-588></a><a href=#__codelineno-0-588><span class=linenos data-linenos="588 "></span></a>    <span class=n>meta</span><span class=p>[</span><span class=s2>&quot;system_instruction_injected&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=kc>True</span>
</span><span id=__span-0-589><a id=__codelineno-0-589 name=__codelineno-0-589></a><a href=#__codelineno-0-589><span class=linenos data-linenos="589 "></span></a>
</span><span id=__span-0-590><a id=__codelineno-0-590 name=__codelineno-0-590></a><a href=#__codelineno-0-590><span class=linenos data-linenos="590 "></span></a>    <span class=n>instruction</span> <span class=o>=</span> <span class=n>cfg</span><span class=o>.</span><span class=n>system_instruction</span>
</span><span id=__span-0-591><a id=__codelineno-0-591 name=__codelineno-0-591></a><a href=#__codelineno-0-591><span class=linenos data-linenos="591 "></span></a>    <span class=n>formatted_instr</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_format_system_instruction</span><span class=p>(</span>
</span><span id=__span-0-592><a id=__codelineno-0-592 name=__codelineno-0-592></a><a href=#__codelineno-0-592><span class=linenos data-linenos="592 "></span></a>        <span class=n>instruction</span><span class=p>,</span> <span class=n>cfg</span><span class=o>.</span><span class=n>system_instruction_format</span>
</span><span id=__span-0-593><a id=__codelineno-0-593 name=__codelineno-0-593></a><a href=#__codelineno-0-593><span class=linenos data-linenos="593 "></span></a>    <span class=p>)</span>
</span><span id=__span-0-594><a id=__codelineno-0-594 name=__codelineno-0-594></a><a href=#__codelineno-0-594><span class=linenos data-linenos="594 "></span></a>
</span><span id=__span-0-595><a id=__codelineno-0-595 name=__codelineno-0-595></a><a href=#__codelineno-0-595><span class=linenos data-linenos="595 "></span></a>    <span class=c1># Optional label and separator</span>
</span><span id=__span-0-596><a id=__codelineno-0-596 name=__codelineno-0-596></a><a href=#__codelineno-0-596><span class=linenos data-linenos="596 "></span></a>    <span class=n>label</span> <span class=o>=</span> <span class=nb>getattr</span><span class=p>(</span><span class=n>cfg</span><span class=p>,</span> <span class=s2>&quot;system_instruction_label&quot;</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span> <span class=ow>or</span> <span class=s2>&quot;🎯 System Context&quot;</span>
</span><span id=__span-0-597><a id=__codelineno-0-597 name=__codelineno-0-597></a><a href=#__codelineno-0-597><span class=linenos data-linenos="597 "></span></a>    <span class=n>separator</span> <span class=o>=</span> <span class=nb>getattr</span><span class=p>(</span><span class=n>cfg</span><span class=p>,</span> <span class=s2>&quot;system_instruction_separator&quot;</span><span class=p>,</span> <span class=s2>&quot;</span><span class=se>\n</span><span class=s2>---</span><span class=se>\n\n</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-598><a id=__codelineno-0-598 name=__codelineno-0-598></a><a href=#__codelineno-0-598><span class=linenos data-linenos="598 "></span></a>
</span><span id=__span-0-599><a id=__codelineno-0-599 name=__codelineno-0-599></a><a href=#__codelineno-0-599><span class=linenos data-linenos="599 "></span></a>    <span class=c1># Build final block per format</span>
</span><span id=__span-0-600><a id=__codelineno-0-600 name=__codelineno-0-600></a><a href=#__codelineno-0-600><span class=linenos data-linenos="600 "></span></a>    <span class=k>if</span> <span class=n>cfg</span><span class=o>.</span><span class=n>system_instruction_format</span> <span class=o>==</span> <span class=s2>&quot;markdown&quot;</span><span class=p>:</span>
</span><span id=__span-0-601><a id=__codelineno-0-601 name=__codelineno-0-601></a><a href=#__codelineno-0-601><span class=linenos data-linenos="601 "></span></a>        <span class=n>formatted_block</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;## </span><span class=si>{</span><span class=n>label</span><span class=si>}</span><span class=se>\n\n</span><span class=si>{</span><span class=n>instruction</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-602><a id=__codelineno-0-602 name=__codelineno-0-602></a><a href=#__codelineno-0-602><span class=linenos data-linenos="602 "></span></a>    <span class=k>elif</span> <span class=n>cfg</span><span class=o>.</span><span class=n>system_instruction_format</span> <span class=o>==</span> <span class=s2>&quot;plain&quot;</span><span class=p>:</span>
</span><span id=__span-0-603><a id=__codelineno-0-603 name=__codelineno-0-603></a><a href=#__codelineno-0-603><span class=linenos data-linenos="603 "></span></a>        <span class=n>formatted_block</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>label</span><span class=si>}</span><span class=se>\n\n</span><span class=si>{</span><span class=n>instruction</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-604><a id=__codelineno-0-604 name=__codelineno-0-604></a><a href=#__codelineno-0-604><span class=linenos data-linenos="604 "></span></a>    <span class=k>elif</span> <span class=n>cfg</span><span class=o>.</span><span class=n>system_instruction_format</span> <span class=o>==</span> <span class=s2>&quot;comment&quot;</span><span class=p>:</span>
</span><span id=__span-0-605><a id=__codelineno-0-605 name=__codelineno-0-605></a><a href=#__codelineno-0-605><span class=linenos data-linenos="605 "></span></a>        <span class=c1># For injected content, wrap as HTML comment so it embeds safely in text</span>
</span><span id=__span-0-606><a id=__codelineno-0-606 name=__codelineno-0-606></a><a href=#__codelineno-0-606><span class=linenos data-linenos="606 "></span></a>        <span class=n>formatted_block</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;&lt;!-- </span><span class=si>{</span><span class=n>instruction</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span><span class=si>}</span><span class=s2> --&gt;&quot;</span>
</span><span id=__span-0-607><a id=__codelineno-0-607 name=__codelineno-0-607></a><a href=#__codelineno-0-607><span class=linenos data-linenos="607 "></span></a>    <span class=k>elif</span> <span class=n>cfg</span><span class=o>.</span><span class=n>system_instruction_format</span> <span class=o>==</span> <span class=s2>&quot;xml&quot;</span><span class=p>:</span>
</span><span id=__span-0-608><a id=__codelineno-0-608 name=__codelineno-0-608></a><a href=#__codelineno-0-608><span class=linenos data-linenos="608 "></span></a>        <span class=c1># Integration tests expect hyphenated tag name here</span>
</span><span id=__span-0-609><a id=__codelineno-0-609 name=__codelineno-0-609></a><a href=#__codelineno-0-609><span class=linenos data-linenos="609 "></span></a>        <span class=n>formatted_block</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;&lt;system-instruction&gt;</span><span class=si>{</span><span class=n>instruction</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span><span class=si>}</span><span class=s2>&lt;/system-instruction&gt;&quot;</span>
</span><span id=__span-0-610><a id=__codelineno-0-610 name=__codelineno-0-610></a><a href=#__codelineno-0-610><span class=linenos data-linenos="610 "></span></a>    <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-611><a id=__codelineno-0-611 name=__codelineno-0-611></a><a href=#__codelineno-0-611><span class=linenos data-linenos="611 "></span></a>        <span class=c1># xml or comment, rely on formatter</span>
</span><span id=__span-0-612><a id=__codelineno-0-612 name=__codelineno-0-612></a><a href=#__codelineno-0-612><span class=linenos data-linenos="612 "></span></a>        <span class=n>formatted_block</span> <span class=o>=</span> <span class=n>formatted_instr</span>
</span><span id=__span-0-613><a id=__codelineno-0-613 name=__codelineno-0-613></a><a href=#__codelineno-0-613><span class=linenos data-linenos="613 "></span></a>
</span><span id=__span-0-614><a id=__codelineno-0-614 name=__codelineno-0-614></a><a href=#__codelineno-0-614><span class=linenos data-linenos="614 "></span></a>    <span class=c1># Determine position</span>
</span><span id=__span-0-615><a id=__codelineno-0-615 name=__codelineno-0-615></a><a href=#__codelineno-0-615><span class=linenos data-linenos="615 "></span></a>    <span class=k>if</span> <span class=n>cfg</span><span class=o>.</span><span class=n>system_instruction_position</span> <span class=o>==</span> <span class=s2>&quot;top&quot;</span><span class=p>:</span>
</span><span id=__span-0-616><a id=__codelineno-0-616 name=__codelineno-0-616></a><a href=#__codelineno-0-616><span class=linenos data-linenos="616 "></span></a>        <span class=n>modified</span> <span class=o>=</span> <span class=n>formatted_block</span> <span class=o>+</span> <span class=n>separator</span> <span class=o>+</span> <span class=n>content</span>
</span><span id=__span-0-617><a id=__codelineno-0-617 name=__codelineno-0-617></a><a href=#__codelineno-0-617><span class=linenos data-linenos="617 "></span></a>        <span class=n>position</span> <span class=o>=</span> <span class=s2>&quot;top&quot;</span>
</span><span id=__span-0-618><a id=__codelineno-0-618 name=__codelineno-0-618></a><a href=#__codelineno-0-618><span class=linenos data-linenos="618 "></span></a>    <span class=k>elif</span> <span class=n>cfg</span><span class=o>.</span><span class=n>system_instruction_position</span> <span class=o>==</span> <span class=s2>&quot;after_header&quot;</span><span class=p>:</span>
</span><span id=__span-0-619><a id=__codelineno-0-619 name=__codelineno-0-619></a><a href=#__codelineno-0-619><span class=linenos data-linenos="619 "></span></a>        <span class=c1># After first markdown header or beginning if not found</span>
</span><span id=__span-0-620><a id=__codelineno-0-620 name=__codelineno-0-620></a><a href=#__codelineno-0-620><span class=linenos data-linenos="620 "></span></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-621><a id=__codelineno-0-621 name=__codelineno-0-621></a><a href=#__codelineno-0-621><span class=linenos data-linenos="621 "></span></a>            <span class=kn>import</span><span class=w> </span><span class=nn>re</span>
</span><span id=__span-0-622><a id=__codelineno-0-622 name=__codelineno-0-622></a><a href=#__codelineno-0-622><span class=linenos data-linenos="622 "></span></a>
</span><span id=__span-0-623><a id=__codelineno-0-623 name=__codelineno-0-623></a><a href=#__codelineno-0-623><span class=linenos data-linenos="623 "></span></a>            <span class=c1># Match first Markdown header line</span>
</span><span id=__span-0-624><a id=__codelineno-0-624 name=__codelineno-0-624></a><a href=#__codelineno-0-624><span class=linenos data-linenos="624 "></span></a>            <span class=n>header_match</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=sa>r</span><span class=s2>&quot;^#+\s+.*$&quot;</span><span class=p>,</span> <span class=n>content</span><span class=p>,</span> <span class=n>flags</span><span class=o>=</span><span class=n>re</span><span class=o>.</span><span class=n>MULTILINE</span><span class=p>)</span>
</span><span id=__span-0-625><a id=__codelineno-0-625 name=__codelineno-0-625></a><a href=#__codelineno-0-625><span class=linenos data-linenos="625 "></span></a>        <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
</span><span id=__span-0-626><a id=__codelineno-0-626 name=__codelineno-0-626></a><a href=#__codelineno-0-626><span class=linenos data-linenos="626 "></span></a>            <span class=n>header_match</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-0-627><a id=__codelineno-0-627 name=__codelineno-0-627></a><a href=#__codelineno-0-627><span class=linenos data-linenos="627 "></span></a>        <span class=k>if</span> <span class=n>header_match</span><span class=p>:</span>
</span><span id=__span-0-628><a id=__codelineno-0-628 name=__codelineno-0-628></a><a href=#__codelineno-0-628><span class=linenos data-linenos="628 "></span></a>            <span class=n>idx</span> <span class=o>=</span> <span class=n>header_match</span><span class=o>.</span><span class=n>end</span><span class=p>()</span>
</span><span id=__span-0-629><a id=__codelineno-0-629 name=__codelineno-0-629></a><a href=#__codelineno-0-629><span class=linenos data-linenos="629 "></span></a>            <span class=n>modified</span> <span class=o>=</span> <span class=n>content</span><span class=p>[:</span><span class=n>idx</span><span class=p>]</span> <span class=o>+</span> <span class=s2>&quot;</span><span class=se>\n\n</span><span class=s2>&quot;</span> <span class=o>+</span> <span class=n>formatted_block</span> <span class=o>+</span> <span class=n>content</span><span class=p>[</span><span class=n>idx</span><span class=p>:]</span>
</span><span id=__span-0-630><a id=__codelineno-0-630 name=__codelineno-0-630></a><a href=#__codelineno-0-630><span class=linenos data-linenos="630 "></span></a>            <span class=n>position</span> <span class=o>=</span> <span class=s2>&quot;after_header&quot;</span>
</span><span id=__span-0-631><a id=__codelineno-0-631 name=__codelineno-0-631></a><a href=#__codelineno-0-631><span class=linenos data-linenos="631 "></span></a>        <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-632><a id=__codelineno-0-632 name=__codelineno-0-632></a><a href=#__codelineno-0-632><span class=linenos data-linenos="632 "></span></a>            <span class=n>modified</span> <span class=o>=</span> <span class=n>formatted_block</span> <span class=o>+</span> <span class=n>separator</span> <span class=o>+</span> <span class=n>content</span>
</span><span id=__span-0-633><a id=__codelineno-0-633 name=__codelineno-0-633></a><a href=#__codelineno-0-633><span class=linenos data-linenos="633 "></span></a>            <span class=n>position</span> <span class=o>=</span> <span class=s2>&quot;top_fallback&quot;</span>
</span><span id=__span-0-634><a id=__codelineno-0-634 name=__codelineno-0-634></a><a href=#__codelineno-0-634><span class=linenos data-linenos="634 "></span></a>    <span class=k>elif</span> <span class=n>cfg</span><span class=o>.</span><span class=n>system_instruction_position</span> <span class=o>==</span> <span class=s2>&quot;before_content&quot;</span><span class=p>:</span>
</span><span id=__span-0-635><a id=__codelineno-0-635 name=__codelineno-0-635></a><a href=#__codelineno-0-635><span class=linenos data-linenos="635 "></span></a>        <span class=c1># Before first non-empty line</span>
</span><span id=__span-0-636><a id=__codelineno-0-636 name=__codelineno-0-636></a><a href=#__codelineno-0-636><span class=linenos data-linenos="636 "></span></a>        <span class=n>lines</span> <span class=o>=</span> <span class=n>content</span><span class=o>.</span><span class=n>splitlines</span><span class=p>()</span>
</span><span id=__span-0-637><a id=__codelineno-0-637 name=__codelineno-0-637></a><a href=#__codelineno-0-637><span class=linenos data-linenos="637 "></span></a>        <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span>
</span><span id=__span-0-638><a id=__codelineno-0-638 name=__codelineno-0-638></a><a href=#__codelineno-0-638><span class=linenos data-linenos="638 "></span></a>        <span class=k>while</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=nb>len</span><span class=p>(</span><span class=n>lines</span><span class=p>)</span> <span class=ow>and</span> <span class=ow>not</span> <span class=n>lines</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>.</span><span class=n>strip</span><span class=p>():</span>
</span><span id=__span-0-639><a id=__codelineno-0-639 name=__codelineno-0-639></a><a href=#__codelineno-0-639><span class=linenos data-linenos="639 "></span></a>            <span class=n>i</span> <span class=o>+=</span> <span class=mi>1</span>
</span><span id=__span-0-640><a id=__codelineno-0-640 name=__codelineno-0-640></a><a href=#__codelineno-0-640><span class=linenos data-linenos="640 "></span></a>        <span class=n>prefix</span> <span class=o>=</span> <span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>lines</span><span class=p>[:</span><span class=n>i</span><span class=p>])</span>
</span><span id=__span-0-641><a id=__codelineno-0-641 name=__codelineno-0-641></a><a href=#__codelineno-0-641><span class=linenos data-linenos="641 "></span></a>        <span class=n>suffix</span> <span class=o>=</span> <span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>lines</span><span class=p>[</span><span class=n>i</span><span class=p>:])</span>
</span><span id=__span-0-642><a id=__codelineno-0-642 name=__codelineno-0-642></a><a href=#__codelineno-0-642><span class=linenos data-linenos="642 "></span></a>
</span><span id=__span-0-643><a id=__codelineno-0-643 name=__codelineno-0-643></a><a href=#__codelineno-0-643><span class=linenos data-linenos="643 "></span></a>        <span class=n>between</span> <span class=o>=</span> <span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span> <span class=k>if</span> <span class=n>suffix</span> <span class=k>else</span> <span class=s2>&quot;&quot;</span>
</span><span id=__span-0-644><a id=__codelineno-0-644 name=__codelineno-0-644></a><a href=#__codelineno-0-644><span class=linenos data-linenos="644 "></span></a>
</span><span id=__span-0-645><a id=__codelineno-0-645 name=__codelineno-0-645></a><a href=#__codelineno-0-645><span class=linenos data-linenos="645 "></span></a>        <span class=n>modified</span> <span class=o>=</span> <span class=p>(</span>
</span><span id=__span-0-646><a id=__codelineno-0-646 name=__codelineno-0-646></a><a href=#__codelineno-0-646><span class=linenos data-linenos="646 "></span></a>            <span class=n>prefix</span>
</span><span id=__span-0-647><a id=__codelineno-0-647 name=__codelineno-0-647></a><a href=#__codelineno-0-647><span class=linenos data-linenos="647 "></span></a>            <span class=o>+</span> <span class=p>(</span><span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span> <span class=k>if</span> <span class=n>prefix</span> <span class=k>else</span> <span class=s2>&quot;&quot;</span><span class=p>)</span>
</span><span id=__span-0-648><a id=__codelineno-0-648 name=__codelineno-0-648></a><a href=#__codelineno-0-648><span class=linenos data-linenos="648 "></span></a>            <span class=o>+</span> <span class=n>formatted_instr</span>
</span><span id=__span-0-649><a id=__codelineno-0-649 name=__codelineno-0-649></a><a href=#__codelineno-0-649><span class=linenos data-linenos="649 "></span></a>            <span class=o>+</span> <span class=p>(</span><span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span> <span class=k>if</span> <span class=n>suffix</span> <span class=k>else</span> <span class=s2>&quot;&quot;</span><span class=p>)</span>
</span><span id=__span-0-650><a id=__codelineno-0-650 name=__codelineno-0-650></a><a href=#__codelineno-0-650><span class=linenos data-linenos="650 "></span></a>            <span class=o>+</span> <span class=n>suffix</span>
</span><span id=__span-0-651><a id=__codelineno-0-651 name=__codelineno-0-651></a><a href=#__codelineno-0-651><span class=linenos data-linenos="651 "></span></a>        <span class=p>)</span>
</span><span id=__span-0-652><a id=__codelineno-0-652 name=__codelineno-0-652></a><a href=#__codelineno-0-652><span class=linenos data-linenos="652 "></span></a>        <span class=n>position</span> <span class=o>=</span> <span class=s2>&quot;before_content&quot;</span>
</span><span id=__span-0-653><a id=__codelineno-0-653 name=__codelineno-0-653></a><a href=#__codelineno-0-653><span class=linenos data-linenos="653 "></span></a>    <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-654><a id=__codelineno-0-654 name=__codelineno-0-654></a><a href=#__codelineno-0-654><span class=linenos data-linenos="654 "></span></a>        <span class=n>modified</span> <span class=o>=</span> <span class=n>formatted_block</span> <span class=o>+</span> <span class=n>separator</span> <span class=o>+</span> <span class=n>content</span>
</span><span id=__span-0-655><a id=__codelineno-0-655 name=__codelineno-0-655></a><a href=#__codelineno-0-655><span class=linenos data-linenos="655 "></span></a>        <span class=n>position</span> <span class=o>=</span> <span class=s2>&quot;top_default&quot;</span>
</span><span id=__span-0-656><a id=__codelineno-0-656 name=__codelineno-0-656></a><a href=#__codelineno-0-656><span class=linenos data-linenos="656 "></span></a>
</span><span id=__span-0-657><a id=__codelineno-0-657 name=__codelineno-0-657></a><a href=#__codelineno-0-657><span class=linenos data-linenos="657 "></span></a>    <span class=c1># Compute token increase (original first, then modified) so patched mocks match</span>
</span><span id=__span-0-658><a id=__codelineno-0-658 name=__codelineno-0-658></a><a href=#__codelineno-0-658><span class=linenos data-linenos="658 "></span></a>    <span class=n>orig_tokens</span> <span class=o>=</span> <span class=n>estimate_tokens</span><span class=p>(</span><span class=n>content</span><span class=p>)</span>
</span><span id=__span-0-659><a id=__codelineno-0-659 name=__codelineno-0-659></a><a href=#__codelineno-0-659><span class=linenos data-linenos="659 "></span></a>
</span><span id=__span-0-660><a id=__codelineno-0-660 name=__codelineno-0-660></a><a href=#__codelineno-0-660><span class=linenos data-linenos="660 "></span></a>    <span class=n>meta</span><span class=o>.</span><span class=n>update</span><span class=p>(</span>
</span><span id=__span-0-661><a id=__codelineno-0-661 name=__codelineno-0-661></a><a href=#__codelineno-0-661><span class=linenos data-linenos="661 "></span></a>        <span class=p>{</span>
</span><span id=__span-0-662><a id=__codelineno-0-662 name=__codelineno-0-662></a><a href=#__codelineno-0-662><span class=linenos data-linenos="662 "></span></a>            <span class=s2>&quot;system_instruction_position&quot;</span><span class=p>:</span> <span class=n>position</span><span class=p>,</span>
</span><span id=__span-0-663><a id=__codelineno-0-663 name=__codelineno-0-663></a><a href=#__codelineno-0-663><span class=linenos data-linenos="663 "></span></a>            <span class=s2>&quot;token_increase&quot;</span><span class=p>:</span> <span class=n>estimate_tokens</span><span class=p>(</span><span class=n>modified</span><span class=p>)</span> <span class=o>-</span> <span class=n>orig_tokens</span><span class=p>,</span>
</span><span id=__span-0-664><a id=__codelineno-0-664 name=__codelineno-0-664></a><a href=#__codelineno-0-664><span class=linenos data-linenos="664 "></span></a>        <span class=p>}</span>
</span><span id=__span-0-665><a id=__codelineno-0-665 name=__codelineno-0-665></a><a href=#__codelineno-0-665><span class=linenos data-linenos="665 "></span></a>    <span class=p>)</span>
</span><span id=__span-0-666><a id=__codelineno-0-666 name=__codelineno-0-666></a><a href=#__codelineno-0-666><span class=linenos data-linenos="666 "></span></a>
</span><span id=__span-0-667><a id=__codelineno-0-667 name=__codelineno-0-667></a><a href=#__codelineno-0-667><span class=linenos data-linenos="667 "></span></a>    <span class=c1># Persist info in metadata when enabled</span>
</span><span id=__span-0-668><a id=__codelineno-0-668 name=__codelineno-0-668></a><a href=#__codelineno-0-668><span class=linenos data-linenos="668 "></span></a>    <span class=k>if</span> <span class=nb>getattr</span><span class=p>(</span><span class=n>cfg</span><span class=p>,</span> <span class=s2>&quot;system_instruction_persist_in_context&quot;</span><span class=p>,</span> <span class=kc>False</span><span class=p>):</span>
</span><span id=__span-0-669><a id=__codelineno-0-669 name=__codelineno-0-669></a><a href=#__codelineno-0-669><span class=linenos data-linenos="669 "></span></a>        <span class=n>meta</span><span class=p>[</span><span class=s2>&quot;system_instruction_persisted&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=kc>True</span>
</span><span id=__span-0-670><a id=__codelineno-0-670 name=__codelineno-0-670></a><a href=#__codelineno-0-670><span class=linenos data-linenos="670 "></span></a>        <span class=n>meta</span><span class=p>[</span><span class=s2>&quot;system_instruction_content&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>instruction</span>
</span><span id=__span-0-671><a id=__codelineno-0-671 name=__codelineno-0-671></a><a href=#__codelineno-0-671><span class=linenos data-linenos="671 "></span></a>
</span><span id=__span-0-672><a id=__codelineno-0-672 name=__codelineno-0-672></a><a href=#__codelineno-0-672><span class=linenos data-linenos="672 "></span></a>    <span class=c1># Mark as injected for this session and persist history if applicable</span>
</span><span id=__span-0-673><a id=__codelineno-0-673 name=__codelineno-0-673></a><a href=#__codelineno-0-673><span class=linenos data-linenos="673 "></span></a>    <span class=k>if</span> <span class=n>session</span><span class=p>:</span>
</span><span id=__span-0-674><a id=__codelineno-0-674 name=__codelineno-0-674></a><a href=#__codelineno-0-674><span class=linenos data-linenos="674 "></span></a>        <span class=c1># Mark in the session map immediately (tests assert this)</span>
</span><span id=__span-0-675><a id=__codelineno-0-675 name=__codelineno-0-675></a><a href=#__codelineno-0-675><span class=linenos data-linenos="675 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>system_instruction_injected</span><span class=p>[</span><span class=n>session</span><span class=p>]</span> <span class=o>=</span> <span class=kc>True</span>
</span><span id=__span-0-676><a id=__codelineno-0-676 name=__codelineno-0-676></a><a href=#__codelineno-0-676><span class=linenos data-linenos="676 "></span></a>        <span class=c1># Also update history record if present</span>
</span><span id=__span-0-677><a id=__codelineno-0-677 name=__codelineno-0-677></a><a href=#__codelineno-0-677><span class=linenos data-linenos="677 "></span></a>        <span class=k>if</span> <span class=n>session</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>session_histories</span><span class=p>:</span>
</span><span id=__span-0-678><a id=__codelineno-0-678 name=__codelineno-0-678></a><a href=#__codelineno-0-678><span class=linenos data-linenos="678 "></span></a>            <span class=bp>self</span><span class=o>.</span><span class=n>session_histories</span><span class=p>[</span><span class=n>session</span><span class=p>]</span> <span class=o>=</span> <span class=n>InjectionHistory</span><span class=p>(</span><span class=n>session_id</span><span class=o>=</span><span class=n>session</span><span class=p>)</span>
</span><span id=__span-0-679><a id=__codelineno-0-679 name=__codelineno-0-679></a><a href=#__codelineno-0-679><span class=linenos data-linenos="679 "></span></a>        <span class=n>hist</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>session_histories</span><span class=p>[</span><span class=n>session</span><span class=p>]</span>
</span><span id=__span-0-680><a id=__codelineno-0-680 name=__codelineno-0-680></a><a href=#__codelineno-0-680><span class=linenos data-linenos="680 "></span></a>        <span class=n>hist</span><span class=o>.</span><span class=n>system_instruction_injected</span> <span class=o>=</span> <span class=kc>True</span>
</span><span id=__span-0-681><a id=__codelineno-0-681 name=__codelineno-0-681></a><a href=#__codelineno-0-681><span class=linenos data-linenos="681 "></span></a>        <span class=n>hist</span><span class=o>.</span><span class=n>updated_at</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span>
</span><span id=__span-0-682><a id=__codelineno-0-682 name=__codelineno-0-682></a><a href=#__codelineno-0-682><span class=linenos data-linenos="682 "></span></a>        <span class=c1># Best-effort save</span>
</span><span id=__span-0-683><a id=__codelineno-0-683 name=__codelineno-0-683></a><a href=#__codelineno-0-683><span class=linenos data-linenos="683 "></span></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-684><a id=__codelineno-0-684 name=__codelineno-0-684></a><a href=#__codelineno-0-684><span class=linenos data-linenos="684 "></span></a>            <span class=bp>self</span><span class=o>.</span><span class=n>_save_session_histories</span><span class=p>()</span>
</span><span id=__span-0-685><a id=__codelineno-0-685 name=__codelineno-0-685></a><a href=#__codelineno-0-685><span class=linenos data-linenos="685 "></span></a>        <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
</span><span id=__span-0-686><a id=__codelineno-0-686 name=__codelineno-0-686></a><a href=#__codelineno-0-686><span class=linenos data-linenos="686 "></span></a>            <span class=k>pass</span>
</span><span id=__span-0-687><a id=__codelineno-0-687 name=__codelineno-0-687></a><a href=#__codelineno-0-687><span class=linenos data-linenos="687 "></span></a>    <span class=k>return</span> <span class=n>modified</span><span class=p>,</span> <span class=n>meta</span>
</span></code></pre></div></details></div></div><div class="doc doc-object doc-function"><h6 id=tenets.core.instiller.instiller.Instiller.instill class="doc doc-heading"><code class="doc-symbol doc-symbol-heading doc-symbol-method"></code> <span class="doc doc-object-name doc-function-name">instill</span><a href=#tenets.core.instiller.instiller.Instiller.instill class=headerlink title="Link to this section">&para;</a></h6><div class="language-python doc-signature highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>instill</span><span class=p>(</span><span class=n>context</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>ContextResult</span><span class=p>],</span> <span class=n>session</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>force</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span> <span class=n>strategy</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>max_tenets</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>check_frequency</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>,</span> <span class=n>inject_system_instruction</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>bool</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Union</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>ContextResult</span><span class=p>]</span>
</span></code></pre></div><div class="doc doc-contents "><p>Instill tenets into context with smart injection.</p><table><thead><tr><th><span class=doc-section-title>PARAMETER</span></th><th><span>DESCRIPTION</span></th></tr></thead><tbody><tr class=doc-section-item><td><code>context</code></td><td class=doc-param-details><div class=doc-md-description><p>Context to inject tenets into</p></div><p><span class=doc-param-annotation><b>TYPE:</b><code><a class="autorefs autorefs-external" title="<code>typing.Union</code>" href=https://docs.python.org/3/library/typing.html#typing.Union>Union</a>[<a class="autorefs autorefs-external" href=https://docs.python.org/3/library/stdtypes.html#str>str</a>, <a class="autorefs autorefs-internal" title='<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">ContextResult</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span> (<code>tenets.models.context.ContextResult</code>)' href=../../../models/context/#tenets.models.context.ContextResult>ContextResult</a>]</code></span></p></td></tr><tr class=doc-section-item><td><code>session</code></td><td class=doc-param-details><div class=doc-md-description><p>Session identifier for tracking</p></div><p><span class=doc-param-annotation><b>TYPE:</b><code><a class="autorefs autorefs-external" title="<code>typing.Optional</code>" href=https://docs.python.org/3/library/typing.html#typing.Optional>Optional</a>[<a class="autorefs autorefs-external" href=https://docs.python.org/3/library/stdtypes.html#str>str</a>]</code></span><span class=doc-param-default><b>DEFAULT:</b><code>None</code></span></p></td></tr><tr class=doc-section-item><td><code>force</code></td><td class=doc-param-details><div class=doc-md-description><p>Force injection regardless of frequency settings</p></div><p><span class=doc-param-annotation><b>TYPE:</b><code><a class="autorefs autorefs-external" href=https://docs.python.org/3/library/functions.html#bool>bool</a></code></span><span class=doc-param-default><b>DEFAULT:</b><code>False</code></span></p></td></tr><tr class=doc-section-item><td><code>strategy</code></td><td class=doc-param-details><div class=doc-md-description><p>Override injection strategy</p></div><p><span class=doc-param-annotation><b>TYPE:</b><code><a class="autorefs autorefs-external" title="<code>typing.Optional</code>" href=https://docs.python.org/3/library/typing.html#typing.Optional>Optional</a>[<a class="autorefs autorefs-external" href=https://docs.python.org/3/library/stdtypes.html#str>str</a>]</code></span><span class=doc-param-default><b>DEFAULT:</b><code>None</code></span></p></td></tr><tr class=doc-section-item><td><code>max_tenets</code></td><td class=doc-param-details><div class=doc-md-description><p>Override maximum tenets</p></div><p><span class=doc-param-annotation><b>TYPE:</b><code><a class="autorefs autorefs-external" title="<code>typing.Optional</code>" href=https://docs.python.org/3/library/typing.html#typing.Optional>Optional</a>[<a class="autorefs autorefs-external" href=https://docs.python.org/3/library/functions.html#int>int</a>]</code></span><span class=doc-param-default><b>DEFAULT:</b><code>None</code></span></p></td></tr><tr class=doc-section-item><td><code>check_frequency</code></td><td class=doc-param-details><div class=doc-md-description><p>Whether to check injection frequency</p></div><p><span class=doc-param-annotation><b>TYPE:</b><code><a class="autorefs autorefs-external" href=https://docs.python.org/3/library/functions.html#bool>bool</a></code></span><span class=doc-param-default><b>DEFAULT:</b><code>True</code></span></p></td></tr></tbody></table><table><thead><tr><th><span class=doc-section-title>RETURNS</span></th><th><span>DESCRIPTION</span></th></tr></thead><tbody><tr class=doc-section-item><td><span class=doc-returns-annotation><code><a class="autorefs autorefs-external" title="<code>typing.Union</code>" href=https://docs.python.org/3/library/typing.html#typing.Union>Union</a>[<a class="autorefs autorefs-external" href=https://docs.python.org/3/library/stdtypes.html#str>str</a>, <a class="autorefs autorefs-internal" title='<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">ContextResult</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span> (<code>tenets.models.context.ContextResult</code>)' href=../../../models/context/#tenets.models.context.ContextResult>ContextResult</a>]</code></span></td><td class=doc-returns-details><div class=doc-md-description><p>Modified context with tenets injected (if applicable)</p></div></td></tr></tbody></table><details class=mkdocstrings-source><summary>Source code in <code>tenets/core/instiller/instiller.py</code></summary><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-0-799><a id=__codelineno-0-799 name=__codelineno-0-799></a><a href=#__codelineno-0-799><span class=linenos data-linenos=" 799 "></span></a><span class=k>def</span><span class=w> </span><span class=nf>instill</span><span class=p>(</span>
</span><span id=__span-0-800><a id=__codelineno-0-800 name=__codelineno-0-800></a><a href=#__codelineno-0-800><span class=linenos data-linenos=" 800 "></span></a>    <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-801><a id=__codelineno-0-801 name=__codelineno-0-801></a><a href=#__codelineno-0-801><span class=linenos data-linenos=" 801 "></span></a>    <span class=n>context</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>ContextResult</span><span class=p>],</span>
</span><span id=__span-0-802><a id=__codelineno-0-802 name=__codelineno-0-802></a><a href=#__codelineno-0-802><span class=linenos data-linenos=" 802 "></span></a>    <span class=n>session</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-803><a id=__codelineno-0-803 name=__codelineno-0-803></a><a href=#__codelineno-0-803><span class=linenos data-linenos=" 803 "></span></a>    <span class=n>force</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
</span><span id=__span-0-804><a id=__codelineno-0-804 name=__codelineno-0-804></a><a href=#__codelineno-0-804><span class=linenos data-linenos=" 804 "></span></a>    <span class=n>strategy</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-805><a id=__codelineno-0-805 name=__codelineno-0-805></a><a href=#__codelineno-0-805><span class=linenos data-linenos=" 805 "></span></a>    <span class=n>max_tenets</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-806><a id=__codelineno-0-806 name=__codelineno-0-806></a><a href=#__codelineno-0-806><span class=linenos data-linenos=" 806 "></span></a>    <span class=n>check_frequency</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>,</span>
</span><span id=__span-0-807><a id=__codelineno-0-807 name=__codelineno-0-807></a><a href=#__codelineno-0-807><span class=linenos data-linenos=" 807 "></span></a>    <span class=n>inject_system_instruction</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>bool</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-808><a id=__codelineno-0-808 name=__codelineno-0-808></a><a href=#__codelineno-0-808><span class=linenos data-linenos=" 808 "></span></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Union</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>ContextResult</span><span class=p>]:</span>
</span><span id=__span-0-809><a id=__codelineno-0-809 name=__codelineno-0-809></a><a href=#__codelineno-0-809><span class=linenos data-linenos=" 809 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Instill tenets into context with smart injection.</span>
</span><span id=__span-0-810><a id=__codelineno-0-810 name=__codelineno-0-810></a><a href=#__codelineno-0-810><span class=linenos data-linenos=" 810 "></span></a>
</span><span id=__span-0-811><a id=__codelineno-0-811 name=__codelineno-0-811></a><a href=#__codelineno-0-811><span class=linenos data-linenos=" 811 "></span></a><span class=sd>    Args:</span>
</span><span id=__span-0-812><a id=__codelineno-0-812 name=__codelineno-0-812></a><a href=#__codelineno-0-812><span class=linenos data-linenos=" 812 "></span></a><span class=sd>        context: Context to inject tenets into</span>
</span><span id=__span-0-813><a id=__codelineno-0-813 name=__codelineno-0-813></a><a href=#__codelineno-0-813><span class=linenos data-linenos=" 813 "></span></a><span class=sd>        session: Session identifier for tracking</span>
</span><span id=__span-0-814><a id=__codelineno-0-814 name=__codelineno-0-814></a><a href=#__codelineno-0-814><span class=linenos data-linenos=" 814 "></span></a><span class=sd>        force: Force injection regardless of frequency settings</span>
</span><span id=__span-0-815><a id=__codelineno-0-815 name=__codelineno-0-815></a><a href=#__codelineno-0-815><span class=linenos data-linenos=" 815 "></span></a><span class=sd>        strategy: Override injection strategy</span>
</span><span id=__span-0-816><a id=__codelineno-0-816 name=__codelineno-0-816></a><a href=#__codelineno-0-816><span class=linenos data-linenos=" 816 "></span></a><span class=sd>        max_tenets: Override maximum tenets</span>
</span><span id=__span-0-817><a id=__codelineno-0-817 name=__codelineno-0-817></a><a href=#__codelineno-0-817><span class=linenos data-linenos=" 817 "></span></a><span class=sd>        check_frequency: Whether to check injection frequency</span>
</span><span id=__span-0-818><a id=__codelineno-0-818 name=__codelineno-0-818></a><a href=#__codelineno-0-818><span class=linenos data-linenos=" 818 "></span></a>
</span><span id=__span-0-819><a id=__codelineno-0-819 name=__codelineno-0-819></a><a href=#__codelineno-0-819><span class=linenos data-linenos=" 819 "></span></a><span class=sd>    Returns:</span>
</span><span id=__span-0-820><a id=__codelineno-0-820 name=__codelineno-0-820></a><a href=#__codelineno-0-820><span class=linenos data-linenos=" 820 "></span></a><span class=sd>        Modified context with tenets injected (if applicable)</span>
</span><span id=__span-0-821><a id=__codelineno-0-821 name=__codelineno-0-821></a><a href=#__codelineno-0-821><span class=linenos data-linenos=" 821 "></span></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-0-822><a id=__codelineno-0-822 name=__codelineno-0-822></a><a href=#__codelineno-0-822><span class=linenos data-linenos=" 822 "></span></a>    <span class=n>start_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span><span id=__span-0-823><a id=__codelineno-0-823 name=__codelineno-0-823></a><a href=#__codelineno-0-823><span class=linenos data-linenos=" 823 "></span></a>
</span><span id=__span-0-824><a id=__codelineno-0-824 name=__codelineno-0-824></a><a href=#__codelineno-0-824><span class=linenos data-linenos=" 824 "></span></a>    <span class=c1># Track session if provided</span>
</span><span id=__span-0-825><a id=__codelineno-0-825 name=__codelineno-0-825></a><a href=#__codelineno-0-825><span class=linenos data-linenos=" 825 "></span></a>    <span class=k>if</span> <span class=n>session</span><span class=p>:</span>
</span><span id=__span-0-826><a id=__codelineno-0-826 name=__codelineno-0-826></a><a href=#__codelineno-0-826><span class=linenos data-linenos=" 826 "></span></a>        <span class=k>if</span> <span class=n>session</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>session_histories</span><span class=p>:</span>
</span><span id=__span-0-827><a id=__codelineno-0-827 name=__codelineno-0-827></a><a href=#__codelineno-0-827><span class=linenos data-linenos=" 827 "></span></a>            <span class=bp>self</span><span class=o>.</span><span class=n>session_histories</span><span class=p>[</span><span class=n>session</span><span class=p>]</span> <span class=o>=</span> <span class=n>InjectionHistory</span><span class=p>(</span><span class=n>session_id</span><span class=o>=</span><span class=n>session</span><span class=p>)</span>
</span><span id=__span-0-828><a id=__codelineno-0-828 name=__codelineno-0-828></a><a href=#__codelineno-0-828><span class=linenos data-linenos=" 828 "></span></a>        <span class=n>history</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>session_histories</span><span class=p>[</span><span class=n>session</span><span class=p>]</span>
</span><span id=__span-0-829><a id=__codelineno-0-829 name=__codelineno-0-829></a><a href=#__codelineno-0-829><span class=linenos data-linenos=" 829 "></span></a>        <span class=n>history</span><span class=o>.</span><span class=n>total_distills</span> <span class=o>+=</span> <span class=mi>1</span>
</span><span id=__span-0-830><a id=__codelineno-0-830 name=__codelineno-0-830></a><a href=#__codelineno-0-830><span class=linenos data-linenos=" 830 "></span></a>    <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-831><a id=__codelineno-0-831 name=__codelineno-0-831></a><a href=#__codelineno-0-831><span class=linenos data-linenos=" 831 "></span></a>        <span class=n>history</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-0-832><a id=__codelineno-0-832 name=__codelineno-0-832></a><a href=#__codelineno-0-832><span class=linenos data-linenos=" 832 "></span></a>
</span><span id=__span-0-833><a id=__codelineno-0-833 name=__codelineno-0-833></a><a href=#__codelineno-0-833><span class=linenos data-linenos=" 833 "></span></a>    <span class=c1># Extract text and format</span>
</span><span id=__span-0-834><a id=__codelineno-0-834 name=__codelineno-0-834></a><a href=#__codelineno-0-834><span class=linenos data-linenos=" 834 "></span></a>    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>context</span><span class=p>,</span> <span class=n>ContextResult</span><span class=p>):</span>
</span><span id=__span-0-835><a id=__codelineno-0-835 name=__codelineno-0-835></a><a href=#__codelineno-0-835><span class=linenos data-linenos=" 835 "></span></a>        <span class=n>text</span> <span class=o>=</span> <span class=n>context</span><span class=o>.</span><span class=n>context</span>
</span><span id=__span-0-836><a id=__codelineno-0-836 name=__codelineno-0-836></a><a href=#__codelineno-0-836><span class=linenos data-linenos=" 836 "></span></a>        <span class=n>format_type</span> <span class=o>=</span> <span class=n>context</span><span class=o>.</span><span class=n>format</span>
</span><span id=__span-0-837><a id=__codelineno-0-837 name=__codelineno-0-837></a><a href=#__codelineno-0-837><span class=linenos data-linenos=" 837 "></span></a>        <span class=n>is_context_result</span> <span class=o>=</span> <span class=kc>True</span>
</span><span id=__span-0-838><a id=__codelineno-0-838 name=__codelineno-0-838></a><a href=#__codelineno-0-838><span class=linenos data-linenos=" 838 "></span></a>    <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-839><a id=__codelineno-0-839 name=__codelineno-0-839></a><a href=#__codelineno-0-839><span class=linenos data-linenos=" 839 "></span></a>        <span class=n>text</span> <span class=o>=</span> <span class=n>context</span>
</span><span id=__span-0-840><a id=__codelineno-0-840 name=__codelineno-0-840></a><a href=#__codelineno-0-840><span class=linenos data-linenos=" 840 "></span></a>        <span class=n>format_type</span> <span class=o>=</span> <span class=s2>&quot;markdown&quot;</span>
</span><span id=__span-0-841><a id=__codelineno-0-841 name=__codelineno-0-841></a><a href=#__codelineno-0-841><span class=linenos data-linenos=" 841 "></span></a>        <span class=n>is_context_result</span> <span class=o>=</span> <span class=kc>False</span>
</span><span id=__span-0-842><a id=__codelineno-0-842 name=__codelineno-0-842></a><a href=#__codelineno-0-842><span class=linenos data-linenos=" 842 "></span></a>
</span><span id=__span-0-843><a id=__codelineno-0-843 name=__codelineno-0-843></a><a href=#__codelineno-0-843><span class=linenos data-linenos=" 843 "></span></a>    <span class=c1># Analyze complexity using the analyzer (tests patch this)</span>
</span><span id=__span-0-844><a id=__codelineno-0-844 name=__codelineno-0-844></a><a href=#__codelineno-0-844><span class=linenos data-linenos=" 844 "></span></a>    <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-845><a id=__codelineno-0-845 name=__codelineno-0-845></a><a href=#__codelineno-0-845><span class=linenos data-linenos=" 845 "></span></a>        <span class=n>complexity</span> <span class=o>=</span> <span class=nb>float</span><span class=p>(</span>
</span><span id=__span-0-846><a id=__codelineno-0-846 name=__codelineno-0-846></a><a href=#__codelineno-0-846><span class=linenos data-linenos=" 846 "></span></a>            <span class=bp>self</span><span class=o>.</span><span class=n>complexity_analyzer</span><span class=o>.</span><span class=n>analyze</span><span class=p>(</span><span class=n>context</span> <span class=k>if</span> <span class=n>is_context_result</span> <span class=k>else</span> <span class=n>text</span><span class=p>)</span>
</span><span id=__span-0-847><a id=__codelineno-0-847 name=__codelineno-0-847></a><a href=#__codelineno-0-847><span class=linenos data-linenos=" 847 "></span></a>        <span class=p>)</span>
</span><span id=__span-0-848><a id=__codelineno-0-848 name=__codelineno-0-848></a><a href=#__codelineno-0-848><span class=linenos data-linenos=" 848 "></span></a>    <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
</span><span id=__span-0-849><a id=__codelineno-0-849 name=__codelineno-0-849></a><a href=#__codelineno-0-849><span class=linenos data-linenos=" 849 "></span></a>        <span class=c1># Fallback lightweight heuristic</span>
</span><span id=__span-0-850><a id=__codelineno-0-850 name=__codelineno-0-850></a><a href=#__codelineno-0-850><span class=linenos data-linenos=" 850 "></span></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-851><a id=__codelineno-0-851 name=__codelineno-0-851></a><a href=#__codelineno-0-851><span class=linenos data-linenos=" 851 "></span></a>            <span class=n>text_len</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>text</span><span class=p>)</span>
</span><span id=__span-0-852><a id=__codelineno-0-852 name=__codelineno-0-852></a><a href=#__codelineno-0-852><span class=linenos data-linenos=" 852 "></span></a>        <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
</span><span id=__span-0-853><a id=__codelineno-0-853 name=__codelineno-0-853></a><a href=#__codelineno-0-853><span class=linenos data-linenos=" 853 "></span></a>            <span class=n>text_len</span> <span class=o>=</span> <span class=mi>0</span>
</span><span id=__span-0-854><a id=__codelineno-0-854 name=__codelineno-0-854></a><a href=#__codelineno-0-854><span class=linenos data-linenos=" 854 "></span></a>        <span class=n>complexity</span> <span class=o>=</span> <span class=nb>min</span><span class=p>(</span><span class=mf>1.0</span><span class=p>,</span> <span class=nb>max</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=n>text_len</span> <span class=o>/</span> <span class=mf>20000.0</span><span class=p>))</span>
</span><span id=__span-0-855><a id=__codelineno-0-855 name=__codelineno-0-855></a><a href=#__codelineno-0-855><span class=linenos data-linenos=" 855 "></span></a>    <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-856><a id=__codelineno-0-856 name=__codelineno-0-856></a><a href=#__codelineno-0-856><span class=linenos data-linenos=" 856 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Context complexity: </span><span class=si>{</span><span class=n>complexity</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-857><a id=__codelineno-0-857 name=__codelineno-0-857></a><a href=#__codelineno-0-857><span class=linenos data-linenos=" 857 "></span></a>    <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
</span><span id=__span-0-858><a id=__codelineno-0-858 name=__codelineno-0-858></a><a href=#__codelineno-0-858><span class=linenos data-linenos=" 858 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;Context complexity computed&quot;</span><span class=p>)</span>
</span><span id=__span-0-859><a id=__codelineno-0-859 name=__codelineno-0-859></a><a href=#__codelineno-0-859><span class=linenos data-linenos=" 859 "></span></a>
</span><span id=__span-0-860><a id=__codelineno-0-860 name=__codelineno-0-860></a><a href=#__codelineno-0-860><span class=linenos data-linenos=" 860 "></span></a>    <span class=c1># Optionally inject system instruction before tenets (when enabled)</span>
</span><span id=__span-0-861><a id=__codelineno-0-861 name=__codelineno-0-861></a><a href=#__codelineno-0-861><span class=linenos data-linenos=" 861 "></span></a>    <span class=n>sys_meta</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-0-862><a id=__codelineno-0-862 name=__codelineno-0-862></a><a href=#__codelineno-0-862><span class=linenos data-linenos=" 862 "></span></a>    <span class=n>sys_injected_text</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-0-863><a id=__codelineno-0-863 name=__codelineno-0-863></a><a href=#__codelineno-0-863><span class=linenos data-linenos=" 863 "></span></a>    <span class=c1># Determine whether to inject system instruction based on flag and config</span>
</span><span id=__span-0-864><a id=__codelineno-0-864 name=__codelineno-0-864></a><a href=#__codelineno-0-864><span class=linenos data-linenos=" 864 "></span></a>    <span class=n>sys_should</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-0-865><a id=__codelineno-0-865 name=__codelineno-0-865></a><a href=#__codelineno-0-865><span class=linenos data-linenos=" 865 "></span></a>    <span class=k>if</span> <span class=n>inject_system_instruction</span> <span class=ow>is</span> <span class=kc>True</span><span class=p>:</span>
</span><span id=__span-0-866><a id=__codelineno-0-866 name=__codelineno-0-866></a><a href=#__codelineno-0-866><span class=linenos data-linenos=" 866 "></span></a>        <span class=n>sys_should</span> <span class=o>=</span> <span class=kc>True</span>
</span><span id=__span-0-867><a id=__codelineno-0-867 name=__codelineno-0-867></a><a href=#__codelineno-0-867><span class=linenos data-linenos=" 867 "></span></a>    <span class=k>elif</span> <span class=n>inject_system_instruction</span> <span class=ow>is</span> <span class=kc>False</span><span class=p>:</span>
</span><span id=__span-0-868><a id=__codelineno-0-868 name=__codelineno-0-868></a><a href=#__codelineno-0-868><span class=linenos data-linenos=" 868 "></span></a>        <span class=n>sys_should</span> <span class=o>=</span> <span class=kc>False</span>
</span><span id=__span-0-869><a id=__codelineno-0-869 name=__codelineno-0-869></a><a href=#__codelineno-0-869><span class=linenos data-linenos=" 869 "></span></a>    <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-870><a id=__codelineno-0-870 name=__codelineno-0-870></a><a href=#__codelineno-0-870><span class=linenos data-linenos=" 870 "></span></a>        <span class=n>sys_should</span> <span class=o>=</span> <span class=nb>bool</span><span class=p>(</span>
</span><span id=__span-0-871><a id=__codelineno-0-871 name=__codelineno-0-871></a><a href=#__codelineno-0-871><span class=linenos data-linenos=" 871 "></span></a>            <span class=bp>self</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>tenet</span><span class=o>.</span><span class=n>system_instruction_enabled</span>
</span><span id=__span-0-872><a id=__codelineno-0-872 name=__codelineno-0-872></a><a href=#__codelineno-0-872><span class=linenos data-linenos=" 872 "></span></a>            <span class=ow>and</span> <span class=bp>self</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>tenet</span><span class=o>.</span><span class=n>system_instruction</span>
</span><span id=__span-0-873><a id=__codelineno-0-873 name=__codelineno-0-873></a><a href=#__codelineno-0-873><span class=linenos data-linenos=" 873 "></span></a>        <span class=p>)</span>
</span><span id=__span-0-874><a id=__codelineno-0-874 name=__codelineno-0-874></a><a href=#__codelineno-0-874><span class=linenos data-linenos=" 874 "></span></a>
</span><span id=__span-0-875><a id=__codelineno-0-875 name=__codelineno-0-875></a><a href=#__codelineno-0-875><span class=linenos data-linenos=" 875 "></span></a>    <span class=k>if</span> <span class=n>sys_should</span><span class=p>:</span>
</span><span id=__span-0-876><a id=__codelineno-0-876 name=__codelineno-0-876></a><a href=#__codelineno-0-876><span class=linenos data-linenos=" 876 "></span></a>        <span class=n>modified_text</span><span class=p>,</span> <span class=n>meta</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>inject_system_instruction</span><span class=p>(</span>
</span><span id=__span-0-877><a id=__codelineno-0-877 name=__codelineno-0-877></a><a href=#__codelineno-0-877><span class=linenos data-linenos=" 877 "></span></a>            <span class=n>text</span><span class=p>,</span> <span class=nb>format</span><span class=o>=</span><span class=n>format_type</span><span class=p>,</span> <span class=n>session</span><span class=o>=</span><span class=n>session</span>
</span><span id=__span-0-878><a id=__codelineno-0-878 name=__codelineno-0-878></a><a href=#__codelineno-0-878><span class=linenos data-linenos=" 878 "></span></a>        <span class=p>)</span>
</span><span id=__span-0-879><a id=__codelineno-0-879 name=__codelineno-0-879></a><a href=#__codelineno-0-879><span class=linenos data-linenos=" 879 "></span></a>        <span class=c1># If actually injected, update text and tracking map</span>
</span><span id=__span-0-880><a id=__codelineno-0-880 name=__codelineno-0-880></a><a href=#__codelineno-0-880><span class=linenos data-linenos=" 880 "></span></a>        <span class=k>if</span> <span class=n>meta</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;system_instruction_injected&quot;</span><span class=p>):</span>
</span><span id=__span-0-881><a id=__codelineno-0-881 name=__codelineno-0-881></a><a href=#__codelineno-0-881><span class=linenos data-linenos=" 881 "></span></a>            <span class=n>text</span> <span class=o>=</span> <span class=n>modified_text</span>
</span><span id=__span-0-882><a id=__codelineno-0-882 name=__codelineno-0-882></a><a href=#__codelineno-0-882><span class=linenos data-linenos=" 882 "></span></a>            <span class=n>sys_injected_text</span> <span class=o>=</span> <span class=n>modified_text</span>
</span><span id=__span-0-883><a id=__codelineno-0-883 name=__codelineno-0-883></a><a href=#__codelineno-0-883><span class=linenos data-linenos=" 883 "></span></a>            <span class=n>sys_meta</span> <span class=o>=</span> <span class=n>meta</span>
</span><span id=__span-0-884><a id=__codelineno-0-884 name=__codelineno-0-884></a><a href=#__codelineno-0-884><span class=linenos data-linenos=" 884 "></span></a>            <span class=k>if</span> <span class=n>session</span><span class=p>:</span>
</span><span id=__span-0-885><a id=__codelineno-0-885 name=__codelineno-0-885></a><a href=#__codelineno-0-885><span class=linenos data-linenos=" 885 "></span></a>                <span class=bp>self</span><span class=o>.</span><span class=n>system_instruction_injected</span><span class=p>[</span><span class=n>session</span><span class=p>]</span> <span class=o>=</span> <span class=kc>True</span>
</span><span id=__span-0-886><a id=__codelineno-0-886 name=__codelineno-0-886></a><a href=#__codelineno-0-886><span class=linenos data-linenos=" 886 "></span></a>    <span class=c1># Analyze complexity</span>
</span><span id=__span-0-887><a id=__codelineno-0-887 name=__codelineno-0-887></a><a href=#__codelineno-0-887><span class=linenos data-linenos=" 887 "></span></a>    <span class=n>complexity</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>complexity_analyzer</span><span class=o>.</span><span class=n>analyze</span><span class=p>(</span><span class=n>context</span><span class=p>)</span>
</span><span id=__span-0-888><a id=__codelineno-0-888 name=__codelineno-0-888></a><a href=#__codelineno-0-888><span class=linenos data-linenos=" 888 "></span></a>    <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Context complexity: </span><span class=si>{</span><span class=n>complexity</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-889><a id=__codelineno-0-889 name=__codelineno-0-889></a><a href=#__codelineno-0-889><span class=linenos data-linenos=" 889 "></span></a>
</span><span id=__span-0-890><a id=__codelineno-0-890 name=__codelineno-0-890></a><a href=#__codelineno-0-890><span class=linenos data-linenos=" 890 "></span></a>    <span class=c1># Check if we should inject</span>
</span><span id=__span-0-891><a id=__codelineno-0-891 name=__codelineno-0-891></a><a href=#__codelineno-0-891><span class=linenos data-linenos=" 891 "></span></a>    <span class=n>should_inject</span> <span class=o>=</span> <span class=n>force</span>
</span><span id=__span-0-892><a id=__codelineno-0-892 name=__codelineno-0-892></a><a href=#__codelineno-0-892><span class=linenos data-linenos=" 892 "></span></a>    <span class=n>skip_reason</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-0-893><a id=__codelineno-0-893 name=__codelineno-0-893></a><a href=#__codelineno-0-893><span class=linenos data-linenos=" 893 "></span></a>
</span><span id=__span-0-894><a id=__codelineno-0-894 name=__codelineno-0-894></a><a href=#__codelineno-0-894><span class=linenos data-linenos=" 894 "></span></a>    <span class=k>if</span> <span class=ow>not</span> <span class=n>force</span> <span class=ow>and</span> <span class=n>check_frequency</span><span class=p>:</span>
</span><span id=__span-0-895><a id=__codelineno-0-895 name=__codelineno-0-895></a><a href=#__codelineno-0-895><span class=linenos data-linenos=" 895 "></span></a>        <span class=k>if</span> <span class=n>history</span><span class=p>:</span>
</span><span id=__span-0-896><a id=__codelineno-0-896 name=__codelineno-0-896></a><a href=#__codelineno-0-896><span class=linenos data-linenos=" 896 "></span></a>            <span class=n>should_inject</span><span class=p>,</span> <span class=n>reason</span> <span class=o>=</span> <span class=n>history</span><span class=o>.</span><span class=n>should_inject</span><span class=p>(</span>
</span><span id=__span-0-897><a id=__codelineno-0-897 name=__codelineno-0-897></a><a href=#__codelineno-0-897><span class=linenos data-linenos=" 897 "></span></a>                <span class=n>frequency</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>tenet</span><span class=o>.</span><span class=n>injection_frequency</span><span class=p>,</span>
</span><span id=__span-0-898><a id=__codelineno-0-898 name=__codelineno-0-898></a><a href=#__codelineno-0-898><span class=linenos data-linenos=" 898 "></span></a>                <span class=n>interval</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>tenet</span><span class=o>.</span><span class=n>injection_interval</span><span class=p>,</span>
</span><span id=__span-0-899><a id=__codelineno-0-899 name=__codelineno-0-899></a><a href=#__codelineno-0-899><span class=linenos data-linenos=" 899 "></span></a>                <span class=n>complexity</span><span class=o>=</span><span class=n>complexity</span><span class=p>,</span>
</span><span id=__span-0-900><a id=__codelineno-0-900 name=__codelineno-0-900></a><a href=#__codelineno-0-900><span class=linenos data-linenos=" 900 "></span></a>                <span class=n>complexity_threshold</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>tenet</span><span class=o>.</span><span class=n>session_complexity_threshold</span><span class=p>,</span>
</span><span id=__span-0-901><a id=__codelineno-0-901 name=__codelineno-0-901></a><a href=#__codelineno-0-901><span class=linenos data-linenos=" 901 "></span></a>                <span class=n>min_session_length</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>tenet</span><span class=o>.</span><span class=n>min_session_length</span><span class=p>,</span>
</span><span id=__span-0-902><a id=__codelineno-0-902 name=__codelineno-0-902></a><a href=#__codelineno-0-902><span class=linenos data-linenos=" 902 "></span></a>            <span class=p>)</span>
</span><span id=__span-0-903><a id=__codelineno-0-903 name=__codelineno-0-903></a><a href=#__codelineno-0-903><span class=linenos data-linenos=" 903 "></span></a>        <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-904><a id=__codelineno-0-904 name=__codelineno-0-904></a><a href=#__codelineno-0-904><span class=linenos data-linenos=" 904 "></span></a>            <span class=c1># No session history – treat as new/unnamed session that needs tenets</span>
</span><span id=__span-0-905><a id=__codelineno-0-905 name=__codelineno-0-905></a><a href=#__codelineno-0-905><span class=linenos data-linenos=" 905 "></span></a>            <span class=n>freq</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>tenet</span><span class=o>.</span><span class=n>injection_frequency</span>
</span><span id=__span-0-906><a id=__codelineno-0-906 name=__codelineno-0-906></a><a href=#__codelineno-0-906><span class=linenos data-linenos=" 906 "></span></a>            <span class=k>if</span> <span class=n>freq</span> <span class=o>==</span> <span class=s2>&quot;always&quot;</span><span class=p>:</span>
</span><span id=__span-0-907><a id=__codelineno-0-907 name=__codelineno-0-907></a><a href=#__codelineno-0-907><span class=linenos data-linenos=" 907 "></span></a>                <span class=n>should_inject</span><span class=p>,</span> <span class=n>reason</span> <span class=o>=</span> <span class=kc>True</span><span class=p>,</span> <span class=s2>&quot;always_mode_no_session&quot;</span>
</span><span id=__span-0-908><a id=__codelineno-0-908 name=__codelineno-0-908></a><a href=#__codelineno-0-908><span class=linenos data-linenos=" 908 "></span></a>            <span class=k>elif</span> <span class=n>freq</span> <span class=o>==</span> <span class=s2>&quot;manual&quot;</span><span class=p>:</span>
</span><span id=__span-0-909><a id=__codelineno-0-909 name=__codelineno-0-909></a><a href=#__codelineno-0-909><span class=linenos data-linenos=" 909 "></span></a>                <span class=n>should_inject</span><span class=p>,</span> <span class=n>reason</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span> <span class=s2>&quot;manual_mode_no_session&quot;</span>
</span><span id=__span-0-910><a id=__codelineno-0-910 name=__codelineno-0-910></a><a href=#__codelineno-0-910><span class=linenos data-linenos=" 910 "></span></a>            <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-911><a id=__codelineno-0-911 name=__codelineno-0-911></a><a href=#__codelineno-0-911><span class=linenos data-linenos=" 911 "></span></a>                <span class=c1># For periodic/adaptive without a session, INJECT to establish context</span>
</span><span id=__span-0-912><a id=__codelineno-0-912 name=__codelineno-0-912></a><a href=#__codelineno-0-912><span class=linenos data-linenos=" 912 "></span></a>                <span class=c1># Unnamed sessions are important - they need guiding principles</span>
</span><span id=__span-0-913><a id=__codelineno-0-913 name=__codelineno-0-913></a><a href=#__codelineno-0-913><span class=linenos data-linenos=" 913 "></span></a>                <span class=n>should_inject</span><span class=p>,</span> <span class=n>reason</span> <span class=o>=</span> <span class=kc>True</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&quot;unnamed_session_needs_tenets&quot;</span>
</span><span id=__span-0-914><a id=__codelineno-0-914 name=__codelineno-0-914></a><a href=#__codelineno-0-914><span class=linenos data-linenos=" 914 "></span></a>
</span><span id=__span-0-915><a id=__codelineno-0-915 name=__codelineno-0-915></a><a href=#__codelineno-0-915><span class=linenos data-linenos=" 915 "></span></a>    <span class=k>if</span> <span class=ow>not</span> <span class=n>force</span> <span class=ow>and</span> <span class=n>check_frequency</span> <span class=ow>and</span> <span class=n>history</span><span class=p>:</span>
</span><span id=__span-0-916><a id=__codelineno-0-916 name=__codelineno-0-916></a><a href=#__codelineno-0-916><span class=linenos data-linenos=" 916 "></span></a>        <span class=n>should_inject</span><span class=p>,</span> <span class=n>reason</span> <span class=o>=</span> <span class=n>history</span><span class=o>.</span><span class=n>should_inject</span><span class=p>(</span>
</span><span id=__span-0-917><a id=__codelineno-0-917 name=__codelineno-0-917></a><a href=#__codelineno-0-917><span class=linenos data-linenos=" 917 "></span></a>            <span class=n>frequency</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>tenet</span><span class=o>.</span><span class=n>injection_frequency</span><span class=p>,</span>
</span><span id=__span-0-918><a id=__codelineno-0-918 name=__codelineno-0-918></a><a href=#__codelineno-0-918><span class=linenos data-linenos=" 918 "></span></a>            <span class=n>interval</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>tenet</span><span class=o>.</span><span class=n>injection_interval</span><span class=p>,</span>
</span><span id=__span-0-919><a id=__codelineno-0-919 name=__codelineno-0-919></a><a href=#__codelineno-0-919><span class=linenos data-linenos=" 919 "></span></a>            <span class=n>complexity</span><span class=o>=</span><span class=n>complexity</span><span class=p>,</span>
</span><span id=__span-0-920><a id=__codelineno-0-920 name=__codelineno-0-920></a><a href=#__codelineno-0-920><span class=linenos data-linenos=" 920 "></span></a>            <span class=n>complexity_threshold</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>tenet</span><span class=o>.</span><span class=n>session_complexity_threshold</span><span class=p>,</span>
</span><span id=__span-0-921><a id=__codelineno-0-921 name=__codelineno-0-921></a><a href=#__codelineno-0-921><span class=linenos data-linenos=" 921 "></span></a>            <span class=n>min_session_length</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>tenet</span><span class=o>.</span><span class=n>min_session_length</span><span class=p>,</span>
</span><span id=__span-0-922><a id=__codelineno-0-922 name=__codelineno-0-922></a><a href=#__codelineno-0-922><span class=linenos data-linenos=" 922 "></span></a>        <span class=p>)</span>
</span><span id=__span-0-923><a id=__codelineno-0-923 name=__codelineno-0-923></a><a href=#__codelineno-0-923><span class=linenos data-linenos=" 923 "></span></a>
</span><span id=__span-0-924><a id=__codelineno-0-924 name=__codelineno-0-924></a><a href=#__codelineno-0-924><span class=linenos data-linenos=" 924 "></span></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>should_inject</span><span class=p>:</span>
</span><span id=__span-0-925><a id=__codelineno-0-925 name=__codelineno-0-925></a><a href=#__codelineno-0-925><span class=linenos data-linenos=" 925 "></span></a>            <span class=n>skip_reason</span> <span class=o>=</span> <span class=n>reason</span>
</span><span id=__span-0-926><a id=__codelineno-0-926 name=__codelineno-0-926></a><a href=#__codelineno-0-926><span class=linenos data-linenos=" 926 "></span></a>            <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Skipping injection: </span><span class=si>{</span><span class=n>reason</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-927><a id=__codelineno-0-927 name=__codelineno-0-927></a><a href=#__codelineno-0-927><span class=linenos data-linenos=" 927 "></span></a>
</span><span id=__span-0-928><a id=__codelineno-0-928 name=__codelineno-0-928></a><a href=#__codelineno-0-928><span class=linenos data-linenos=" 928 "></span></a>    <span class=c1># Record metrics even if skipping</span>
</span><span id=__span-0-929><a id=__codelineno-0-929 name=__codelineno-0-929></a><a href=#__codelineno-0-929><span class=linenos data-linenos=" 929 "></span></a>    <span class=k>if</span> <span class=ow>not</span> <span class=n>should_inject</span><span class=p>:</span>
</span><span id=__span-0-930><a id=__codelineno-0-930 name=__codelineno-0-930></a><a href=#__codelineno-0-930><span class=linenos data-linenos=" 930 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>metrics_tracker</span><span class=o>.</span><span class=n>record_instillation</span><span class=p>(</span>
</span><span id=__span-0-931><a id=__codelineno-0-931 name=__codelineno-0-931></a><a href=#__codelineno-0-931><span class=linenos data-linenos=" 931 "></span></a>            <span class=n>tenet_count</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span>
</span><span id=__span-0-932><a id=__codelineno-0-932 name=__codelineno-0-932></a><a href=#__codelineno-0-932><span class=linenos data-linenos=" 932 "></span></a>            <span class=n>token_increase</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span>
</span><span id=__span-0-933><a id=__codelineno-0-933 name=__codelineno-0-933></a><a href=#__codelineno-0-933><span class=linenos data-linenos=" 933 "></span></a>            <span class=n>strategy</span><span class=o>=</span><span class=s2>&quot;skipped&quot;</span><span class=p>,</span>
</span><span id=__span-0-934><a id=__codelineno-0-934 name=__codelineno-0-934></a><a href=#__codelineno-0-934><span class=linenos data-linenos=" 934 "></span></a>            <span class=n>session</span><span class=o>=</span><span class=n>session</span><span class=p>,</span>
</span><span id=__span-0-935><a id=__codelineno-0-935 name=__codelineno-0-935></a><a href=#__codelineno-0-935><span class=linenos data-linenos=" 935 "></span></a>            <span class=n>complexity</span><span class=o>=</span><span class=n>complexity</span><span class=p>,</span>
</span><span id=__span-0-936><a id=__codelineno-0-936 name=__codelineno-0-936></a><a href=#__codelineno-0-936><span class=linenos data-linenos=" 936 "></span></a>            <span class=n>skip_reason</span><span class=o>=</span><span class=n>skip_reason</span><span class=p>,</span>
</span><span id=__span-0-937><a id=__codelineno-0-937 name=__codelineno-0-937></a><a href=#__codelineno-0-937><span class=linenos data-linenos=" 937 "></span></a>        <span class=p>)</span>
</span><span id=__span-0-938><a id=__codelineno-0-938 name=__codelineno-0-938></a><a href=#__codelineno-0-938><span class=linenos data-linenos=" 938 "></span></a>
</span><span id=__span-0-939><a id=__codelineno-0-939 name=__codelineno-0-939></a><a href=#__codelineno-0-939><span class=linenos data-linenos=" 939 "></span></a>        <span class=c1># Save histories</span>
</span><span id=__span-0-940><a id=__codelineno-0-940 name=__codelineno-0-940></a><a href=#__codelineno-0-940><span class=linenos data-linenos=" 940 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_save_session_histories</span><span class=p>()</span>
</span><span id=__span-0-941><a id=__codelineno-0-941 name=__codelineno-0-941></a><a href=#__codelineno-0-941><span class=linenos data-linenos=" 941 "></span></a>
</span><span id=__span-0-942><a id=__codelineno-0-942 name=__codelineno-0-942></a><a href=#__codelineno-0-942><span class=linenos data-linenos=" 942 "></span></a>        <span class=c1># If we injected a system instruction earlier, return the modified</span>
</span><span id=__span-0-943><a id=__codelineno-0-943 name=__codelineno-0-943></a><a href=#__codelineno-0-943><span class=linenos data-linenos=" 943 "></span></a>        <span class=c1># content and include system_instruction metadata as tests expect.</span>
</span><span id=__span-0-944><a id=__codelineno-0-944 name=__codelineno-0-944></a><a href=#__codelineno-0-944><span class=linenos data-linenos=" 944 "></span></a>        <span class=k>if</span> <span class=n>sys_meta</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;system_instruction_injected&quot;</span><span class=p>)</span> <span class=ow>and</span> <span class=n>sys_injected_text</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-945><a id=__codelineno-0-945 name=__codelineno-0-945></a><a href=#__codelineno-0-945><span class=linenos data-linenos=" 945 "></span></a>            <span class=k>if</span> <span class=n>is_context_result</span><span class=p>:</span>
</span><span id=__span-0-946><a id=__codelineno-0-946 name=__codelineno-0-946></a><a href=#__codelineno-0-946><span class=linenos data-linenos=" 946 "></span></a>                <span class=n>extra_meta</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-0-947><a id=__codelineno-0-947 name=__codelineno-0-947></a><a href=#__codelineno-0-947><span class=linenos data-linenos=" 947 "></span></a>                    <span class=s2>&quot;system_instruction&quot;</span><span class=p>:</span> <span class=n>sys_meta</span><span class=p>,</span>
</span><span id=__span-0-948><a id=__codelineno-0-948 name=__codelineno-0-948></a><a href=#__codelineno-0-948><span class=linenos data-linenos=" 948 "></span></a>                    <span class=s2>&quot;injection_complexity&quot;</span><span class=p>:</span> <span class=n>complexity</span><span class=p>,</span>
</span><span id=__span-0-949><a id=__codelineno-0-949 name=__codelineno-0-949></a><a href=#__codelineno-0-949><span class=linenos data-linenos=" 949 "></span></a>                <span class=p>}</span>
</span><span id=__span-0-950><a id=__codelineno-0-950 name=__codelineno-0-950></a><a href=#__codelineno-0-950><span class=linenos data-linenos=" 950 "></span></a>                <span class=n>modified_context</span> <span class=o>=</span> <span class=n>ContextResult</span><span class=p>(</span>
</span><span id=__span-0-951><a id=__codelineno-0-951 name=__codelineno-0-951></a><a href=#__codelineno-0-951><span class=linenos data-linenos=" 951 "></span></a>                    <span class=n>files</span><span class=o>=</span><span class=n>context</span><span class=o>.</span><span class=n>files</span><span class=p>,</span>  <span class=c1># type: ignore[attr-defined]</span>
</span><span id=__span-0-952><a id=__codelineno-0-952 name=__codelineno-0-952></a><a href=#__codelineno-0-952><span class=linenos data-linenos=" 952 "></span></a>                    <span class=n>context</span><span class=o>=</span><span class=n>sys_injected_text</span><span class=p>,</span>
</span><span id=__span-0-953><a id=__codelineno-0-953 name=__codelineno-0-953></a><a href=#__codelineno-0-953><span class=linenos data-linenos=" 953 "></span></a>                    <span class=nb>format</span><span class=o>=</span><span class=n>context</span><span class=o>.</span><span class=n>format</span><span class=p>,</span>  <span class=c1># type: ignore[attr-defined]</span>
</span><span id=__span-0-954><a id=__codelineno-0-954 name=__codelineno-0-954></a><a href=#__codelineno-0-954><span class=linenos data-linenos=" 954 "></span></a>                    <span class=n>metadata</span><span class=o>=</span><span class=p>{</span><span class=o>**</span><span class=n>context</span><span class=o>.</span><span class=n>metadata</span><span class=p>,</span> <span class=o>**</span><span class=n>extra_meta</span><span class=p>},</span>  <span class=c1># type: ignore[attr-defined]</span>
</span><span id=__span-0-955><a id=__codelineno-0-955 name=__codelineno-0-955></a><a href=#__codelineno-0-955><span class=linenos data-linenos=" 955 "></span></a>                <span class=p>)</span>
</span><span id=__span-0-956><a id=__codelineno-0-956 name=__codelineno-0-956></a><a href=#__codelineno-0-956><span class=linenos data-linenos=" 956 "></span></a>                <span class=k>return</span> <span class=n>modified_context</span>
</span><span id=__span-0-957><a id=__codelineno-0-957 name=__codelineno-0-957></a><a href=#__codelineno-0-957><span class=linenos data-linenos=" 957 "></span></a>            <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-958><a id=__codelineno-0-958 name=__codelineno-0-958></a><a href=#__codelineno-0-958><span class=linenos data-linenos=" 958 "></span></a>                <span class=k>return</span> <span class=n>sys_injected_text</span>
</span><span id=__span-0-959><a id=__codelineno-0-959 name=__codelineno-0-959></a><a href=#__codelineno-0-959><span class=linenos data-linenos=" 959 "></span></a>
</span><span id=__span-0-960><a id=__codelineno-0-960 name=__codelineno-0-960></a><a href=#__codelineno-0-960><span class=linenos data-linenos=" 960 "></span></a>        <span class=k>return</span> <span class=n>context</span>  <span class=c1># Return unchanged when nothing was injected</span>
</span><span id=__span-0-961><a id=__codelineno-0-961 name=__codelineno-0-961></a><a href=#__codelineno-0-961><span class=linenos data-linenos=" 961 "></span></a>
</span><span id=__span-0-962><a id=__codelineno-0-962 name=__codelineno-0-962></a><a href=#__codelineno-0-962><span class=linenos data-linenos=" 962 "></span></a>    <span class=c1># Get tenets for injection</span>
</span><span id=__span-0-963><a id=__codelineno-0-963 name=__codelineno-0-963></a><a href=#__codelineno-0-963><span class=linenos data-linenos=" 963 "></span></a>    <span class=n>tenets</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_tenets_for_instillation</span><span class=p>(</span>
</span><span id=__span-0-964><a id=__codelineno-0-964 name=__codelineno-0-964></a><a href=#__codelineno-0-964><span class=linenos data-linenos=" 964 "></span></a>        <span class=n>session</span><span class=o>=</span><span class=n>session</span><span class=p>,</span>
</span><span id=__span-0-965><a id=__codelineno-0-965 name=__codelineno-0-965></a><a href=#__codelineno-0-965><span class=linenos data-linenos=" 965 "></span></a>        <span class=n>force</span><span class=o>=</span><span class=n>force</span><span class=p>,</span>
</span><span id=__span-0-966><a id=__codelineno-0-966 name=__codelineno-0-966></a><a href=#__codelineno-0-966><span class=linenos data-linenos=" 966 "></span></a>        <span class=n>content_length</span><span class=o>=</span><span class=nb>len</span><span class=p>(</span><span class=n>text</span><span class=p>),</span>
</span><span id=__span-0-967><a id=__codelineno-0-967 name=__codelineno-0-967></a><a href=#__codelineno-0-967><span class=linenos data-linenos=" 967 "></span></a>        <span class=n>max_tenets</span><span class=o>=</span><span class=n>max_tenets</span> <span class=ow>or</span> <span class=bp>self</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>tenet</span><span class=o>.</span><span class=n>max_per_context</span><span class=p>,</span>
</span><span id=__span-0-968><a id=__codelineno-0-968 name=__codelineno-0-968></a><a href=#__codelineno-0-968><span class=linenos data-linenos=" 968 "></span></a>        <span class=n>history</span><span class=o>=</span><span class=n>history</span><span class=p>,</span>
</span><span id=__span-0-969><a id=__codelineno-0-969 name=__codelineno-0-969></a><a href=#__codelineno-0-969><span class=linenos data-linenos=" 969 "></span></a>        <span class=n>complexity</span><span class=o>=</span><span class=n>complexity</span><span class=p>,</span>
</span><span id=__span-0-970><a id=__codelineno-0-970 name=__codelineno-0-970></a><a href=#__codelineno-0-970><span class=linenos data-linenos=" 970 "></span></a>    <span class=p>)</span>
</span><span id=__span-0-971><a id=__codelineno-0-971 name=__codelineno-0-971></a><a href=#__codelineno-0-971><span class=linenos data-linenos=" 971 "></span></a>
</span><span id=__span-0-972><a id=__codelineno-0-972 name=__codelineno-0-972></a><a href=#__codelineno-0-972><span class=linenos data-linenos=" 972 "></span></a>    <span class=k>if</span> <span class=ow>not</span> <span class=n>tenets</span><span class=p>:</span>
</span><span id=__span-0-973><a id=__codelineno-0-973 name=__codelineno-0-973></a><a href=#__codelineno-0-973><span class=linenos data-linenos=" 973 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;No tenets available for instillation&quot;</span><span class=p>)</span>
</span><span id=__span-0-974><a id=__codelineno-0-974 name=__codelineno-0-974></a><a href=#__codelineno-0-974><span class=linenos data-linenos=" 974 "></span></a>        <span class=k>return</span> <span class=n>context</span>
</span><span id=__span-0-975><a id=__codelineno-0-975 name=__codelineno-0-975></a><a href=#__codelineno-0-975><span class=linenos data-linenos=" 975 "></span></a>
</span><span id=__span-0-976><a id=__codelineno-0-976 name=__codelineno-0-976></a><a href=#__codelineno-0-976><span class=linenos data-linenos=" 976 "></span></a>    <span class=c1># Determine injection strategy</span>
</span><span id=__span-0-977><a id=__codelineno-0-977 name=__codelineno-0-977></a><a href=#__codelineno-0-977><span class=linenos data-linenos=" 977 "></span></a>    <span class=k>if</span> <span class=ow>not</span> <span class=n>strategy</span><span class=p>:</span>
</span><span id=__span-0-978><a id=__codelineno-0-978 name=__codelineno-0-978></a><a href=#__codelineno-0-978><span class=linenos data-linenos=" 978 "></span></a>        <span class=n>strategy</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_determine_injection_strategy</span><span class=p>(</span>
</span><span id=__span-0-979><a id=__codelineno-0-979 name=__codelineno-0-979></a><a href=#__codelineno-0-979><span class=linenos data-linenos=" 979 "></span></a>            <span class=n>content_length</span><span class=o>=</span><span class=nb>len</span><span class=p>(</span><span class=n>text</span><span class=p>),</span>
</span><span id=__span-0-980><a id=__codelineno-0-980 name=__codelineno-0-980></a><a href=#__codelineno-0-980><span class=linenos data-linenos=" 980 "></span></a>            <span class=n>tenet_count</span><span class=o>=</span><span class=nb>len</span><span class=p>(</span><span class=n>tenets</span><span class=p>),</span>
</span><span id=__span-0-981><a id=__codelineno-0-981 name=__codelineno-0-981></a><a href=#__codelineno-0-981><span class=linenos data-linenos=" 981 "></span></a>            <span class=n>format_type</span><span class=o>=</span><span class=n>format_type</span><span class=p>,</span>
</span><span id=__span-0-982><a id=__codelineno-0-982 name=__codelineno-0-982></a><a href=#__codelineno-0-982><span class=linenos data-linenos=" 982 "></span></a>            <span class=n>complexity</span><span class=o>=</span><span class=n>complexity</span><span class=p>,</span>
</span><span id=__span-0-983><a id=__codelineno-0-983 name=__codelineno-0-983></a><a href=#__codelineno-0-983><span class=linenos data-linenos=" 983 "></span></a>        <span class=p>)</span>
</span><span id=__span-0-984><a id=__codelineno-0-984 name=__codelineno-0-984></a><a href=#__codelineno-0-984><span class=linenos data-linenos=" 984 "></span></a>
</span><span id=__span-0-985><a id=__codelineno-0-985 name=__codelineno-0-985></a><a href=#__codelineno-0-985><span class=linenos data-linenos=" 985 "></span></a>    <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span>
</span><span id=__span-0-986><a id=__codelineno-0-986 name=__codelineno-0-986></a><a href=#__codelineno-0-986><span class=linenos data-linenos=" 986 "></span></a>        <span class=sa>f</span><span class=s2>&quot;Instilling </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>tenets</span><span class=p>)</span><span class=si>}</span><span class=s2> tenets using </span><span class=si>{</span><span class=n>strategy</span><span class=si>}</span><span class=s2> strategy&quot;</span>
</span><span id=__span-0-987><a id=__codelineno-0-987 name=__codelineno-0-987></a><a href=#__codelineno-0-987><span class=linenos data-linenos=" 987 "></span></a>        <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=sa>f</span><span class=s1>&#39; for session </span><span class=si>{</span><span class=n>session</span><span class=si>}</span><span class=s1>&#39;</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=n>session</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-988><a id=__codelineno-0-988 name=__codelineno-0-988></a><a href=#__codelineno-0-988><span class=linenos data-linenos=" 988 "></span></a>    <span class=p>)</span>
</span><span id=__span-0-989><a id=__codelineno-0-989 name=__codelineno-0-989></a><a href=#__codelineno-0-989><span class=linenos data-linenos=" 989 "></span></a>
</span><span id=__span-0-990><a id=__codelineno-0-990 name=__codelineno-0-990></a><a href=#__codelineno-0-990><span class=linenos data-linenos=" 990 "></span></a>    <span class=c1># Inject tenets - TenetInjector doesn&#39;t have a strategy parameter</span>
</span><span id=__span-0-991><a id=__codelineno-0-991 name=__codelineno-0-991></a><a href=#__codelineno-0-991><span class=linenos data-linenos=" 991 "></span></a>    <span class=n>modified_text</span><span class=p>,</span> <span class=n>injection_metadata</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>injector</span><span class=o>.</span><span class=n>inject_tenets</span><span class=p>(</span>
</span><span id=__span-0-992><a id=__codelineno-0-992 name=__codelineno-0-992></a><a href=#__codelineno-0-992><span class=linenos data-linenos=" 992 "></span></a>        <span class=n>content</span><span class=o>=</span><span class=n>text</span><span class=p>,</span> <span class=n>tenets</span><span class=o>=</span><span class=n>tenets</span><span class=p>,</span> <span class=nb>format</span><span class=o>=</span><span class=n>format_type</span><span class=p>,</span> <span class=n>context_metadata</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;strategy&quot;</span><span class=p>:</span> <span class=n>strategy</span><span class=p>}</span>
</span><span id=__span-0-993><a id=__codelineno-0-993 name=__codelineno-0-993></a><a href=#__codelineno-0-993><span class=linenos data-linenos=" 993 "></span></a>    <span class=p>)</span>
</span><span id=__span-0-994><a id=__codelineno-0-994 name=__codelineno-0-994></a><a href=#__codelineno-0-994><span class=linenos data-linenos=" 994 "></span></a>
</span><span id=__span-0-995><a id=__codelineno-0-995 name=__codelineno-0-995></a><a href=#__codelineno-0-995><span class=linenos data-linenos=" 995 "></span></a>    <span class=c1># Update tenet metrics</span>
</span><span id=__span-0-996><a id=__codelineno-0-996 name=__codelineno-0-996></a><a href=#__codelineno-0-996><span class=linenos data-linenos=" 996 "></span></a>    <span class=k>for</span> <span class=n>tenet</span> <span class=ow>in</span> <span class=n>tenets</span><span class=p>:</span>
</span><span id=__span-0-997><a id=__codelineno-0-997 name=__codelineno-0-997></a><a href=#__codelineno-0-997><span class=linenos data-linenos=" 997 "></span></a>        <span class=c1># Update metrics and status on the tenet</span>
</span><span id=__span-0-998><a id=__codelineno-0-998 name=__codelineno-0-998></a><a href=#__codelineno-0-998><span class=linenos data-linenos=" 998 "></span></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-999><a id=__codelineno-0-999 name=__codelineno-0-999></a><a href=#__codelineno-0-999><span class=linenos data-linenos=" 999 "></span></a>            <span class=n>tenet</span><span class=o>.</span><span class=n>metrics</span><span class=o>.</span><span class=n>update_injection</span><span class=p>()</span>
</span><span id=__span-0-1000><a id=__codelineno-0-1000 name=__codelineno-0-1000></a><a href=#__codelineno-0-1000><span class=linenos data-linenos="1000 "></span></a>            <span class=n>tenet</span><span class=o>.</span><span class=n>instill</span><span class=p>()</span>
</span><span id=__span-0-1001><a id=__codelineno-0-1001 name=__codelineno-0-1001></a><a href=#__codelineno-0-1001><span class=linenos data-linenos="1001 "></span></a>        <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
</span><span id=__span-0-1002><a id=__codelineno-0-1002 name=__codelineno-0-1002></a><a href=#__codelineno-0-1002><span class=linenos data-linenos="1002 "></span></a>            <span class=k>pass</span>
</span><span id=__span-0-1003><a id=__codelineno-0-1003 name=__codelineno-0-1003></a><a href=#__codelineno-0-1003><span class=linenos data-linenos="1003 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>manager</span><span class=o>.</span><span class=n>_save_tenet</span><span class=p>(</span><span class=n>tenet</span><span class=p>)</span>
</span><span id=__span-0-1004><a id=__codelineno-0-1004 name=__codelineno-0-1004></a><a href=#__codelineno-0-1004><span class=linenos data-linenos="1004 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>metrics_tracker</span><span class=o>.</span><span class=n>record_tenet_usage</span><span class=p>(</span><span class=n>tenet</span><span class=o>.</span><span class=n>id</span><span class=p>)</span>
</span><span id=__span-0-1005><a id=__codelineno-0-1005 name=__codelineno-0-1005></a><a href=#__codelineno-0-1005><span class=linenos data-linenos="1005 "></span></a>
</span><span id=__span-0-1006><a id=__codelineno-0-1006 name=__codelineno-0-1006></a><a href=#__codelineno-0-1006><span class=linenos data-linenos="1006 "></span></a>    <span class=c1># Record injection in history</span>
</span><span id=__span-0-1007><a id=__codelineno-0-1007 name=__codelineno-0-1007></a><a href=#__codelineno-0-1007><span class=linenos data-linenos="1007 "></span></a>    <span class=k>if</span> <span class=n>history</span><span class=p>:</span>
</span><span id=__span-0-1008><a id=__codelineno-0-1008 name=__codelineno-0-1008></a><a href=#__codelineno-0-1008><span class=linenos data-linenos="1008 "></span></a>        <span class=n>history</span><span class=o>.</span><span class=n>record_injection</span><span class=p>(</span><span class=n>tenets</span><span class=p>,</span> <span class=n>complexity</span><span class=p>)</span>
</span><span id=__span-0-1009><a id=__codelineno-0-1009 name=__codelineno-0-1009></a><a href=#__codelineno-0-1009><span class=linenos data-linenos="1009 "></span></a>
</span><span id=__span-0-1010><a id=__codelineno-0-1010 name=__codelineno-0-1010></a><a href=#__codelineno-0-1010><span class=linenos data-linenos="1010 "></span></a>        <span class=c1># Check for reinforcement</span>
</span><span id=__span-0-1011><a id=__codelineno-0-1011 name=__codelineno-0-1011></a><a href=#__codelineno-0-1011><span class=linenos data-linenos="1011 "></span></a>        <span class=k>if</span> <span class=p>(</span>
</span><span id=__span-0-1012><a id=__codelineno-0-1012 name=__codelineno-0-1012></a><a href=#__codelineno-0-1012><span class=linenos data-linenos="1012 "></span></a>            <span class=bp>self</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>tenet</span><span class=o>.</span><span class=n>reinforcement</span>
</span><span id=__span-0-1013><a id=__codelineno-0-1013 name=__codelineno-0-1013></a><a href=#__codelineno-0-1013><span class=linenos data-linenos="1013 "></span></a>            <span class=ow>and</span> <span class=n>history</span><span class=o>.</span><span class=n>total_injections</span> <span class=o>%</span> <span class=bp>self</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>tenet</span><span class=o>.</span><span class=n>reinforcement_interval</span> <span class=o>==</span> <span class=mi>0</span>
</span><span id=__span-0-1014><a id=__codelineno-0-1014 name=__codelineno-0-1014></a><a href=#__codelineno-0-1014><span class=linenos data-linenos="1014 "></span></a>        <span class=p>):</span>
</span><span id=__span-0-1015><a id=__codelineno-0-1015 name=__codelineno-0-1015></a><a href=#__codelineno-0-1015><span class=linenos data-linenos="1015 "></span></a>            <span class=n>history</span><span class=o>.</span><span class=n>reinforcement_count</span> <span class=o>+=</span> <span class=mi>1</span>
</span><span id=__span-0-1016><a id=__codelineno-0-1016 name=__codelineno-0-1016></a><a href=#__codelineno-0-1016><span class=linenos data-linenos="1016 "></span></a>            <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Reinforcement injection #</span><span class=si>{</span><span class=n>history</span><span class=o>.</span><span class=n>reinforcement_count</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-1017><a id=__codelineno-0-1017 name=__codelineno-0-1017></a><a href=#__codelineno-0-1017><span class=linenos data-linenos="1017 "></span></a>
</span><span id=__span-0-1018><a id=__codelineno-0-1018 name=__codelineno-0-1018></a><a href=#__codelineno-0-1018><span class=linenos data-linenos="1018 "></span></a>    <span class=c1># Create result</span>
</span><span id=__span-0-1019><a id=__codelineno-0-1019 name=__codelineno-0-1019></a><a href=#__codelineno-0-1019><span class=linenos data-linenos="1019 "></span></a>    <span class=n>result</span> <span class=o>=</span> <span class=n>InstillationResult</span><span class=p>(</span>
</span><span id=__span-0-1020><a id=__codelineno-0-1020 name=__codelineno-0-1020></a><a href=#__codelineno-0-1020><span class=linenos data-linenos="1020 "></span></a>        <span class=n>tenets_instilled</span><span class=o>=</span><span class=n>tenets</span><span class=p>,</span>
</span><span id=__span-0-1021><a id=__codelineno-0-1021 name=__codelineno-0-1021></a><a href=#__codelineno-0-1021><span class=linenos data-linenos="1021 "></span></a>        <span class=n>injection_positions</span><span class=o>=</span><span class=n>injection_metadata</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;injections&quot;</span><span class=p>,</span> <span class=p>[]),</span>
</span><span id=__span-0-1022><a id=__codelineno-0-1022 name=__codelineno-0-1022></a><a href=#__codelineno-0-1022><span class=linenos data-linenos="1022 "></span></a>        <span class=n>token_increase</span><span class=o>=</span><span class=n>injection_metadata</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;token_increase&quot;</span><span class=p>,</span> <span class=mi>0</span><span class=p>),</span>
</span><span id=__span-0-1023><a id=__codelineno-0-1023 name=__codelineno-0-1023></a><a href=#__codelineno-0-1023><span class=linenos data-linenos="1023 "></span></a>        <span class=n>strategy_used</span><span class=o>=</span><span class=n>strategy</span><span class=p>,</span>
</span><span id=__span-0-1024><a id=__codelineno-0-1024 name=__codelineno-0-1024></a><a href=#__codelineno-0-1024><span class=linenos data-linenos="1024 "></span></a>        <span class=n>session</span><span class=o>=</span><span class=n>session</span><span class=p>,</span>
</span><span id=__span-0-1025><a id=__codelineno-0-1025 name=__codelineno-0-1025></a><a href=#__codelineno-0-1025><span class=linenos data-linenos="1025 "></span></a>        <span class=n>complexity_score</span><span class=o>=</span><span class=n>complexity</span><span class=p>,</span>
</span><span id=__span-0-1026><a id=__codelineno-0-1026 name=__codelineno-0-1026></a><a href=#__codelineno-0-1026><span class=linenos data-linenos="1026 "></span></a>        <span class=n>metrics</span><span class=o>=</span><span class=p>{</span>
</span><span id=__span-0-1027><a id=__codelineno-0-1027 name=__codelineno-0-1027></a><a href=#__codelineno-0-1027><span class=linenos data-linenos="1027 "></span></a>            <span class=s2>&quot;processing_time&quot;</span><span class=p>:</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>-</span> <span class=n>start_time</span><span class=p>,</span>
</span><span id=__span-0-1028><a id=__codelineno-0-1028 name=__codelineno-0-1028></a><a href=#__codelineno-0-1028><span class=linenos data-linenos="1028 "></span></a>            <span class=s2>&quot;complexity&quot;</span><span class=p>:</span> <span class=n>complexity</span><span class=p>,</span>
</span><span id=__span-0-1029><a id=__codelineno-0-1029 name=__codelineno-0-1029></a><a href=#__codelineno-0-1029><span class=linenos data-linenos="1029 "></span></a>            <span class=s2>&quot;injection_metadata&quot;</span><span class=p>:</span> <span class=n>injection_metadata</span><span class=p>,</span>
</span><span id=__span-0-1030><a id=__codelineno-0-1030 name=__codelineno-0-1030></a><a href=#__codelineno-0-1030><span class=linenos data-linenos="1030 "></span></a>        <span class=p>},</span>
</span><span id=__span-0-1031><a id=__codelineno-0-1031 name=__codelineno-0-1031></a><a href=#__codelineno-0-1031><span class=linenos data-linenos="1031 "></span></a>    <span class=p>)</span>
</span><span id=__span-0-1032><a id=__codelineno-0-1032 name=__codelineno-0-1032></a><a href=#__codelineno-0-1032><span class=linenos data-linenos="1032 "></span></a>
</span><span id=__span-0-1033><a id=__codelineno-0-1033 name=__codelineno-0-1033></a><a href=#__codelineno-0-1033><span class=linenos data-linenos="1033 "></span></a>    <span class=c1># Cache result</span>
</span><span id=__span-0-1034><a id=__codelineno-0-1034 name=__codelineno-0-1034></a><a href=#__codelineno-0-1034><span class=linenos data-linenos="1034 "></span></a>    <span class=n>cache_key</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>session</span><span class=w> </span><span class=ow>or</span><span class=w> </span><span class=s1>&#39;global&#39;</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s1>&#39;%Y%m</span><span class=si>%d</span><span class=s1>_%H%M%S&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-1035><a id=__codelineno-0-1035 name=__codelineno-0-1035></a><a href=#__codelineno-0-1035><span class=linenos data-linenos="1035 "></span></a>    <span class=bp>self</span><span class=o>.</span><span class=n>_cache</span><span class=p>[</span><span class=n>cache_key</span><span class=p>]</span> <span class=o>=</span> <span class=n>result</span>
</span><span id=__span-0-1036><a id=__codelineno-0-1036 name=__codelineno-0-1036></a><a href=#__codelineno-0-1036><span class=linenos data-linenos="1036 "></span></a>
</span><span id=__span-0-1037><a id=__codelineno-0-1037 name=__codelineno-0-1037></a><a href=#__codelineno-0-1037><span class=linenos data-linenos="1037 "></span></a>    <span class=c1># Record metrics</span>
</span><span id=__span-0-1038><a id=__codelineno-0-1038 name=__codelineno-0-1038></a><a href=#__codelineno-0-1038><span class=linenos data-linenos="1038 "></span></a>    <span class=bp>self</span><span class=o>.</span><span class=n>metrics_tracker</span><span class=o>.</span><span class=n>record_instillation</span><span class=p>(</span>
</span><span id=__span-0-1039><a id=__codelineno-0-1039 name=__codelineno-0-1039></a><a href=#__codelineno-0-1039><span class=linenos data-linenos="1039 "></span></a>        <span class=n>tenet_count</span><span class=o>=</span><span class=nb>len</span><span class=p>(</span><span class=n>tenets</span><span class=p>),</span>
</span><span id=__span-0-1040><a id=__codelineno-0-1040 name=__codelineno-0-1040></a><a href=#__codelineno-0-1040><span class=linenos data-linenos="1040 "></span></a>        <span class=n>token_increase</span><span class=o>=</span><span class=n>injection_metadata</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;token_increase&quot;</span><span class=p>,</span> <span class=mi>0</span><span class=p>),</span>
</span><span id=__span-0-1041><a id=__codelineno-0-1041 name=__codelineno-0-1041></a><a href=#__codelineno-0-1041><span class=linenos data-linenos="1041 "></span></a>        <span class=n>strategy</span><span class=o>=</span><span class=n>strategy</span><span class=p>,</span>
</span><span id=__span-0-1042><a id=__codelineno-0-1042 name=__codelineno-0-1042></a><a href=#__codelineno-0-1042><span class=linenos data-linenos="1042 "></span></a>        <span class=n>session</span><span class=o>=</span><span class=n>session</span><span class=p>,</span>
</span><span id=__span-0-1043><a id=__codelineno-0-1043 name=__codelineno-0-1043></a><a href=#__codelineno-0-1043><span class=linenos data-linenos="1043 "></span></a>        <span class=n>complexity</span><span class=o>=</span><span class=n>complexity</span><span class=p>,</span>
</span><span id=__span-0-1044><a id=__codelineno-0-1044 name=__codelineno-0-1044></a><a href=#__codelineno-0-1044><span class=linenos data-linenos="1044 "></span></a>    <span class=p>)</span>
</span><span id=__span-0-1045><a id=__codelineno-0-1045 name=__codelineno-0-1045></a><a href=#__codelineno-0-1045><span class=linenos data-linenos="1045 "></span></a>
</span><span id=__span-0-1046><a id=__codelineno-0-1046 name=__codelineno-0-1046></a><a href=#__codelineno-0-1046><span class=linenos data-linenos="1046 "></span></a>    <span class=c1># Save histories</span>
</span><span id=__span-0-1047><a id=__codelineno-0-1047 name=__codelineno-0-1047></a><a href=#__codelineno-0-1047><span class=linenos data-linenos="1047 "></span></a>    <span class=bp>self</span><span class=o>.</span><span class=n>_save_session_histories</span><span class=p>()</span>
</span><span id=__span-0-1048><a id=__codelineno-0-1048 name=__codelineno-0-1048></a><a href=#__codelineno-0-1048><span class=linenos data-linenos="1048 "></span></a>
</span><span id=__span-0-1049><a id=__codelineno-0-1049 name=__codelineno-0-1049></a><a href=#__codelineno-0-1049><span class=linenos data-linenos="1049 "></span></a>    <span class=c1># Return modified context</span>
</span><span id=__span-0-1050><a id=__codelineno-0-1050 name=__codelineno-0-1050></a><a href=#__codelineno-0-1050><span class=linenos data-linenos="1050 "></span></a>    <span class=k>if</span> <span class=n>is_context_result</span><span class=p>:</span>
</span><span id=__span-0-1051><a id=__codelineno-0-1051 name=__codelineno-0-1051></a><a href=#__codelineno-0-1051><span class=linenos data-linenos="1051 "></span></a>        <span class=c1># Merge system instruction metadata if present</span>
</span><span id=__span-0-1052><a id=__codelineno-0-1052 name=__codelineno-0-1052></a><a href=#__codelineno-0-1052><span class=linenos data-linenos="1052 "></span></a>        <span class=n>extra_meta</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-0-1053><a id=__codelineno-0-1053 name=__codelineno-0-1053></a><a href=#__codelineno-0-1053><span class=linenos data-linenos="1053 "></span></a>            <span class=s2>&quot;tenet_instillation&quot;</span><span class=p>:</span> <span class=n>result</span><span class=o>.</span><span class=n>to_dict</span><span class=p>(),</span>
</span><span id=__span-0-1054><a id=__codelineno-0-1054 name=__codelineno-0-1054></a><a href=#__codelineno-0-1054><span class=linenos data-linenos="1054 "></span></a>            <span class=s2>&quot;tenets_injected&quot;</span><span class=p>:</span> <span class=p>[</span><span class=n>t</span><span class=o>.</span><span class=n>id</span> <span class=k>for</span> <span class=n>t</span> <span class=ow>in</span> <span class=n>tenets</span><span class=p>],</span>
</span><span id=__span-0-1055><a id=__codelineno-0-1055 name=__codelineno-0-1055></a><a href=#__codelineno-0-1055><span class=linenos data-linenos="1055 "></span></a>            <span class=s2>&quot;injection_complexity&quot;</span><span class=p>:</span> <span class=n>complexity</span><span class=p>,</span>
</span><span id=__span-0-1056><a id=__codelineno-0-1056 name=__codelineno-0-1056></a><a href=#__codelineno-0-1056><span class=linenos data-linenos="1056 "></span></a>        <span class=p>}</span>
</span><span id=__span-0-1057><a id=__codelineno-0-1057 name=__codelineno-0-1057></a><a href=#__codelineno-0-1057><span class=linenos data-linenos="1057 "></span></a>        <span class=k>if</span> <span class=n>sys_meta</span><span class=p>:</span>
</span><span id=__span-0-1058><a id=__codelineno-0-1058 name=__codelineno-0-1058></a><a href=#__codelineno-0-1058><span class=linenos data-linenos="1058 "></span></a>            <span class=n>extra_meta</span><span class=p>[</span><span class=s2>&quot;system_instruction&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>sys_meta</span>
</span><span id=__span-0-1059><a id=__codelineno-0-1059 name=__codelineno-0-1059></a><a href=#__codelineno-0-1059><span class=linenos data-linenos="1059 "></span></a>
</span><span id=__span-0-1060><a id=__codelineno-0-1060 name=__codelineno-0-1060></a><a href=#__codelineno-0-1060><span class=linenos data-linenos="1060 "></span></a>        <span class=n>modified_context</span> <span class=o>=</span> <span class=n>ContextResult</span><span class=p>(</span>
</span><span id=__span-0-1061><a id=__codelineno-0-1061 name=__codelineno-0-1061></a><a href=#__codelineno-0-1061><span class=linenos data-linenos="1061 "></span></a>            <span class=n>files</span><span class=o>=</span><span class=n>context</span><span class=o>.</span><span class=n>files</span><span class=p>,</span>
</span><span id=__span-0-1062><a id=__codelineno-0-1062 name=__codelineno-0-1062></a><a href=#__codelineno-0-1062><span class=linenos data-linenos="1062 "></span></a>            <span class=n>context</span><span class=o>=</span><span class=n>modified_text</span><span class=p>,</span>
</span><span id=__span-0-1063><a id=__codelineno-0-1063 name=__codelineno-0-1063></a><a href=#__codelineno-0-1063><span class=linenos data-linenos="1063 "></span></a>            <span class=nb>format</span><span class=o>=</span><span class=n>context</span><span class=o>.</span><span class=n>format</span><span class=p>,</span>
</span><span id=__span-0-1064><a id=__codelineno-0-1064 name=__codelineno-0-1064></a><a href=#__codelineno-0-1064><span class=linenos data-linenos="1064 "></span></a>            <span class=n>metadata</span><span class=o>=</span><span class=p>{</span><span class=o>**</span><span class=n>context</span><span class=o>.</span><span class=n>metadata</span><span class=p>,</span> <span class=o>**</span><span class=n>extra_meta</span><span class=p>},</span>
</span><span id=__span-0-1065><a id=__codelineno-0-1065 name=__codelineno-0-1065></a><a href=#__codelineno-0-1065><span class=linenos data-linenos="1065 "></span></a>        <span class=p>)</span>
</span><span id=__span-0-1066><a id=__codelineno-0-1066 name=__codelineno-0-1066></a><a href=#__codelineno-0-1066><span class=linenos data-linenos="1066 "></span></a>        <span class=k>return</span> <span class=n>modified_context</span>
</span><span id=__span-0-1067><a id=__codelineno-0-1067 name=__codelineno-0-1067></a><a href=#__codelineno-0-1067><span class=linenos data-linenos="1067 "></span></a>    <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-1068><a id=__codelineno-0-1068 name=__codelineno-0-1068></a><a href=#__codelineno-0-1068><span class=linenos data-linenos="1068 "></span></a>        <span class=k>return</span> <span class=n>modified_text</span>
</span></code></pre></div></details></div></div><div class="doc doc-object doc-function"><h6 id=tenets.core.instiller.instiller.Instiller.get_session_stats class="doc doc-heading"><code class="doc-symbol doc-symbol-heading doc-symbol-method"></code> <span class="doc doc-object-name doc-function-name">get_session_stats</span><a href=#tenets.core.instiller.instiller.Instiller.get_session_stats class=headerlink title="Link to this section">&para;</a></h6><div class="language-python doc-signature highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>get_session_stats</span><span class=p>(</span><span class=n>session</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span>
</span></code></pre></div><div class="doc doc-contents "><p>Get statistics for a specific session.</p><table><thead><tr><th><span class=doc-section-title>PARAMETER</span></th><th><span>DESCRIPTION</span></th></tr></thead><tbody><tr class=doc-section-item><td><code>session</code></td><td class=doc-param-details><div class=doc-md-description><p>Session identifier</p></div><p><span class=doc-param-annotation><b>TYPE:</b><code><a class="autorefs autorefs-external" href=https://docs.python.org/3/library/stdtypes.html#str>str</a></code></span></p></td></tr></tbody></table><table><thead><tr><th><span class=doc-section-title>RETURNS</span></th><th><span>DESCRIPTION</span></th></tr></thead><tbody><tr class=doc-section-item><td><span class=doc-returns-annotation><code><a class="autorefs autorefs-external" title="<code>typing.Dict</code>" href=https://docs.python.org/3/library/typing.html#typing.Dict>Dict</a>[<a class="autorefs autorefs-external" href=https://docs.python.org/3/library/stdtypes.html#str>str</a>, <a class="autorefs autorefs-external" title="<code>typing.Any</code>" href=https://docs.python.org/3/library/typing.html#typing.Any>Any</a>]</code></span></td><td class=doc-returns-details><div class=doc-md-description><p>Dictionary of session statistics</p></div></td></tr></tbody></table><details class=mkdocstrings-source><summary>Source code in <code>tenets/core/instiller/instiller.py</code></summary><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-0-1212><a id=__codelineno-0-1212 name=__codelineno-0-1212></a><a href=#__codelineno-0-1212><span class=linenos data-linenos="1212 "></span></a><span class=k>def</span><span class=w> </span><span class=nf>get_session_stats</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>session</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span><span id=__span-0-1213><a id=__codelineno-0-1213 name=__codelineno-0-1213></a><a href=#__codelineno-0-1213><span class=linenos data-linenos="1213 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Get statistics for a specific session.</span>
</span><span id=__span-0-1214><a id=__codelineno-0-1214 name=__codelineno-0-1214></a><a href=#__codelineno-0-1214><span class=linenos data-linenos="1214 "></span></a>
</span><span id=__span-0-1215><a id=__codelineno-0-1215 name=__codelineno-0-1215></a><a href=#__codelineno-0-1215><span class=linenos data-linenos="1215 "></span></a><span class=sd>    Args:</span>
</span><span id=__span-0-1216><a id=__codelineno-0-1216 name=__codelineno-0-1216></a><a href=#__codelineno-0-1216><span class=linenos data-linenos="1216 "></span></a><span class=sd>        session: Session identifier</span>
</span><span id=__span-0-1217><a id=__codelineno-0-1217 name=__codelineno-0-1217></a><a href=#__codelineno-0-1217><span class=linenos data-linenos="1217 "></span></a>
</span><span id=__span-0-1218><a id=__codelineno-0-1218 name=__codelineno-0-1218></a><a href=#__codelineno-0-1218><span class=linenos data-linenos="1218 "></span></a><span class=sd>    Returns:</span>
</span><span id=__span-0-1219><a id=__codelineno-0-1219 name=__codelineno-0-1219></a><a href=#__codelineno-0-1219><span class=linenos data-linenos="1219 "></span></a><span class=sd>        Dictionary of session statistics</span>
</span><span id=__span-0-1220><a id=__codelineno-0-1220 name=__codelineno-0-1220></a><a href=#__codelineno-0-1220><span class=linenos data-linenos="1220 "></span></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-0-1221><a id=__codelineno-0-1221 name=__codelineno-0-1221></a><a href=#__codelineno-0-1221><span class=linenos data-linenos="1221 "></span></a>    <span class=k>if</span> <span class=n>session</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>session_histories</span><span class=p>:</span>
</span><span id=__span-0-1222><a id=__codelineno-0-1222 name=__codelineno-0-1222></a><a href=#__codelineno-0-1222><span class=linenos data-linenos="1222 "></span></a>        <span class=k>return</span> <span class=p>{</span><span class=s2>&quot;error&quot;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&quot;No history for session: </span><span class=si>{</span><span class=n>session</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>}</span>
</span><span id=__span-0-1223><a id=__codelineno-0-1223 name=__codelineno-0-1223></a><a href=#__codelineno-0-1223><span class=linenos data-linenos="1223 "></span></a>
</span><span id=__span-0-1224><a id=__codelineno-0-1224 name=__codelineno-0-1224></a><a href=#__codelineno-0-1224><span class=linenos data-linenos="1224 "></span></a>    <span class=n>history</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>session_histories</span><span class=p>[</span><span class=n>session</span><span class=p>]</span>
</span><span id=__span-0-1225><a id=__codelineno-0-1225 name=__codelineno-0-1225></a><a href=#__codelineno-0-1225><span class=linenos data-linenos="1225 "></span></a>    <span class=n>stats</span> <span class=o>=</span> <span class=n>history</span><span class=o>.</span><span class=n>get_stats</span><span class=p>()</span>
</span><span id=__span-0-1226><a id=__codelineno-0-1226 name=__codelineno-0-1226></a><a href=#__codelineno-0-1226><span class=linenos data-linenos="1226 "></span></a>
</span><span id=__span-0-1227><a id=__codelineno-0-1227 name=__codelineno-0-1227></a><a href=#__codelineno-0-1227><span class=linenos data-linenos="1227 "></span></a>    <span class=c1># Add metrics from tracker</span>
</span><span id=__span-0-1228><a id=__codelineno-0-1228 name=__codelineno-0-1228></a><a href=#__codelineno-0-1228><span class=linenos data-linenos="1228 "></span></a>    <span class=n>session_metrics</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>metrics_tracker</span><span class=o>.</span><span class=n>session_metrics</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>session</span><span class=p>,</span> <span class=p>{})</span>
</span><span id=__span-0-1229><a id=__codelineno-0-1229 name=__codelineno-0-1229></a><a href=#__codelineno-0-1229><span class=linenos data-linenos="1229 "></span></a>    <span class=n>stats</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>session_metrics</span><span class=p>)</span>
</span><span id=__span-0-1230><a id=__codelineno-0-1230 name=__codelineno-0-1230></a><a href=#__codelineno-0-1230><span class=linenos data-linenos="1230 "></span></a>
</span><span id=__span-0-1231><a id=__codelineno-0-1231 name=__codelineno-0-1231></a><a href=#__codelineno-0-1231><span class=linenos data-linenos="1231 "></span></a>    <span class=k>return</span> <span class=n>stats</span>
</span></code></pre></div></details></div></div><div class="doc doc-object doc-function"><h6 id=tenets.core.instiller.instiller.Instiller.get_all_session_stats class="doc doc-heading"><code class="doc-symbol doc-symbol-heading doc-symbol-method"></code> <span class="doc doc-object-name doc-function-name">get_all_session_stats</span><a href=#tenets.core.instiller.instiller.Instiller.get_all_session_stats class=headerlink title="Link to this section">&para;</a></h6><div class="language-python doc-signature highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>get_all_session_stats</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span>
</span></code></pre></div><div class="doc doc-contents "><p>Get statistics for all sessions.</p><table><thead><tr><th><span class=doc-section-title>RETURNS</span></th><th><span>DESCRIPTION</span></th></tr></thead><tbody><tr class=doc-section-item><td><span class=doc-returns-annotation><code><a class="autorefs autorefs-external" title="<code>typing.Dict</code>" href=https://docs.python.org/3/library/typing.html#typing.Dict>Dict</a>[<a class="autorefs autorefs-external" href=https://docs.python.org/3/library/stdtypes.html#str>str</a>, <a class="autorefs autorefs-external" title="<code>typing.Dict</code>" href=https://docs.python.org/3/library/typing.html#typing.Dict>Dict</a>[<a class="autorefs autorefs-external" href=https://docs.python.org/3/library/stdtypes.html#str>str</a>, <a class="autorefs autorefs-external" title="<code>typing.Any</code>" href=https://docs.python.org/3/library/typing.html#typing.Any>Any</a>]]</code></span></td><td class=doc-returns-details><div class=doc-md-description><p>Dictionary mapping session IDs to stats</p></div></td></tr></tbody></table><details class=mkdocstrings-source><summary>Source code in <code>tenets/core/instiller/instiller.py</code></summary><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-0-1233><a id=__codelineno-0-1233 name=__codelineno-0-1233></a><a href=#__codelineno-0-1233><span class=linenos data-linenos="1233 "></span></a><span class=k>def</span><span class=w> </span><span class=nf>get_all_session_stats</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]:</span>
</span><span id=__span-0-1234><a id=__codelineno-0-1234 name=__codelineno-0-1234></a><a href=#__codelineno-0-1234><span class=linenos data-linenos="1234 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Get statistics for all sessions.</span>
</span><span id=__span-0-1235><a id=__codelineno-0-1235 name=__codelineno-0-1235></a><a href=#__codelineno-0-1235><span class=linenos data-linenos="1235 "></span></a>
</span><span id=__span-0-1236><a id=__codelineno-0-1236 name=__codelineno-0-1236></a><a href=#__codelineno-0-1236><span class=linenos data-linenos="1236 "></span></a><span class=sd>    Returns:</span>
</span><span id=__span-0-1237><a id=__codelineno-0-1237 name=__codelineno-0-1237></a><a href=#__codelineno-0-1237><span class=linenos data-linenos="1237 "></span></a><span class=sd>        Dictionary mapping session IDs to stats</span>
</span><span id=__span-0-1238><a id=__codelineno-0-1238 name=__codelineno-0-1238></a><a href=#__codelineno-0-1238><span class=linenos data-linenos="1238 "></span></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-0-1239><a id=__codelineno-0-1239 name=__codelineno-0-1239></a><a href=#__codelineno-0-1239><span class=linenos data-linenos="1239 "></span></a>    <span class=n>all_stats</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-0-1240><a id=__codelineno-0-1240 name=__codelineno-0-1240></a><a href=#__codelineno-0-1240><span class=linenos data-linenos="1240 "></span></a>
</span><span id=__span-0-1241><a id=__codelineno-0-1241 name=__codelineno-0-1241></a><a href=#__codelineno-0-1241><span class=linenos data-linenos="1241 "></span></a>    <span class=k>for</span> <span class=n>session_id</span><span class=p>,</span> <span class=n>history</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>session_histories</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span><span id=__span-0-1242><a id=__codelineno-0-1242 name=__codelineno-0-1242></a><a href=#__codelineno-0-1242><span class=linenos data-linenos="1242 "></span></a>        <span class=n>all_stats</span><span class=p>[</span><span class=n>session_id</span><span class=p>]</span> <span class=o>=</span> <span class=n>history</span><span class=o>.</span><span class=n>get_stats</span><span class=p>()</span>
</span><span id=__span-0-1243><a id=__codelineno-0-1243 name=__codelineno-0-1243></a><a href=#__codelineno-0-1243><span class=linenos data-linenos="1243 "></span></a>
</span><span id=__span-0-1244><a id=__codelineno-0-1244 name=__codelineno-0-1244></a><a href=#__codelineno-0-1244><span class=linenos data-linenos="1244 "></span></a>    <span class=k>return</span> <span class=n>all_stats</span>
</span></code></pre></div></details></div></div><div class="doc doc-object doc-function"><h6 id=tenets.core.instiller.instiller.Instiller.analyze_effectiveness class="doc doc-heading"><code class="doc-symbol doc-symbol-heading doc-symbol-method"></code> <span class="doc doc-object-name doc-function-name">analyze_effectiveness</span><a href=#tenets.core.instiller.instiller.Instiller.analyze_effectiveness class=headerlink title="Link to this section">&para;</a></h6><div class="language-python doc-signature highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>analyze_effectiveness</span><span class=p>(</span><span class=n>session</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span>
</span></code></pre></div><div class="doc doc-contents "><p>Analyze the effectiveness of tenet instillation.</p><table><thead><tr><th><span class=doc-section-title>PARAMETER</span></th><th><span>DESCRIPTION</span></th></tr></thead><tbody><tr class=doc-section-item><td><code>session</code></td><td class=doc-param-details><div class=doc-md-description><p>Optional session to analyze</p></div><p><span class=doc-param-annotation><b>TYPE:</b><code><a class="autorefs autorefs-external" title="<code>typing.Optional</code>" href=https://docs.python.org/3/library/typing.html#typing.Optional>Optional</a>[<a class="autorefs autorefs-external" href=https://docs.python.org/3/library/stdtypes.html#str>str</a>]</code></span><span class=doc-param-default><b>DEFAULT:</b><code>None</code></span></p></td></tr></tbody></table><table><thead><tr><th><span class=doc-section-title>RETURNS</span></th><th><span>DESCRIPTION</span></th></tr></thead><tbody><tr class=doc-section-item><td><span class=doc-returns-annotation><code><a class="autorefs autorefs-external" title="<code>typing.Dict</code>" href=https://docs.python.org/3/library/typing.html#typing.Dict>Dict</a>[<a class="autorefs autorefs-external" href=https://docs.python.org/3/library/stdtypes.html#str>str</a>, <a class="autorefs autorefs-external" title="<code>typing.Any</code>" href=https://docs.python.org/3/library/typing.html#typing.Any>Any</a>]</code></span></td><td class=doc-returns-details><div class=doc-md-description><p>Dictionary with analysis results and recommendations</p></div></td></tr></tbody></table><details class=mkdocstrings-source><summary>Source code in <code>tenets/core/instiller/instiller.py</code></summary><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-0-1246><a id=__codelineno-0-1246 name=__codelineno-0-1246></a><a href=#__codelineno-0-1246><span class=linenos data-linenos="1246 "></span></a><span class=k>def</span><span class=w> </span><span class=nf>analyze_effectiveness</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>session</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span><span id=__span-0-1247><a id=__codelineno-0-1247 name=__codelineno-0-1247></a><a href=#__codelineno-0-1247><span class=linenos data-linenos="1247 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Analyze the effectiveness of tenet instillation.</span>
</span><span id=__span-0-1248><a id=__codelineno-0-1248 name=__codelineno-0-1248></a><a href=#__codelineno-0-1248><span class=linenos data-linenos="1248 "></span></a>
</span><span id=__span-0-1249><a id=__codelineno-0-1249 name=__codelineno-0-1249></a><a href=#__codelineno-0-1249><span class=linenos data-linenos="1249 "></span></a><span class=sd>    Args:</span>
</span><span id=__span-0-1250><a id=__codelineno-0-1250 name=__codelineno-0-1250></a><a href=#__codelineno-0-1250><span class=linenos data-linenos="1250 "></span></a><span class=sd>        session: Optional session to analyze</span>
</span><span id=__span-0-1251><a id=__codelineno-0-1251 name=__codelineno-0-1251></a><a href=#__codelineno-0-1251><span class=linenos data-linenos="1251 "></span></a>
</span><span id=__span-0-1252><a id=__codelineno-0-1252 name=__codelineno-0-1252></a><a href=#__codelineno-0-1252><span class=linenos data-linenos="1252 "></span></a><span class=sd>    Returns:</span>
</span><span id=__span-0-1253><a id=__codelineno-0-1253 name=__codelineno-0-1253></a><a href=#__codelineno-0-1253><span class=linenos data-linenos="1253 "></span></a><span class=sd>        Dictionary with analysis results and recommendations</span>
</span><span id=__span-0-1254><a id=__codelineno-0-1254 name=__codelineno-0-1254></a><a href=#__codelineno-0-1254><span class=linenos data-linenos="1254 "></span></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-0-1255><a id=__codelineno-0-1255 name=__codelineno-0-1255></a><a href=#__codelineno-0-1255><span class=linenos data-linenos="1255 "></span></a>    <span class=c1># Get tenet effectiveness from manager</span>
</span><span id=__span-0-1256><a id=__codelineno-0-1256 name=__codelineno-0-1256></a><a href=#__codelineno-0-1256><span class=linenos data-linenos="1256 "></span></a>    <span class=n>tenet_analysis</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>manager</span><span class=o>.</span><span class=n>analyze_tenet_effectiveness</span><span class=p>()</span>
</span><span id=__span-0-1257><a id=__codelineno-0-1257 name=__codelineno-0-1257></a><a href=#__codelineno-0-1257><span class=linenos data-linenos="1257 "></span></a>
</span><span id=__span-0-1258><a id=__codelineno-0-1258 name=__codelineno-0-1258></a><a href=#__codelineno-0-1258><span class=linenos data-linenos="1258 "></span></a>    <span class=c1># Get instillation metrics</span>
</span><span id=__span-0-1259><a id=__codelineno-0-1259 name=__codelineno-0-1259></a><a href=#__codelineno-0-1259><span class=linenos data-linenos="1259 "></span></a>    <span class=n>metrics</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>metrics_tracker</span><span class=o>.</span><span class=n>get_metrics</span><span class=p>(</span><span class=n>session</span><span class=p>)</span>
</span><span id=__span-0-1260><a id=__codelineno-0-1260 name=__codelineno-0-1260></a><a href=#__codelineno-0-1260><span class=linenos data-linenos="1260 "></span></a>
</span><span id=__span-0-1261><a id=__codelineno-0-1261 name=__codelineno-0-1261></a><a href=#__codelineno-0-1261><span class=linenos data-linenos="1261 "></span></a>    <span class=c1># Session-specific analysis</span>
</span><span id=__span-0-1262><a id=__codelineno-0-1262 name=__codelineno-0-1262></a><a href=#__codelineno-0-1262><span class=linenos data-linenos="1262 "></span></a>    <span class=n>session_analysis</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-0-1263><a id=__codelineno-0-1263 name=__codelineno-0-1263></a><a href=#__codelineno-0-1263><span class=linenos data-linenos="1263 "></span></a>    <span class=k>if</span> <span class=n>session</span> <span class=ow>and</span> <span class=n>session</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>session_histories</span><span class=p>:</span>
</span><span id=__span-0-1264><a id=__codelineno-0-1264 name=__codelineno-0-1264></a><a href=#__codelineno-0-1264><span class=linenos data-linenos="1264 "></span></a>        <span class=n>session_analysis</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_session_stats</span><span class=p>(</span><span class=n>session</span><span class=p>)</span>
</span><span id=__span-0-1265><a id=__codelineno-0-1265 name=__codelineno-0-1265></a><a href=#__codelineno-0-1265><span class=linenos data-linenos="1265 "></span></a>
</span><span id=__span-0-1266><a id=__codelineno-0-1266 name=__codelineno-0-1266></a><a href=#__codelineno-0-1266><span class=linenos data-linenos="1266 "></span></a>    <span class=c1># Generate recommendations</span>
</span><span id=__span-0-1267><a id=__codelineno-0-1267 name=__codelineno-0-1267></a><a href=#__codelineno-0-1267><span class=linenos data-linenos="1267 "></span></a>    <span class=n>recommendations</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-0-1268><a id=__codelineno-0-1268 name=__codelineno-0-1268></a><a href=#__codelineno-0-1268><span class=linenos data-linenos="1268 "></span></a>
</span><span id=__span-0-1269><a id=__codelineno-0-1269 name=__codelineno-0-1269></a><a href=#__codelineno-0-1269><span class=linenos data-linenos="1269 "></span></a>    <span class=c1># Check injection frequency</span>
</span><span id=__span-0-1270><a id=__codelineno-0-1270 name=__codelineno-0-1270></a><a href=#__codelineno-0-1270><span class=linenos data-linenos="1270 "></span></a>    <span class=k>if</span> <span class=n>metrics</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;total_instillations&quot;</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span><span id=__span-0-1271><a id=__codelineno-0-1271 name=__codelineno-0-1271></a><a href=#__codelineno-0-1271><span class=linenos data-linenos="1271 "></span></a>        <span class=n>avg_complexity</span> <span class=o>=</span> <span class=n>metrics</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;avg_complexity&quot;</span><span class=p>,</span> <span class=mf>0.5</span><span class=p>)</span>
</span><span id=__span-0-1272><a id=__codelineno-0-1272 name=__codelineno-0-1272></a><a href=#__codelineno-0-1272><span class=linenos data-linenos="1272 "></span></a>
</span><span id=__span-0-1273><a id=__codelineno-0-1273 name=__codelineno-0-1273></a><a href=#__codelineno-0-1273><span class=linenos data-linenos="1273 "></span></a>        <span class=k>if</span> <span class=n>avg_complexity</span> <span class=o>&gt;</span> <span class=mf>0.7</span><span class=p>:</span>
</span><span id=__span-0-1274><a id=__codelineno-0-1274 name=__codelineno-0-1274></a><a href=#__codelineno-0-1274><span class=linenos data-linenos="1274 "></span></a>            <span class=n>recommendations</span><span class=o>.</span><span class=n>append</span><span class=p>(</span>
</span><span id=__span-0-1275><a id=__codelineno-0-1275 name=__codelineno-0-1275></a><a href=#__codelineno-0-1275><span class=linenos data-linenos="1275 "></span></a>                <span class=s2>&quot;High average complexity detected. Consider reducing injection frequency &quot;</span>
</span><span id=__span-0-1276><a id=__codelineno-0-1276 name=__codelineno-0-1276></a><a href=#__codelineno-0-1276><span class=linenos data-linenos="1276 "></span></a>                <span class=s2>&quot;or using simpler tenets.&quot;</span>
</span><span id=__span-0-1277><a id=__codelineno-0-1277 name=__codelineno-0-1277></a><a href=#__codelineno-0-1277><span class=linenos data-linenos="1277 "></span></a>            <span class=p>)</span>
</span><span id=__span-0-1278><a id=__codelineno-0-1278 name=__codelineno-0-1278></a><a href=#__codelineno-0-1278><span class=linenos data-linenos="1278 "></span></a>        <span class=k>elif</span> <span class=n>avg_complexity</span> <span class=o>&lt;</span> <span class=mf>0.3</span><span class=p>:</span>
</span><span id=__span-0-1279><a id=__codelineno-0-1279 name=__codelineno-0-1279></a><a href=#__codelineno-0-1279><span class=linenos data-linenos="1279 "></span></a>            <span class=n>recommendations</span><span class=o>.</span><span class=n>append</span><span class=p>(</span>
</span><span id=__span-0-1280><a id=__codelineno-0-1280 name=__codelineno-0-1280></a><a href=#__codelineno-0-1280><span class=linenos data-linenos="1280 "></span></a>                <span class=s2>&quot;Low average complexity. You could increase injection frequency &quot;</span>
</span><span id=__span-0-1281><a id=__codelineno-0-1281 name=__codelineno-0-1281></a><a href=#__codelineno-0-1281><span class=linenos data-linenos="1281 "></span></a>                <span class=s2>&quot;for better reinforcement.&quot;</span>
</span><span id=__span-0-1282><a id=__codelineno-0-1282 name=__codelineno-0-1282></a><a href=#__codelineno-0-1282><span class=linenos data-linenos="1282 "></span></a>            <span class=p>)</span>
</span><span id=__span-0-1283><a id=__codelineno-0-1283 name=__codelineno-0-1283></a><a href=#__codelineno-0-1283><span class=linenos data-linenos="1283 "></span></a>
</span><span id=__span-0-1284><a id=__codelineno-0-1284 name=__codelineno-0-1284></a><a href=#__codelineno-0-1284><span class=linenos data-linenos="1284 "></span></a>    <span class=c1># Check skip reasons</span>
</span><span id=__span-0-1285><a id=__codelineno-0-1285 name=__codelineno-0-1285></a><a href=#__codelineno-0-1285><span class=linenos data-linenos="1285 "></span></a>    <span class=n>skip_dist</span> <span class=o>=</span> <span class=n>metrics</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;skip_distribution&quot;</span><span class=p>,</span> <span class=p>{})</span>
</span><span id=__span-0-1286><a id=__codelineno-0-1286 name=__codelineno-0-1286></a><a href=#__codelineno-0-1286><span class=linenos data-linenos="1286 "></span></a>    <span class=k>if</span> <span class=n>skip_dist</span><span class=p>:</span>
</span><span id=__span-0-1287><a id=__codelineno-0-1287 name=__codelineno-0-1287></a><a href=#__codelineno-0-1287><span class=linenos data-linenos="1287 "></span></a>        <span class=n>top_skip</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=n>skip_dist</span><span class=o>.</span><span class=n>items</span><span class=p>(),</span> <span class=n>key</span><span class=o>=</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
</span><span id=__span-0-1288><a id=__codelineno-0-1288 name=__codelineno-0-1288></a><a href=#__codelineno-0-1288><span class=linenos data-linenos="1288 "></span></a>        <span class=k>if</span> <span class=s2>&quot;session_too_short&quot;</span> <span class=ow>in</span> <span class=n>top_skip</span><span class=p>[</span><span class=mi>0</span><span class=p>]:</span>
</span><span id=__span-0-1289><a id=__codelineno-0-1289 name=__codelineno-0-1289></a><a href=#__codelineno-0-1289><span class=linenos data-linenos="1289 "></span></a>            <span class=n>recommendations</span><span class=o>.</span><span class=n>append</span><span class=p>(</span>
</span><span id=__span-0-1290><a id=__codelineno-0-1290 name=__codelineno-0-1290></a><a href=#__codelineno-0-1290><span class=linenos data-linenos="1290 "></span></a>                <span class=sa>f</span><span class=s2>&quot;Many skips due to short sessions. Consider reducing min_session_length &quot;</span>
</span><span id=__span-0-1291><a id=__codelineno-0-1291 name=__codelineno-0-1291></a><a href=#__codelineno-0-1291><span class=linenos data-linenos="1291 "></span></a>                <span class=sa>f</span><span class=s2>&quot;(currently </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>tenet</span><span class=o>.</span><span class=n>min_session_length</span><span class=si>}</span><span class=s2>).&quot;</span>
</span><span id=__span-0-1292><a id=__codelineno-0-1292 name=__codelineno-0-1292></a><a href=#__codelineno-0-1292><span class=linenos data-linenos="1292 "></span></a>            <span class=p>)</span>
</span><span id=__span-0-1293><a id=__codelineno-0-1293 name=__codelineno-0-1293></a><a href=#__codelineno-0-1293><span class=linenos data-linenos="1293 "></span></a>
</span><span id=__span-0-1294><a id=__codelineno-0-1294 name=__codelineno-0-1294></a><a href=#__codelineno-0-1294><span class=linenos data-linenos="1294 "></span></a>    <span class=c1># Check tenet usage</span>
</span><span id=__span-0-1295><a id=__codelineno-0-1295 name=__codelineno-0-1295></a><a href=#__codelineno-0-1295><span class=linenos data-linenos="1295 "></span></a>    <span class=k>if</span> <span class=n>tenet_analysis</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;need_reinforcement&quot;</span><span class=p>):</span>
</span><span id=__span-0-1296><a id=__codelineno-0-1296 name=__codelineno-0-1296></a><a href=#__codelineno-0-1296><span class=linenos data-linenos="1296 "></span></a>        <span class=n>recommendations</span><span class=o>.</span><span class=n>append</span><span class=p>(</span>
</span><span id=__span-0-1297><a id=__codelineno-0-1297 name=__codelineno-0-1297></a><a href=#__codelineno-0-1297><span class=linenos data-linenos="1297 "></span></a>            <span class=sa>f</span><span class=s2>&quot;Tenets needing reinforcement: </span><span class=si>{</span><span class=s1>&#39;, &#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>tenet_analysis</span><span class=p>[</span><span class=s1>&#39;need_reinforcement&#39;</span><span class=p>][:</span><span class=mi>3</span><span class=p>])</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-1298><a id=__codelineno-0-1298 name=__codelineno-0-1298></a><a href=#__codelineno-0-1298><span class=linenos data-linenos="1298 "></span></a>        <span class=p>)</span>
</span><span id=__span-0-1299><a id=__codelineno-0-1299 name=__codelineno-0-1299></a><a href=#__codelineno-0-1299><span class=linenos data-linenos="1299 "></span></a>
</span><span id=__span-0-1300><a id=__codelineno-0-1300 name=__codelineno-0-1300></a><a href=#__codelineno-0-1300><span class=linenos data-linenos="1300 "></span></a>    <span class=k>return</span> <span class=p>{</span>
</span><span id=__span-0-1301><a id=__codelineno-0-1301 name=__codelineno-0-1301></a><a href=#__codelineno-0-1301><span class=linenos data-linenos="1301 "></span></a>        <span class=s2>&quot;tenet_effectiveness&quot;</span><span class=p>:</span> <span class=n>tenet_analysis</span><span class=p>,</span>
</span><span id=__span-0-1302><a id=__codelineno-0-1302 name=__codelineno-0-1302></a><a href=#__codelineno-0-1302><span class=linenos data-linenos="1302 "></span></a>        <span class=s2>&quot;instillation_metrics&quot;</span><span class=p>:</span> <span class=n>metrics</span><span class=p>,</span>
</span><span id=__span-0-1303><a id=__codelineno-0-1303 name=__codelineno-0-1303></a><a href=#__codelineno-0-1303><span class=linenos data-linenos="1303 "></span></a>        <span class=s2>&quot;session_analysis&quot;</span><span class=p>:</span> <span class=n>session_analysis</span><span class=p>,</span>
</span><span id=__span-0-1304><a id=__codelineno-0-1304 name=__codelineno-0-1304></a><a href=#__codelineno-0-1304><span class=linenos data-linenos="1304 "></span></a>        <span class=s2>&quot;recommendations&quot;</span><span class=p>:</span> <span class=n>recommendations</span><span class=p>,</span>
</span><span id=__span-0-1305><a id=__codelineno-0-1305 name=__codelineno-0-1305></a><a href=#__codelineno-0-1305><span class=linenos data-linenos="1305 "></span></a>        <span class=s2>&quot;configuration&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-0-1306><a id=__codelineno-0-1306 name=__codelineno-0-1306></a><a href=#__codelineno-0-1306><span class=linenos data-linenos="1306 "></span></a>            <span class=s2>&quot;injection_frequency&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>tenet</span><span class=o>.</span><span class=n>injection_frequency</span><span class=p>,</span>
</span><span id=__span-0-1307><a id=__codelineno-0-1307 name=__codelineno-0-1307></a><a href=#__codelineno-0-1307><span class=linenos data-linenos="1307 "></span></a>            <span class=s2>&quot;injection_interval&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>tenet</span><span class=o>.</span><span class=n>injection_interval</span><span class=p>,</span>
</span><span id=__span-0-1308><a id=__codelineno-0-1308 name=__codelineno-0-1308></a><a href=#__codelineno-0-1308><span class=linenos data-linenos="1308 "></span></a>            <span class=s2>&quot;complexity_threshold&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>tenet</span><span class=o>.</span><span class=n>session_complexity_threshold</span><span class=p>,</span>
</span><span id=__span-0-1309><a id=__codelineno-0-1309 name=__codelineno-0-1309></a><a href=#__codelineno-0-1309><span class=linenos data-linenos="1309 "></span></a>            <span class=s2>&quot;min_session_length&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>tenet</span><span class=o>.</span><span class=n>min_session_length</span><span class=p>,</span>
</span><span id=__span-0-1310><a id=__codelineno-0-1310 name=__codelineno-0-1310></a><a href=#__codelineno-0-1310><span class=linenos data-linenos="1310 "></span></a>        <span class=p>},</span>
</span><span id=__span-0-1311><a id=__codelineno-0-1311 name=__codelineno-0-1311></a><a href=#__codelineno-0-1311><span class=linenos data-linenos="1311 "></span></a>    <span class=p>}</span>
</span></code></pre></div></details></div></div><div class="doc doc-object doc-function"><h6 id=tenets.core.instiller.instiller.Instiller.export_instillation_history class="doc doc-heading"><code class="doc-symbol doc-symbol-heading doc-symbol-method"></code> <span class="doc doc-object-name doc-function-name">export_instillation_history</span><a href=#tenets.core.instiller.instiller.Instiller.export_instillation_history class=headerlink title="Link to this section">&para;</a></h6><div class="language-python doc-signature highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>export_instillation_history</span><span class=p>(</span><span class=n>output_path</span><span class=p>:</span> <span class=n>Path</span><span class=p>,</span> <span class=nb>format</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s1>&#39;json&#39;</span><span class=p>,</span> <span class=n>session</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span>
</span></code></pre></div><div class="doc doc-contents "><p>Export instillation history to file.</p><table><thead><tr><th><span class=doc-section-title>PARAMETER</span></th><th><span>DESCRIPTION</span></th></tr></thead><tbody><tr class=doc-section-item><td><code>output_path</code></td><td class=doc-param-details><div class=doc-md-description><p>Path to output file</p></div><p><span class=doc-param-annotation><b>TYPE:</b><code><a class="autorefs autorefs-external" title="<code>pathlib.Path</code>" href=https://docs.python.org/3/library/pathlib.html#pathlib.Path>Path</a></code></span></p></td></tr><tr class=doc-section-item><td><code>format</code></td><td class=doc-param-details><div class=doc-md-description><p>Export format (json or csv)</p></div><p><span class=doc-param-annotation><b>TYPE:</b><code><a class="autorefs autorefs-external" href=https://docs.python.org/3/library/stdtypes.html#str>str</a></code></span><span class=doc-param-default><b>DEFAULT:</b><code>&#39;json&#39;</code></span></p></td></tr><tr class=doc-section-item><td><code>session</code></td><td class=doc-param-details><div class=doc-md-description><p>Optional session filter</p></div><p><span class=doc-param-annotation><b>TYPE:</b><code><a class="autorefs autorefs-external" title="<code>typing.Optional</code>" href=https://docs.python.org/3/library/typing.html#typing.Optional>Optional</a>[<a class="autorefs autorefs-external" href=https://docs.python.org/3/library/stdtypes.html#str>str</a>]</code></span><span class=doc-param-default><b>DEFAULT:</b><code>None</code></span></p></td></tr></tbody></table><table><thead><tr><th><span class=doc-section-title>RAISES</span></th><th><span>DESCRIPTION</span></th></tr></thead><tbody><tr class=doc-section-item><td><span class=doc-raises-annotation><code><a class="autorefs autorefs-external" href=https://docs.python.org/3/library/exceptions.html#ValueError>ValueError</a></code></span></td><td class=doc-raises-details><div class=doc-md-description><p>If format is not supported</p></div></td></tr></tbody></table><details class=mkdocstrings-source><summary>Source code in <code>tenets/core/instiller/instiller.py</code></summary><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-0-1313><a id=__codelineno-0-1313 name=__codelineno-0-1313></a><a href=#__codelineno-0-1313><span class=linenos data-linenos="1313 "></span></a><span class=k>def</span><span class=w> </span><span class=nf>export_instillation_history</span><span class=p>(</span>
</span><span id=__span-0-1314><a id=__codelineno-0-1314 name=__codelineno-0-1314></a><a href=#__codelineno-0-1314><span class=linenos data-linenos="1314 "></span></a>    <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-1315><a id=__codelineno-0-1315 name=__codelineno-0-1315></a><a href=#__codelineno-0-1315><span class=linenos data-linenos="1315 "></span></a>    <span class=n>output_path</span><span class=p>:</span> <span class=n>Path</span><span class=p>,</span>
</span><span id=__span-0-1316><a id=__codelineno-0-1316 name=__codelineno-0-1316></a><a href=#__codelineno-0-1316><span class=linenos data-linenos="1316 "></span></a>    <span class=nb>format</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;json&quot;</span><span class=p>,</span>
</span><span id=__span-0-1317><a id=__codelineno-0-1317 name=__codelineno-0-1317></a><a href=#__codelineno-0-1317><span class=linenos data-linenos="1317 "></span></a>    <span class=n>session</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-1318><a id=__codelineno-0-1318 name=__codelineno-0-1318></a><a href=#__codelineno-0-1318><span class=linenos data-linenos="1318 "></span></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-1319><a id=__codelineno-0-1319 name=__codelineno-0-1319></a><a href=#__codelineno-0-1319><span class=linenos data-linenos="1319 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Export instillation history to file.</span>
</span><span id=__span-0-1320><a id=__codelineno-0-1320 name=__codelineno-0-1320></a><a href=#__codelineno-0-1320><span class=linenos data-linenos="1320 "></span></a>
</span><span id=__span-0-1321><a id=__codelineno-0-1321 name=__codelineno-0-1321></a><a href=#__codelineno-0-1321><span class=linenos data-linenos="1321 "></span></a><span class=sd>    Args:</span>
</span><span id=__span-0-1322><a id=__codelineno-0-1322 name=__codelineno-0-1322></a><a href=#__codelineno-0-1322><span class=linenos data-linenos="1322 "></span></a><span class=sd>        output_path: Path to output file</span>
</span><span id=__span-0-1323><a id=__codelineno-0-1323 name=__codelineno-0-1323></a><a href=#__codelineno-0-1323><span class=linenos data-linenos="1323 "></span></a><span class=sd>        format: Export format (json or csv)</span>
</span><span id=__span-0-1324><a id=__codelineno-0-1324 name=__codelineno-0-1324></a><a href=#__codelineno-0-1324><span class=linenos data-linenos="1324 "></span></a><span class=sd>        session: Optional session filter</span>
</span><span id=__span-0-1325><a id=__codelineno-0-1325 name=__codelineno-0-1325></a><a href=#__codelineno-0-1325><span class=linenos data-linenos="1325 "></span></a>
</span><span id=__span-0-1326><a id=__codelineno-0-1326 name=__codelineno-0-1326></a><a href=#__codelineno-0-1326><span class=linenos data-linenos="1326 "></span></a><span class=sd>    Raises:</span>
</span><span id=__span-0-1327><a id=__codelineno-0-1327 name=__codelineno-0-1327></a><a href=#__codelineno-0-1327><span class=linenos data-linenos="1327 "></span></a><span class=sd>        ValueError: If format is not supported</span>
</span><span id=__span-0-1328><a id=__codelineno-0-1328 name=__codelineno-0-1328></a><a href=#__codelineno-0-1328><span class=linenos data-linenos="1328 "></span></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-0-1329><a id=__codelineno-0-1329 name=__codelineno-0-1329></a><a href=#__codelineno-0-1329><span class=linenos data-linenos="1329 "></span></a>    <span class=k>if</span> <span class=nb>format</span> <span class=o>==</span> <span class=s2>&quot;json&quot;</span><span class=p>:</span>
</span><span id=__span-0-1330><a id=__codelineno-0-1330 name=__codelineno-0-1330></a><a href=#__codelineno-0-1330><span class=linenos data-linenos="1330 "></span></a>        <span class=c1># Export as JSON</span>
</span><span id=__span-0-1331><a id=__codelineno-0-1331 name=__codelineno-0-1331></a><a href=#__codelineno-0-1331><span class=linenos data-linenos="1331 "></span></a>        <span class=n>data</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-0-1332><a id=__codelineno-0-1332 name=__codelineno-0-1332></a><a href=#__codelineno-0-1332><span class=linenos data-linenos="1332 "></span></a>            <span class=s2>&quot;exported_at&quot;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>(),</span>
</span><span id=__span-0-1333><a id=__codelineno-0-1333 name=__codelineno-0-1333></a><a href=#__codelineno-0-1333><span class=linenos data-linenos="1333 "></span></a>            <span class=s2>&quot;configuration&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-0-1334><a id=__codelineno-0-1334 name=__codelineno-0-1334></a><a href=#__codelineno-0-1334><span class=linenos data-linenos="1334 "></span></a>                <span class=s2>&quot;injection_frequency&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>tenet</span><span class=o>.</span><span class=n>injection_frequency</span><span class=p>,</span>
</span><span id=__span-0-1335><a id=__codelineno-0-1335 name=__codelineno-0-1335></a><a href=#__codelineno-0-1335><span class=linenos data-linenos="1335 "></span></a>                <span class=s2>&quot;injection_interval&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>tenet</span><span class=o>.</span><span class=n>injection_interval</span><span class=p>,</span>
</span><span id=__span-0-1336><a id=__codelineno-0-1336 name=__codelineno-0-1336></a><a href=#__codelineno-0-1336><span class=linenos data-linenos="1336 "></span></a>            <span class=p>},</span>
</span><span id=__span-0-1337><a id=__codelineno-0-1337 name=__codelineno-0-1337></a><a href=#__codelineno-0-1337><span class=linenos data-linenos="1337 "></span></a>            <span class=s2>&quot;metrics&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>metrics_tracker</span><span class=o>.</span><span class=n>get_all_metrics</span><span class=p>(),</span>
</span><span id=__span-0-1338><a id=__codelineno-0-1338 name=__codelineno-0-1338></a><a href=#__codelineno-0-1338><span class=linenos data-linenos="1338 "></span></a>            <span class=s2>&quot;session_histories&quot;</span><span class=p>:</span> <span class=p>{},</span>
</span><span id=__span-0-1339><a id=__codelineno-0-1339 name=__codelineno-0-1339></a><a href=#__codelineno-0-1339><span class=linenos data-linenos="1339 "></span></a>            <span class=s2>&quot;cached_results&quot;</span><span class=p>:</span> <span class=p>{},</span>
</span><span id=__span-0-1340><a id=__codelineno-0-1340 name=__codelineno-0-1340></a><a href=#__codelineno-0-1340><span class=linenos data-linenos="1340 "></span></a>        <span class=p>}</span>
</span><span id=__span-0-1341><a id=__codelineno-0-1341 name=__codelineno-0-1341></a><a href=#__codelineno-0-1341><span class=linenos data-linenos="1341 "></span></a>
</span><span id=__span-0-1342><a id=__codelineno-0-1342 name=__codelineno-0-1342></a><a href=#__codelineno-0-1342><span class=linenos data-linenos="1342 "></span></a>        <span class=c1># Add session histories</span>
</span><span id=__span-0-1343><a id=__codelineno-0-1343 name=__codelineno-0-1343></a><a href=#__codelineno-0-1343><span class=linenos data-linenos="1343 "></span></a>        <span class=k>for</span> <span class=n>sid</span><span class=p>,</span> <span class=n>history</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>session_histories</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span><span id=__span-0-1344><a id=__codelineno-0-1344 name=__codelineno-0-1344></a><a href=#__codelineno-0-1344><span class=linenos data-linenos="1344 "></span></a>            <span class=k>if</span> <span class=ow>not</span> <span class=n>session</span> <span class=ow>or</span> <span class=n>sid</span> <span class=o>==</span> <span class=n>session</span><span class=p>:</span>
</span><span id=__span-0-1345><a id=__codelineno-0-1345 name=__codelineno-0-1345></a><a href=#__codelineno-0-1345><span class=linenos data-linenos="1345 "></span></a>                <span class=n>data</span><span class=p>[</span><span class=s2>&quot;session_histories&quot;</span><span class=p>][</span><span class=n>sid</span><span class=p>]</span> <span class=o>=</span> <span class=n>history</span><span class=o>.</span><span class=n>get_stats</span><span class=p>()</span>
</span><span id=__span-0-1346><a id=__codelineno-0-1346 name=__codelineno-0-1346></a><a href=#__codelineno-0-1346><span class=linenos data-linenos="1346 "></span></a>
</span><span id=__span-0-1347><a id=__codelineno-0-1347 name=__codelineno-0-1347></a><a href=#__codelineno-0-1347><span class=linenos data-linenos="1347 "></span></a>        <span class=c1># Add cached results</span>
</span><span id=__span-0-1348><a id=__codelineno-0-1348 name=__codelineno-0-1348></a><a href=#__codelineno-0-1348><span class=linenos data-linenos="1348 "></span></a>        <span class=k>for</span> <span class=n>key</span><span class=p>,</span> <span class=n>result</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>_cache</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span><span id=__span-0-1349><a id=__codelineno-0-1349 name=__codelineno-0-1349></a><a href=#__codelineno-0-1349><span class=linenos data-linenos="1349 "></span></a>            <span class=k>if</span> <span class=ow>not</span> <span class=n>session</span> <span class=ow>or</span> <span class=n>result</span><span class=o>.</span><span class=n>session</span> <span class=o>==</span> <span class=n>session</span><span class=p>:</span>
</span><span id=__span-0-1350><a id=__codelineno-0-1350 name=__codelineno-0-1350></a><a href=#__codelineno-0-1350><span class=linenos data-linenos="1350 "></span></a>                <span class=n>data</span><span class=p>[</span><span class=s2>&quot;cached_results&quot;</span><span class=p>][</span><span class=n>key</span><span class=p>]</span> <span class=o>=</span> <span class=n>result</span><span class=o>.</span><span class=n>to_dict</span><span class=p>()</span>
</span><span id=__span-0-1351><a id=__codelineno-0-1351 name=__codelineno-0-1351></a><a href=#__codelineno-0-1351><span class=linenos data-linenos="1351 "></span></a>
</span><span id=__span-0-1352><a id=__codelineno-0-1352 name=__codelineno-0-1352></a><a href=#__codelineno-0-1352><span class=linenos data-linenos="1352 "></span></a>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>output_path</span><span class=p>,</span> <span class=s2>&quot;w&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-0-1353><a id=__codelineno-0-1353 name=__codelineno-0-1353></a><a href=#__codelineno-0-1353><span class=linenos data-linenos="1353 "></span></a>            <span class=n>json</span><span class=o>.</span><span class=n>dump</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>f</span><span class=p>,</span> <span class=n>indent</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span>
</span><span id=__span-0-1354><a id=__codelineno-0-1354 name=__codelineno-0-1354></a><a href=#__codelineno-0-1354><span class=linenos data-linenos="1354 "></span></a>
</span><span id=__span-0-1355><a id=__codelineno-0-1355 name=__codelineno-0-1355></a><a href=#__codelineno-0-1355><span class=linenos data-linenos="1355 "></span></a>    <span class=k>elif</span> <span class=nb>format</span> <span class=o>==</span> <span class=s2>&quot;csv&quot;</span><span class=p>:</span>
</span><span id=__span-0-1356><a id=__codelineno-0-1356 name=__codelineno-0-1356></a><a href=#__codelineno-0-1356><span class=linenos data-linenos="1356 "></span></a>        <span class=c1># Export as CSV</span>
</span><span id=__span-0-1357><a id=__codelineno-0-1357 name=__codelineno-0-1357></a><a href=#__codelineno-0-1357><span class=linenos data-linenos="1357 "></span></a>        <span class=kn>import</span><span class=w> </span><span class=nn>csv</span>
</span><span id=__span-0-1358><a id=__codelineno-0-1358 name=__codelineno-0-1358></a><a href=#__codelineno-0-1358><span class=linenos data-linenos="1358 "></span></a>
</span><span id=__span-0-1359><a id=__codelineno-0-1359 name=__codelineno-0-1359></a><a href=#__codelineno-0-1359><span class=linenos data-linenos="1359 "></span></a>        <span class=n>rows</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-0-1360><a id=__codelineno-0-1360 name=__codelineno-0-1360></a><a href=#__codelineno-0-1360><span class=linenos data-linenos="1360 "></span></a>        <span class=k>for</span> <span class=n>record</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>metrics_tracker</span><span class=o>.</span><span class=n>instillations</span><span class=p>:</span>
</span><span id=__span-0-1361><a id=__codelineno-0-1361 name=__codelineno-0-1361></a><a href=#__codelineno-0-1361><span class=linenos data-linenos="1361 "></span></a>            <span class=k>if</span> <span class=ow>not</span> <span class=n>session</span> <span class=ow>or</span> <span class=n>record</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;session&quot;</span><span class=p>)</span> <span class=o>==</span> <span class=n>session</span><span class=p>:</span>
</span><span id=__span-0-1362><a id=__codelineno-0-1362 name=__codelineno-0-1362></a><a href=#__codelineno-0-1362><span class=linenos data-linenos="1362 "></span></a>                <span class=n>rows</span><span class=o>.</span><span class=n>append</span><span class=p>(</span>
</span><span id=__span-0-1363><a id=__codelineno-0-1363 name=__codelineno-0-1363></a><a href=#__codelineno-0-1363><span class=linenos data-linenos="1363 "></span></a>                    <span class=p>{</span>
</span><span id=__span-0-1364><a id=__codelineno-0-1364 name=__codelineno-0-1364></a><a href=#__codelineno-0-1364><span class=linenos data-linenos="1364 "></span></a>                        <span class=s2>&quot;Timestamp&quot;</span><span class=p>:</span> <span class=n>record</span><span class=p>[</span><span class=s2>&quot;timestamp&quot;</span><span class=p>],</span>
</span><span id=__span-0-1365><a id=__codelineno-0-1365 name=__codelineno-0-1365></a><a href=#__codelineno-0-1365><span class=linenos data-linenos="1365 "></span></a>                        <span class=s2>&quot;Session&quot;</span><span class=p>:</span> <span class=n>record</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;session&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>),</span>
</span><span id=__span-0-1366><a id=__codelineno-0-1366 name=__codelineno-0-1366></a><a href=#__codelineno-0-1366><span class=linenos data-linenos="1366 "></span></a>                        <span class=s2>&quot;Tenets&quot;</span><span class=p>:</span> <span class=n>record</span><span class=p>[</span><span class=s2>&quot;tenet_count&quot;</span><span class=p>],</span>
</span><span id=__span-0-1367><a id=__codelineno-0-1367 name=__codelineno-0-1367></a><a href=#__codelineno-0-1367><span class=linenos data-linenos="1367 "></span></a>                        <span class=s2>&quot;Tokens&quot;</span><span class=p>:</span> <span class=n>record</span><span class=p>[</span><span class=s2>&quot;token_increase&quot;</span><span class=p>],</span>
</span><span id=__span-0-1368><a id=__codelineno-0-1368 name=__codelineno-0-1368></a><a href=#__codelineno-0-1368><span class=linenos data-linenos="1368 "></span></a>                        <span class=s2>&quot;Strategy&quot;</span><span class=p>:</span> <span class=n>record</span><span class=p>[</span><span class=s2>&quot;strategy&quot;</span><span class=p>],</span>
</span><span id=__span-0-1369><a id=__codelineno-0-1369 name=__codelineno-0-1369></a><a href=#__codelineno-0-1369><span class=linenos data-linenos="1369 "></span></a>                        <span class=s2>&quot;Complexity&quot;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>record</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;complexity&#39;</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
</span><span id=__span-0-1370><a id=__codelineno-0-1370 name=__codelineno-0-1370></a><a href=#__codelineno-0-1370><span class=linenos data-linenos="1370 "></span></a>                        <span class=s2>&quot;Skip Reason&quot;</span><span class=p>:</span> <span class=n>record</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;skip_reason&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>),</span>
</span><span id=__span-0-1371><a id=__codelineno-0-1371 name=__codelineno-0-1371></a><a href=#__codelineno-0-1371><span class=linenos data-linenos="1371 "></span></a>                    <span class=p>}</span>
</span><span id=__span-0-1372><a id=__codelineno-0-1372 name=__codelineno-0-1372></a><a href=#__codelineno-0-1372><span class=linenos data-linenos="1372 "></span></a>                <span class=p>)</span>
</span><span id=__span-0-1373><a id=__codelineno-0-1373 name=__codelineno-0-1373></a><a href=#__codelineno-0-1373><span class=linenos data-linenos="1373 "></span></a>
</span><span id=__span-0-1374><a id=__codelineno-0-1374 name=__codelineno-0-1374></a><a href=#__codelineno-0-1374><span class=linenos data-linenos="1374 "></span></a>        <span class=k>if</span> <span class=n>rows</span><span class=p>:</span>
</span><span id=__span-0-1375><a id=__codelineno-0-1375 name=__codelineno-0-1375></a><a href=#__codelineno-0-1375><span class=linenos data-linenos="1375 "></span></a>            <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>output_path</span><span class=p>,</span> <span class=s2>&quot;w&quot;</span><span class=p>,</span> <span class=n>newline</span><span class=o>=</span><span class=s2>&quot;&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-0-1376><a id=__codelineno-0-1376 name=__codelineno-0-1376></a><a href=#__codelineno-0-1376><span class=linenos data-linenos="1376 "></span></a>                <span class=n>writer</span> <span class=o>=</span> <span class=n>csv</span><span class=o>.</span><span class=n>DictWriter</span><span class=p>(</span><span class=n>f</span><span class=p>,</span> <span class=n>fieldnames</span><span class=o>=</span><span class=n>rows</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>keys</span><span class=p>())</span>
</span><span id=__span-0-1377><a id=__codelineno-0-1377 name=__codelineno-0-1377></a><a href=#__codelineno-0-1377><span class=linenos data-linenos="1377 "></span></a>                <span class=n>writer</span><span class=o>.</span><span class=n>writeheader</span><span class=p>()</span>
</span><span id=__span-0-1378><a id=__codelineno-0-1378 name=__codelineno-0-1378></a><a href=#__codelineno-0-1378><span class=linenos data-linenos="1378 "></span></a>                <span class=n>writer</span><span class=o>.</span><span class=n>writerows</span><span class=p>(</span><span class=n>rows</span><span class=p>)</span>
</span><span id=__span-0-1379><a id=__codelineno-0-1379 name=__codelineno-0-1379></a><a href=#__codelineno-0-1379><span class=linenos data-linenos="1379 "></span></a>        <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-1380><a id=__codelineno-0-1380 name=__codelineno-0-1380></a><a href=#__codelineno-0-1380><span class=linenos data-linenos="1380 "></span></a>            <span class=c1># Create empty file with headers</span>
</span><span id=__span-0-1381><a id=__codelineno-0-1381 name=__codelineno-0-1381></a><a href=#__codelineno-0-1381><span class=linenos data-linenos="1381 "></span></a>            <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>output_path</span><span class=p>,</span> <span class=s2>&quot;w&quot;</span><span class=p>,</span> <span class=n>newline</span><span class=o>=</span><span class=s2>&quot;&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-0-1382><a id=__codelineno-0-1382 name=__codelineno-0-1382></a><a href=#__codelineno-0-1382><span class=linenos data-linenos="1382 "></span></a>                <span class=n>writer</span> <span class=o>=</span> <span class=n>csv</span><span class=o>.</span><span class=n>writer</span><span class=p>(</span><span class=n>f</span><span class=p>)</span>
</span><span id=__span-0-1383><a id=__codelineno-0-1383 name=__codelineno-0-1383></a><a href=#__codelineno-0-1383><span class=linenos data-linenos="1383 "></span></a>                <span class=n>writer</span><span class=o>.</span><span class=n>writerow</span><span class=p>(</span>
</span><span id=__span-0-1384><a id=__codelineno-0-1384 name=__codelineno-0-1384></a><a href=#__codelineno-0-1384><span class=linenos data-linenos="1384 "></span></a>                    <span class=p>[</span>
</span><span id=__span-0-1385><a id=__codelineno-0-1385 name=__codelineno-0-1385></a><a href=#__codelineno-0-1385><span class=linenos data-linenos="1385 "></span></a>                        <span class=s2>&quot;Timestamp&quot;</span><span class=p>,</span>
</span><span id=__span-0-1386><a id=__codelineno-0-1386 name=__codelineno-0-1386></a><a href=#__codelineno-0-1386><span class=linenos data-linenos="1386 "></span></a>                        <span class=s2>&quot;Session&quot;</span><span class=p>,</span>
</span><span id=__span-0-1387><a id=__codelineno-0-1387 name=__codelineno-0-1387></a><a href=#__codelineno-0-1387><span class=linenos data-linenos="1387 "></span></a>                        <span class=s2>&quot;Tenets&quot;</span><span class=p>,</span>
</span><span id=__span-0-1388><a id=__codelineno-0-1388 name=__codelineno-0-1388></a><a href=#__codelineno-0-1388><span class=linenos data-linenos="1388 "></span></a>                        <span class=s2>&quot;Tokens&quot;</span><span class=p>,</span>
</span><span id=__span-0-1389><a id=__codelineno-0-1389 name=__codelineno-0-1389></a><a href=#__codelineno-0-1389><span class=linenos data-linenos="1389 "></span></a>                        <span class=s2>&quot;Strategy&quot;</span><span class=p>,</span>
</span><span id=__span-0-1390><a id=__codelineno-0-1390 name=__codelineno-0-1390></a><a href=#__codelineno-0-1390><span class=linenos data-linenos="1390 "></span></a>                        <span class=s2>&quot;Complexity&quot;</span><span class=p>,</span>
</span><span id=__span-0-1391><a id=__codelineno-0-1391 name=__codelineno-0-1391></a><a href=#__codelineno-0-1391><span class=linenos data-linenos="1391 "></span></a>                        <span class=s2>&quot;Skip Reason&quot;</span><span class=p>,</span>
</span><span id=__span-0-1392><a id=__codelineno-0-1392 name=__codelineno-0-1392></a><a href=#__codelineno-0-1392><span class=linenos data-linenos="1392 "></span></a>                    <span class=p>]</span>
</span><span id=__span-0-1393><a id=__codelineno-0-1393 name=__codelineno-0-1393></a><a href=#__codelineno-0-1393><span class=linenos data-linenos="1393 "></span></a>                <span class=p>)</span>
</span><span id=__span-0-1394><a id=__codelineno-0-1394 name=__codelineno-0-1394></a><a href=#__codelineno-0-1394><span class=linenos data-linenos="1394 "></span></a>
</span><span id=__span-0-1395><a id=__codelineno-0-1395 name=__codelineno-0-1395></a><a href=#__codelineno-0-1395><span class=linenos data-linenos="1395 "></span></a>    <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-1396><a id=__codelineno-0-1396 name=__codelineno-0-1396></a><a href=#__codelineno-0-1396><span class=linenos data-linenos="1396 "></span></a>        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Unsupported export format: </span><span class=si>{</span><span class=nb>format</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-1397><a id=__codelineno-0-1397 name=__codelineno-0-1397></a><a href=#__codelineno-0-1397><span class=linenos data-linenos="1397 "></span></a>
</span><span id=__span-0-1398><a id=__codelineno-0-1398 name=__codelineno-0-1398></a><a href=#__codelineno-0-1398><span class=linenos data-linenos="1398 "></span></a>    <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Exported instillation history to </span><span class=si>{</span><span class=n>output_path</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span></code></pre></div></details></div></div><div class="doc doc-object doc-function"><h6 id=tenets.core.instiller.instiller.Instiller.reset_session_history class="doc doc-heading"><code class="doc-symbol doc-symbol-heading doc-symbol-method"></code> <span class="doc doc-object-name doc-function-name">reset_session_history</span><a href=#tenets.core.instiller.instiller.Instiller.reset_session_history class=headerlink title="Link to this section">&para;</a></h6><div class="language-python doc-signature highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>reset_session_history</span><span class=p>(</span><span class=n>session</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span>
</span></code></pre></div><div class="doc doc-contents "><p>Reset injection history for a session.</p><table><thead><tr><th><span class=doc-section-title>PARAMETER</span></th><th><span>DESCRIPTION</span></th></tr></thead><tbody><tr class=doc-section-item><td><code>session</code></td><td class=doc-param-details><div class=doc-md-description><p>Session identifier</p></div><p><span class=doc-param-annotation><b>TYPE:</b><code><a class="autorefs autorefs-external" href=https://docs.python.org/3/library/stdtypes.html#str>str</a></code></span></p></td></tr></tbody></table><table><thead><tr><th><span class=doc-section-title>RETURNS</span></th><th><span>DESCRIPTION</span></th></tr></thead><tbody><tr class=doc-section-item><td><span class=doc-returns-annotation><code><a class="autorefs autorefs-external" href=https://docs.python.org/3/library/functions.html#bool>bool</a></code></span></td><td class=doc-returns-details><div class=doc-md-description><p>True if reset, False if session not found</p></div></td></tr></tbody></table><details class=mkdocstrings-source><summary>Source code in <code>tenets/core/instiller/instiller.py</code></summary><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-0-1400><a id=__codelineno-0-1400 name=__codelineno-0-1400></a><a href=#__codelineno-0-1400><span class=linenos data-linenos="1400 "></span></a><span class=k>def</span><span class=w> </span><span class=nf>reset_session_history</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>session</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span><span id=__span-0-1401><a id=__codelineno-0-1401 name=__codelineno-0-1401></a><a href=#__codelineno-0-1401><span class=linenos data-linenos="1401 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Reset injection history for a session.</span>
</span><span id=__span-0-1402><a id=__codelineno-0-1402 name=__codelineno-0-1402></a><a href=#__codelineno-0-1402><span class=linenos data-linenos="1402 "></span></a>
</span><span id=__span-0-1403><a id=__codelineno-0-1403 name=__codelineno-0-1403></a><a href=#__codelineno-0-1403><span class=linenos data-linenos="1403 "></span></a><span class=sd>    Args:</span>
</span><span id=__span-0-1404><a id=__codelineno-0-1404 name=__codelineno-0-1404></a><a href=#__codelineno-0-1404><span class=linenos data-linenos="1404 "></span></a><span class=sd>        session: Session identifier</span>
</span><span id=__span-0-1405><a id=__codelineno-0-1405 name=__codelineno-0-1405></a><a href=#__codelineno-0-1405><span class=linenos data-linenos="1405 "></span></a>
</span><span id=__span-0-1406><a id=__codelineno-0-1406 name=__codelineno-0-1406></a><a href=#__codelineno-0-1406><span class=linenos data-linenos="1406 "></span></a><span class=sd>    Returns:</span>
</span><span id=__span-0-1407><a id=__codelineno-0-1407 name=__codelineno-0-1407></a><a href=#__codelineno-0-1407><span class=linenos data-linenos="1407 "></span></a><span class=sd>        True if reset, False if session not found</span>
</span><span id=__span-0-1408><a id=__codelineno-0-1408 name=__codelineno-0-1408></a><a href=#__codelineno-0-1408><span class=linenos data-linenos="1408 "></span></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-0-1409><a id=__codelineno-0-1409 name=__codelineno-0-1409></a><a href=#__codelineno-0-1409><span class=linenos data-linenos="1409 "></span></a>    <span class=k>if</span> <span class=n>session</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>session_histories</span><span class=p>:</span>
</span><span id=__span-0-1410><a id=__codelineno-0-1410 name=__codelineno-0-1410></a><a href=#__codelineno-0-1410><span class=linenos data-linenos="1410 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>session_histories</span><span class=p>[</span><span class=n>session</span><span class=p>]</span> <span class=o>=</span> <span class=n>InjectionHistory</span><span class=p>(</span><span class=n>session_id</span><span class=o>=</span><span class=n>session</span><span class=p>)</span>
</span><span id=__span-0-1411><a id=__codelineno-0-1411 name=__codelineno-0-1411></a><a href=#__codelineno-0-1411><span class=linenos data-linenos="1411 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_save_session_histories</span><span class=p>()</span>
</span><span id=__span-0-1412><a id=__codelineno-0-1412 name=__codelineno-0-1412></a><a href=#__codelineno-0-1412><span class=linenos data-linenos="1412 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Reset injection history for session: </span><span class=si>{</span><span class=n>session</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-1413><a id=__codelineno-0-1413 name=__codelineno-0-1413></a><a href=#__codelineno-0-1413><span class=linenos data-linenos="1413 "></span></a>        <span class=k>return</span> <span class=kc>True</span>
</span><span id=__span-0-1414><a id=__codelineno-0-1414 name=__codelineno-0-1414></a><a href=#__codelineno-0-1414><span class=linenos data-linenos="1414 "></span></a>    <span class=k>return</span> <span class=kc>False</span>
</span></code></pre></div></details></div></div><div class="doc doc-object doc-function"><h6 id=tenets.core.instiller.instiller.Instiller.clear_cache class="doc doc-heading"><code class="doc-symbol doc-symbol-heading doc-symbol-method"></code> <span class="doc doc-object-name doc-function-name">clear_cache</span><a href=#tenets.core.instiller.instiller.Instiller.clear_cache class=headerlink title="Link to this section">&para;</a></h6><div class="language-python doc-signature highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>clear_cache</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=kc>None</span>
</span></code></pre></div><div class="doc doc-contents "><p>Clear the results cache.</p><details class=mkdocstrings-source><summary>Source code in <code>tenets/core/instiller/instiller.py</code></summary><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-0-1416><a id=__codelineno-0-1416 name=__codelineno-0-1416></a><a href=#__codelineno-0-1416><span class=linenos data-linenos="1416 "></span></a><span class=k>def</span><span class=w> </span><span class=nf>clear_cache</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-1417><a id=__codelineno-0-1417 name=__codelineno-0-1417></a><a href=#__codelineno-0-1417><span class=linenos data-linenos="1417 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Clear the results cache.&quot;&quot;&quot;</span>
</span><span id=__span-0-1418><a id=__codelineno-0-1418 name=__codelineno-0-1418></a><a href=#__codelineno-0-1418><span class=linenos data-linenos="1418 "></span></a>    <span class=bp>self</span><span class=o>.</span><span class=n>_cache</span><span class=o>.</span><span class=n>clear</span><span class=p>()</span>
</span><span id=__span-0-1419><a id=__codelineno-0-1419 name=__codelineno-0-1419></a><a href=#__codelineno-0-1419><span class=linenos data-linenos="1419 "></span></a>    <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;Cleared instillation results cache&quot;</span><span class=p>)</span>
</span></code></pre></div></details></div></div></div></div></div><h3 id=tenets.core.instiller.instiller-functions>Functions<a href=#tenets.core.instiller.instiller-functions class=headerlink title="Link to this section">&para;</a></h3><div class="doc doc-object doc-function"><h4 id=tenets.core.instiller.instiller.estimate_tokens class="doc doc-heading"><code class="doc-symbol doc-symbol-heading doc-symbol-function"></code> <span class="doc doc-object-name doc-function-name">estimate_tokens</span><a href=#tenets.core.instiller.instiller.estimate_tokens class=headerlink title="Link to this section">&para;</a></h4><div class="language-python doc-signature highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>estimate_tokens</span><span class=p>(</span><span class=n>text</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>int</span>
</span></code></pre></div><div class="doc doc-contents "><p>Lightweight wrapper so tests can patch token estimation.</p><p>Defaults to the shared count_tokens utility.</p><details class=mkdocstrings-source><summary>Source code in <code>tenets/core/instiller/instiller.py</code></summary><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-0-40><a id=__codelineno-0-40 name=__codelineno-0-40></a><a href=#__codelineno-0-40><span class=linenos data-linenos="40 "></span></a><span class=k>def</span><span class=w> </span><span class=nf>estimate_tokens</span><span class=p>(</span><span class=n>text</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>int</span><span class=p>:</span>
</span><span id=__span-0-41><a id=__codelineno-0-41 name=__codelineno-0-41></a><a href=#__codelineno-0-41><span class=linenos data-linenos="41 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Lightweight wrapper so tests can patch token estimation.</span>
</span><span id=__span-0-42><a id=__codelineno-0-42 name=__codelineno-0-42></a><a href=#__codelineno-0-42><span class=linenos data-linenos="42 "></span></a>
</span><span id=__span-0-43><a id=__codelineno-0-43 name=__codelineno-0-43></a><a href=#__codelineno-0-43><span class=linenos data-linenos="43 "></span></a><span class=sd>    Defaults to the shared count_tokens utility.</span>
</span><span id=__span-0-44><a id=__codelineno-0-44 name=__codelineno-0-44></a><a href=#__codelineno-0-44><span class=linenos data-linenos="44 "></span></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-0-45><a id=__codelineno-0-45 name=__codelineno-0-45></a><a href=#__codelineno-0-45><span class=linenos data-linenos="45 "></span></a>    <span class=k>return</span> <span class=n>count_tokens</span><span class=p>(</span><span class=n>text</span><span class=p>)</span>
</span></code></pre></div></details></div></div></div></div></div><aside class=md-source-file><span class=md-source-file__fact><span class=md-icon title="Last update"><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago" title="December 6, 2025 19:19:42 UTC"><span class=timeago datetime=2025-12-06T19:19:42+00:00 locale=en></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date" title="December 6, 2025 19:19:42 UTC">2025-12-06</span></span><span class=md-source-file__fact><span class=md-icon title=Created><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago" title="December 6, 2025 19:19:42 UTC"><span class=timeago datetime=2025-12-06T19:19:42+00:00 locale=en></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date" title="December 6, 2025 19:19:42 UTC">2025-12-06</span></span></aside><form class=md-feedback name=feedback hidden><fieldset><legend class=md-feedback__title> Was this page helpful? </legend><div class=md-feedback__inner><div class=md-feedback__list><button class="md-feedback__icon md-icon" type=submit title="This page was helpful" data-md-value=1><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5 14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81"/></svg></button><button class="md-feedback__icon md-icon" type=submit title="This page could be improved" data-md-value=0><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14"/></svg></button></div><div class=md-feedback__note><div data-md-value=1 hidden> Thanks for your feedback! </div><div data-md-value=0 hidden> Thanks for your feedback! </div></div></div></fieldset></form></article></div><script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script><script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script></div><button type=button class="md-top md-icon" data-md-component=top hidden><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button></main><div id=consent-banner class=consent-banner style=display:none><div class=consent-content><div class=consent-text><strong>Cookie Notice</strong><p>We use cookies to analyze site usage and improve your experience. Your data stays anonymous and is never sold. <a href=../../../../../privacy/ style=color:#FFD600>Privacy Policy</a></p></div><div class=consent-actions><button onclick=acceptCookies() class="consent-btn consent-accept">Accept All</button><button onclick=acceptEssential() class="consent-btn consent-essential">Essential Only</button><button onclick=rejectCookies() class="consent-btn consent-reject">Reject All</button></div></div></div><style>
  .consent-banner {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: rgba(20, 20, 20, 0.98);
    color: #fff;
    padding: 1rem 1.5rem;
    z-index: 9999;
    font-size: 14px;
    line-height: 1.5;
    box-shadow: 0 -4px 20px rgba(0,0,0,0.3);
    backdrop-filter: blur(10px);
  }
  .consent-content {
    max-width: 1200px;
    margin: 0 auto;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1.5rem;
    flex-wrap: wrap;
  }
  .consent-text {
    flex: 1;
    min-width: 280px;
  }
  .consent-text strong {
    display: block;
    margin-bottom: 0.25rem;
    color: #FFD600;
  }
  .consent-text p {
    margin: 0;
    opacity: 0.9;
  }
  .consent-actions {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
  }
  .consent-btn {
    padding: 0.5rem 1rem;
    border: none;
    cursor: pointer;
    font-weight: 500;
    border-radius: 4px;
    transition: all 0.2s;
  }
  .consent-accept {
    background: #FFD600;
    color: #000;
  }
  .consent-accept:hover {
    background: #ffdf33;
  }
  .consent-essential {
    background: transparent;
    color: #fff;
    border: 1px solid #666;
  }
  .consent-essential:hover {
    border-color: #999;
  }
  .consent-reject {
    background: transparent;
    color: #999;
    border: 1px solid #444;
  }
  .consent-reject:hover {
    color: #fff;
    border-color: #666;
  }
  @media (max-width: 600px) {
    .consent-content {
      flex-direction: column;
      text-align: center;
    }
    .consent-actions {
      justify-content: center;
    }
  }
</style><script>
(function() {
  // Default consent state (denied until user consents)
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  
  // Set default consent to denied
  gtag('consent', 'default', {
    'analytics_storage': 'denied',
    'ad_storage': 'denied',
    'wait_for_update': 500
  });
  
  // Check consent state on load
  var consent = localStorage.getItem('cookieConsent');
  
  if (!consent) {
    // Show banner if no choice made
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('consent-banner').style.display = 'block';
    });
  } else if (consent === 'accepted') {
    // User previously accepted all
    gtag('consent', 'update', {
      'analytics_storage': 'granted'
    });
  } else if (consent === 'essential') {
    // Essential only - analytics denied
    gtag('consent', 'update', {
      'analytics_storage': 'denied'
    });
  }
  // 'rejected' keeps default denied state
  
  // Handle rejected state for GA
  if (consent === 'rejected') {
    
  }
})();

function acceptCookies() {
  localStorage.setItem('cookieConsent', 'accepted');
  localStorage.setItem('cookieConsentTime', new Date().toISOString());
  document.getElementById('consent-banner').style.display = 'none';
  
  // Enable analytics
  if (typeof gtag !== 'undefined') {
    gtag('consent', 'update', {
      'analytics_storage': 'granted'
    });
  }
  
  // Track consent event
  if (typeof gtag !== 'undefined') {
    gtag('event', 'cookie_consent', {
      'consent_type': 'all'
    });
  }
}

function acceptEssential() {
  localStorage.setItem('cookieConsent', 'essential');
  localStorage.setItem('cookieConsentTime', new Date().toISOString());
  document.getElementById('consent-banner').style.display = 'none';
  
  // Keep analytics denied
  if (typeof gtag !== 'undefined') {
    gtag('consent', 'update', {
      'analytics_storage': 'denied'
    });
  }
  
  // Stop Clarity
  if (typeof clarity !== 'undefined') {
    clarity('stop');
  }
}

function rejectCookies() {
  localStorage.setItem('cookieConsent', 'rejected');
  localStorage.setItem('cookieConsentTime', new Date().toISOString());
  document.getElementById('consent-banner').style.display = 'none';
  
  // Disable all analytics
  if (typeof gtag !== 'undefined') {
    gtag('consent', 'update', {
      'analytics_storage': 'denied'
    });
  }
  
  // Stop Clarity
  if (typeof clarity !== 'undefined') {
    clarity('stop');
  }
  
  // Delete existing cookies
  deleteCookies(['_ga', '_gid', '_gat', '_clck', '_clsk']);
}

function deleteCookies(names) {
  names.forEach(function(name) {
    document.cookie = name + '=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
    document.cookie = name + '=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; domain=.' + window.location.hostname;
  });
}
</script><footer class="md-footer victorian-footer"><div class=footer-content><div class=footer-grid><div class=footer-brand><div class=footer-logo-container><img src=../../../../../logos/tenets_dark_icon_transparent.png alt=Tenets class="footer-logo dark-logo" loading=lazy><img src=../../../../../logos/tenets_light_icon_transparent.png alt=Tenets class="footer-logo light-logo" loading=lazy><div class=footer-brand-text><h4>tenets</h4><div class=footer-tagline>Context that feeds your prompts</div></div></div><p class=footer-description> Intelligent code aggregation and analysis for modern development. </p><div class=social-links><a href=https://github.com/jddunn/tenets class=social-link title=GitHub target=_blank rel=noopener><svg viewbox="0 0 24 24" width=18 height=18><path fill=currentColor d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg></a><a href=https://discord.gg/DzNgXdYm class=social-link title=Discord target=_blank rel=noopener><svg viewbox="0 0 24 24" width=18 height=18><path fill=currentColor d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515a.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0a12.64 12.64 0 0 0-.617-1.25a.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057a19.9 19.9 0 0 0 5.993 3.03a.078.078 0 0 0 .084-.028a14.09 14.09 0 0 0 1.226-1.994a.076.076 0 0 0-.041-.106a13.107 13.107 0 0 1-1.872-.892a.077.077 0 0 1-.008-.128a10.2 10.2 0 0 0 .372-.292a.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127a12.299 12.299 0 0 1-1.873.892a.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028a19.839 19.839 0 0 0 6.002-3.03a.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.956-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.955-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.946 2.418-2.157 2.418z"/></svg></a><a href=https://twitter.com/manicagency class=social-link title=Twitter target=_blank rel=noopener><svg viewbox="0 0 24 24" width=18 height=18><path fill=currentColor d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/></svg></a></div></div><div class=footer-column><h5>Documentation</h5><ul><li><a href=quickstart/ >Quick Start</a></li><li><a href=tutorial/ >Tutorial</a></li><li><a href=MCP/ >MCP Server</a></li><li><a href=CLI/ >CLI Reference</a></li><li><a href=faq/ >FAQ</a></li></ul></div><div class=footer-column><h5>Resources</h5><ul><li><a href=https://github.com/jddunn/tenets target=_blank rel=noopener>GitHub</a></li><li><a href=https://pypi.org/project/tenets/ target=_blank rel=noopener>PyPI</a></li><li><a href=blog/ >Blog</a></li><li><a href=about/ >About</a></li></ul></div><div class=footer-column><h5>Development sponsored by manic.agency</h5><ul><li><a href=https://manic.agency target=_blank rel=noopener>Website</a></li><li><a href=https://manic.agency/blog target=_blank rel=noopener>Blog</a></li><li><a href=https://manic.agency/about target=_blank rel=noopener>About</a></li><li><a href=mailto:team@manic.agency>Contact</a></li></ul></div><div class=footer-column><h5>Project Status</h5><div class=badge-showcase><div class=badge-item><img src=https://img.shields.io/pypi/v/tenets.svg alt="PyPI version"></div><div class=badge-item><img src=https://github.com/jddunn/tenets/actions/workflows/ci.yml/badge.svg alt=CI></div><div class=badge-item><img src=https://codecov.io/gh/jddunn/tenets/graph/badge.svg alt=Coverage></div><div class=badge-item><img src=https://img.shields.io/github/license/jddunn/tenets.svg alt=License></div></div></div></div></div><div class=footer-bottom><div class=footer-bottom-content><div class=footer-copyright> © 2024-2025 <a href=https://jddunn.github.io target=_blank rel=noopener>Johnny Dunn</a> | MIT License </div><div class=footer-links><a href=../../../../../privacy/ >Privacy Policy</a><a href=../../../../../terms/ >Terms of Service</a><a href=https://github.com/jddunn/tenets/blob/main/LICENSE target=_blank rel=noopener>License</a><a href=https://github.com/jddunn/tenets/blob/main/CONTRIBUTING.md target=_blank rel=noopener>Contributing</a><a href=https://github.com/jddunn/tenets/security target=_blank rel=noopener>Security</a></div></div></div></footer><footer class=md-footer><nav class="md-footer__inner md-grid" aria-label=Footer><a href=../injector/ class="md-footer__link md-footer__link--prev" aria-label="Previous: injector"><div class="md-footer__button md-icon"><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg></div><div class=md-footer__title><span class=md-footer__direction> Previous </span><div class=md-ellipsis> injector </div></div></a><a href=../manager/ class="md-footer__link md-footer__link--next" aria-label="Next: manager"><div class=md-footer__title><span class=md-footer__direction> Next </span><div class=md-ellipsis> manager </div></div><div class="md-footer__button md-icon"><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg></div></a></nav><div class="md-footer-meta md-typeset"><div class="md-footer-meta__inner md-grid"><div class=md-copyright><div class=md-copyright__highlight> Copyright &copy; 2024-2025 <a href=https://manic.agency target=_blank rel=noopener>manic.agency</a> · Built by <a href=https://jddunn.github.io target=_blank rel=noopener>Johnny Dunn</a></div></div><div class=md-social><a href=https://github.com/jddunn/tenets target=_blank rel=noopener title="Tenets on GitHub" class=md-social__link><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg></a><a href=https://discord.gg/DzNgXdYm target=_blank rel=noopener title="Join our Discord" class=md-social__link><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M492.5 69.8c-.2-.3-.4-.6-.8-.7-38.1-17.5-78.4-30-119.7-37.1-.4-.1-.8 0-1.1.1s-.6.4-.8.8c-5.5 9.9-10.5 20.2-14.9 30.6-44.6-6.8-89.9-6.8-134.4 0-4.5-10.5-9.5-20.7-15.1-30.6-.2-.3-.5-.6-.8-.8s-.7-.2-1.1-.2C162.5 39 122.2 51.5 84.1 69c-.3.1-.6.4-.8.7C7.1 183.5-13.8 294.6-3.6 404.2c0 .3.1.5.2.8s.3.4.5.6c44.4 32.9 94 58 146.8 74.2.4.1.8.1 1.1 0s.7-.4.9-.7c11.3-15.4 21.4-31.8 30-48.8.1-.2.2-.5.2-.8s0-.5-.1-.8-.2-.5-.4-.6-.4-.3-.7-.4c-15.8-6.1-31.2-13.4-45.9-21.9-.3-.2-.5-.4-.7-.6s-.3-.6-.3-.9 0-.6.2-.9.3-.5.6-.7c3.1-2.3 6.2-4.7 9.1-7.1.3-.2.6-.4.9-.4s.7 0 1 .1c96.2 43.9 200.4 43.9 295.5 0 .3-.1.7-.2 1-.2s.7.2.9.4c2.9 2.4 6 4.9 9.1 7.2.2.2.4.4.6.7s.2.6.2.9-.1.6-.3.9-.4.5-.6.6c-14.7 8.6-30 15.9-45.9 21.8-.2.1-.5.2-.7.4s-.3.4-.4.7-.1.5-.1.8.1.5.2.8c8.8 17 18.8 33.3 30 48.8.2.3.6.6.9.7s.8.1 1.1 0c52.9-16.2 102.6-41.3 147.1-74.2.2-.2.4-.4.5-.6s.2-.5.2-.8c12.3-126.8-20.5-236.9-86.9-334.5zm-302 267.7c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.4 59.2-52.8 59.2m195.4 0c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.2 59.2-52.8 59.2"/></svg></a><a href=https://pypi.org/project/tenets/ target=_blank rel=noopener title="Tenets on PyPI" class=md-social__link><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6M286.2 444.7a20.4 20.4 0 1 1 0-40.7 20.4 20.4 0 1 1 0 40.7M167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4m-6.6-183.4a20.4 20.4 0 1 1 0 40.8 20.4 20.4 0 1 1 0-40.8"/></svg></a></div></div></div></footer></div><div class=md-dialog data-md-component=dialog><div class="md-dialog__inner md-typeset"></div></div><script id=__config type=application/json>{"annotate": null, "base": "../../../../..", "features": ["navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.path", "navigation.prune", "navigation.indexes", "navigation.top", "navigation.footer", "toc.follow", "search.suggest", "search.highlight", "search.share", "content.code.copy", "content.code.select", "content.code.annotate", "content.tabs.link", "content.tooltips"], "search": "../../../../../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script><script src=../../../../../assets/javascripts/bundle.e71a0d61.min.js></script><script src=../../../../../js/timeago.min.js></script><script src=../../../../../js/timeago_mkdocs_material.js></script><script src=../../../../../js/theme-toggle.js></script><script src=../../../../../js/copy-buttons.js></script><script src=../../../../../js/back-to-top.js></script><script src=../../../../../js/terminal.js></script><script src=../../../../../js/mobile-menu.js></script><script src=../../../../../js/image-modal.js></script><script src=../../../../../js/lantern.js></script><script src=../../../../../js/see-it-in-action.js></script><script src=../../../../../js/install-tabs.js></script></body></html>